import{d as S,R as j,u as R,r as v,b as U,_ as N,e as $,w as r,f as s,o as a,g as l,V as D,h as I,i as w,t as F,j as A,k as z,c as i,a as p,F as T,m as C,l as E,n as q,p as L}from"./index-DSd1PwLk.js";import{S as P}from"./SelectIcon-CMcsiTzv.js";import{H as Y,g as B}from"./HabitEntry-DqlcQDxu.js";import{H as O,a as V,r as W}from"./requestApi-BYihWYVQ.js";import"./ChecklistItemForm-C0NaTpaZ.js";const X=S({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:j,SelectIcon:P},setup(o){R();const e=v([]),d=U(()=>!!o.habitGroup.id),m=U(()=>d.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${o.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),y=U(()=>d.value?"PUT":"POST");return{isEditMode:d,endpoint:m,method:y,handleSave:async u=>{window.location.reload()},value:e,updateRecordIcon:u=>{o.habitGroup.icon=u}}}});function J(o,e,d,m,y,_){const n=s("n-button"),u=s("NTextInput"),G=s("SelectIcon"),g=s("RecordForm");return a(),$(g,{record:o.habitGroup,endpoint:o.endpoint,method:o.method,onSave:o.handleSave,modelName:"Habit Group"},{trigger:r(({openDialog:t})=>[I(o.$slots,"trigger",{openDialog:t},()=>[l(n,{color:"primary"},{default:r(()=>[w(F(o.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),form:r(({record:t})=>[l(D,null,{default:r(()=>[l(u,{value:t.name,"onUpdate:value":k=>t.name=k,label:"Name",required:""},null,8,["value","onUpdate:value"]),l(G,{modelValue:t.icon,"onUpdate:modelValue":k=>t.icon=k,onUpdate:o.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const M=N(X,[["render",J]]),K=S({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:M,HabitForm:V,HabitEntry:Y,Habit:O},setup(o){const{accessToken:e}=A(),d=B(30,"ddd<br>D"),m=B(30,"YYYY-MM-DD"),y=v([]),_=v(!0),n=v(null),u=v({id:o.habitGroup.id,name:o.habitGroup.name,icon:o.habitGroup.icon,habits_with_goals_count:o.habitGroup.habits_with_goals_count,completed_today_count:o.habitGroup.completed_today_count}),G=async c=>{console.log("fetchHabitGroup",c);const H=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${c}`,h=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.value}`}});if(console.log("response",h),h.ok){const f=await h.json();console.log("responseBody",f),u.value=f}else{const f=await h.json();n.value=f.error}},g=async c=>{console.log("fetchHabits",c),_.value=!0;const H=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${o.habitGroup.id}/habits`,h=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.value}`}});if(h.ok){const f=await h.json();y.value=f}else{const f=await h.json();n.value=f.error}_.value=!1},t=async()=>{console.log("updateComponent",o.habitGroup.id),G(o.habitGroup.id),g(o.habitGroup.id)};return z(e,c=>{c&&e.value&&g(o.habitGroup.id)},{immediate:!0}),{habitGroup:u,updateComponent:t,accessToken:e,habits:y,last30daysNiceFormat:d,last30days:m,loading:_,errorMessage:n,fetchHabits:g,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(c,H)=>c.habit_entries.find(h=>h.date===H)}}}),Q={class:"table-group-name habit-group"},Z={class:"habit-group__name-wrapper"},x=["onClick"],oo={key:0,class:"p-1"},eo={key:1,class:"completion-percentages-container"},to=["innerHTML"],ao={class:"table-habit-name"};function no(o,e,d,m,y,_){const n=s("NCircleProgress"),u=s("HabitGroupForm"),G=s("Habit"),g=s("HabitEntry"),t=s("n-order-list"),k=s("n-dropdown");return a(),$(k,null,{label:r(()=>[p("div",Q,[p("div",Z,[l(n,{current:o.habitGroup.completed_today_count,total:o.habitGroup.habits_with_goals_count,fontSize:35,size:30,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),p("h3",null,F(o.habitGroup.name),1),l(q,{class:"mr-2",size:"x-small"},{default:r(()=>[w("mdi-"+F(o.habitGroup.icon),1)]),_:1})]),l(u,{habitGroup:o.habitGroup},{trigger:r(({openDialog:b})=>[p("span",{class:"mdi mdi-square-edit-outline clickable",onClick:b},null,8,x)]),_:1},8,["habitGroup"])])]),content:r(()=>[o.habits.length===0?(a(),i("p",oo,"Add your first habit to this group.")):(a(),i("div",eo,[e[0]||(e[0]=p("div",{class:"table-habit-name"},null,-1)),(a(!0),i(T,null,C(o.last30daysNiceFormat,b=>(a(),i("small",{class:"table-cell",key:b},[p("span",{class:"table-date",innerHTML:b},null,8,to)]))),128))])),l(t,{class:"table-habit-tr",items:o.habits,updateUrl:o.habitBulkUpdateUrl,loading:o.loading,accessToken:o.accessToken,modelName:"habits"},{default:r(b=>[p("div",ao,[l(G,{habit:b},null,8,["habit"])]),(a(!0),i(T,null,C(o.last30days,c=>(a(),i("div",{class:"table-cell",key:c},[o.accessToken?(a(),$(g,{key:0,accessToken:o.accessToken,entry:o.getHabitEntiryForDate(b,c),habit:b,date:c,colour:b.colour,onUpdated:o.updateComponent,loading:o.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):E("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"])]),_:1})}const so=N(K,[["render",no]]),io=S({name:"HabitsView",components:{HabitGroup:so,HabitForm:V,HabitGroupForm:M},setup(){const o=v([]),e=v(!0),d=v(null),m=async()=>{e.value=!0;const _=W("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const n=await _();console.log("data:",n),o.value=n}catch{d.value="Failed to fetch records"}e.value=!1};return L(async()=>{m()}),{habitGroups:o,fetchHabitGroups:m,loading:e,errorMessage:d}}}),ro={class:"standard-container p-1"},lo={class:"page-wrapper"},co={key:0},uo={key:1},po={key:2},bo={key:3},ho={class:"habit-table"},mo={class:"horizontal-scroll"};function _o(o,e,d,m,y,_){const n=s("n-button"),u=s("HabitGroupForm"),G=s("HabitForm"),g=s("HabitGroup");return a(),i(T,null,[p("div",ro,[l(u,null,{trigger:r(({openDialog:t})=>[l(n,{onClick:t},{default:r(()=>e[0]||(e[0]=[w("New Habit Group")])),_:2},1032,["onClick"])]),_:1}),o.habitGroups.length>0?(a(),$(G,{key:0,onSave:o.fetchHabitGroups},{trigger:r(({openDialog:t})=>[l(n,{onClick:t},{default:r(()=>e[1]||(e[1]=[w("New Habit")])),_:2},1032,["onClick"])]),_:1},8,["onSave"])):E("",!0)]),p("div",lo,[o.loading?(a(),i("div",co,"Loading...")):o.errorMessage?(a(),i("div",uo,F(o.errorMessage),1)):o.habitGroups.length===0?(a(),i("div",po,"Create your first habit group.")):(a(),i("div",bo,[p("div",ho,[p("div",mo,[(a(!0),i(T,null,C(o.habitGroups,t=>(a(),i("div",{key:t.id,class:"table-habit-group"},[l(g,{habitGroup:t},null,8,["habitGroup"])]))),128))])])]))])],64)}const ko=N(io,[["render",_o]]);export{ko as default};
