import{d as ae,as as be,R as he,j as ge,r as le,b as c,at as Ve,B as Ne,G as ke,au as _e,av as ye,ah as we,aw as j,ax as Te,ay as Ue,k as Ie,q as Se,E as Pe,n as ne,g as o,az as R,F as M,a3 as Ce,ar as J,K as te,al as $e,aA as De,aB as Fe,aq as Ae,_ as oe,e as G,w,f as k,o as C,V as Ee,a as g,l as L,i as ie,a1 as He,aC as Be,t as W,h as xe,c as Re,p as Me,v as Ge}from"./index-6bb5rSoQ.js";import{S as qe}from"./SelectIcon-CCaMDl7L.js";const ze=ae({name:"HabitForm",props:{habit:{type:Object,required:!1,default:()=>({name:"",colour:"#fff",icon:""})}},emits:["saved"],components:{RecordForm:he,SelectIcon:qe,NButton:be},setup(e,{emit:s}){const{accessToken:i}=ge(),p=le([]),v=t=>t%5===0,m=c(()=>!!e.habit.id),d=c(()=>m.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habits/${e.habit.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habits"),r=c(()=>m.value?"PUT":"POST");return{isEditMode:m,accessToken:i,friendsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//friends/friends",habitGroupsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups",habitTypesUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/types",goalConditionsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/goal_conditions",endpoint:d,method:r,handleSave:t=>{console.log("habit form handle save",t),window.location.reload(),s("saved",t)},value:p,updateRecordIcon:t=>{e.habit.icon=t},allowedMinutes:v}}}),Ke=50,Oe=500;function je(e){let{toggleUpDown:s}=e,i=-1,p=-1;Ve(m);function v(r){m(),d(r),i=window.setTimeout(()=>{p=window.setInterval(()=>d(r),Ke)},Oe)}function m(){window.clearTimeout(i),window.clearInterval(p)}function d(r){s(r==="up")}return{holdStart:v,holdStop:m}}const Le=ke({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},...De(Fe(),["modelValue","validationValue"])},"VNumberInput"),Je=Ne()({name:"VNumberInput",props:{...Le()},emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:i}=s;const p=le(),{holdStart:v,holdStop:m}=je({toggleUpDown:K}),d=_e(e),r=c(()=>d.isDisabled.value||d.isReadonly.value),{isFocused:V,focus:$,blur:D}=ye(e);function N(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.precision;const b=l==null?String(n):n.toFixed(l);return V.value?Number(b).toString():b}const u=we(e,"modelValue",null,n=>n??null,n=>n==null?n??null:j(Number(n),e.min,e.max)),a=Te(null);Ue(()=>{V.value&&!r.value||(u.value==null?a.value=null:isNaN(u.value)||(a.value=N(u.value)))});const t=c({get:()=>a.value,set(n){n===null||n===""?(u.value=null,a.value=null):!isNaN(Number(n))&&Number(n)<=e.max&&Number(n)>=e.min&&(u.value=Number(n),a.value=n)}}),q=c(()=>r.value?!1:(u.value??0)+e.step<=e.max),z=c(()=>r.value?!1:(u.value??0)-e.step>=e.min),f=c(()=>e.hideInput?"stacked":e.controlVariant),X=c(()=>f.value==="split"?"$plus":"$collapse"),Y=c(()=>f.value==="split"?"$minus":"$expand"),F=c(()=>f.value==="split"?"default":"small"),A=c(()=>f.value==="stacked"?"auto":"100%"),ue=c(()=>({props:{onClick:E,onPointerup:H,onPointerdown:Q}})),se=c(()=>({props:{onClick:E,onPointerup:H,onPointerdown:ee}}));Ie(()=>e.precision,()=>ce()),Se(()=>{O()});function Z(n){if(n==null)return 0;const l=n.toString(),b=l.indexOf(".");return~b?l.length-b:0}function K(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(r.value)return;if(u.value==null){t.value=N(j(0,e.min,e.max));return}let l=Math.max(Z(u.value),Z(e.step));e.precision!=null&&(l=Math.max(l,e.precision)),n?q.value&&(t.value=N(u.value+e.step,l)):z.value&&(t.value=N(u.value-e.step,l))}function re(n){var T,U,x,I;if(!n.data)return;const l=(T=n.target)==null?void 0:T.value,b=(U=n.target)==null?void 0:U.selectionStart,B=(x=n.target)==null?void 0:x.selectionEnd,y=l?l.slice(0,b)+n.data+l.slice(B):n.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(y)||n.preventDefault(),e.precision!=null&&(((I=y.split(".")[1])==null?void 0:I.length)>e.precision&&n.preventDefault(),e.precision===0&&y.includes(".")&&n.preventDefault())}async function de(n){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(n.key)||n.ctrlKey||["ArrowDown","ArrowUp"].includes(n.key)&&(n.preventDefault(),O(),await Ae(),n.key==="ArrowDown"?K(!1):K())}function E(n){n.stopPropagation()}function H(n){const l=n.currentTarget;l==null||l.releasePointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),m()}function Q(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v("up")}function ee(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v("down")}function O(){if(r.value||!p.value)return;const n=p.value.value;n&&!isNaN(Number(n))?t.value=N(j(Number(n),e.min,e.max)):t.value=null}function ce(){if(!r.value){if(u.value===null||isNaN(u.value)){t.value=null;return}t.value=e.precision==null?String(u.value):u.value.toFixed(e.precision)}}function me(){if(!r.value){if(u.value===null||isNaN(u.value)){t.value=null;return}t.value=u.value.toString()}}function pe(){$(),me()}function fe(){D(),O()}return Pe(()=>{const{modelValue:n,...l}=ne.filterProps(e);function b(){return i.increment?o(te,{key:"increment-defaults",defaults:{VBtn:{disabled:!q.value,flat:!0,height:A.value,size:F.value,icon:X.value}}},{default:()=>[i.increment(ue.value)]}):o(J,{disabled:!q.value,flat:!0,key:"increment-btn",height:A.value,"data-testid":"increment","aria-hidden":"true",icon:X.value,onClick:E,onPointerup:H,onPointerdown:Q,size:F.value,tabindex:"-1"},null)}function B(){return i.decrement?o(te,{key:"decrement-defaults",defaults:{VBtn:{disabled:!z.value,flat:!0,height:A.value,size:F.value,icon:Y.value}}},{default:()=>[i.decrement(se.value)]}):o(J,{disabled:!z.value,flat:!0,key:"decrement-btn",height:A.value,"data-testid":"decrement","aria-hidden":"true",icon:Y.value,size:F.value,tabindex:"-1",onClick:E,onPointerup:H,onPointerdown:ee},null)}function y(){return o("div",{class:"v-number-input__control"},[B(),o(R,{vertical:f.value!=="stacked"},null),b()])}function T(){return!e.hideInput&&!e.inset?o(R,{vertical:!0},null):void 0}const U=f.value==="split"?o("div",{class:"v-number-input__control"},[o(R,{vertical:!0},null),b()]):e.reverse||f.value==="hidden"?void 0:o(M,null,[T(),y()]),x=i["append-inner"]||U,I=f.value==="split"?o("div",{class:"v-number-input__control"},[B(),o(R,{vertical:!0},null)]):e.reverse&&f.value!=="hidden"?o(M,null,[y(),T()]):void 0,ve=i["prepend-inner"]||I;return o(ne,Ce({ref:p,modelValue:t.value,"onUpdate:modelValue":_=>t.value=_,validationValue:u.value,onBeforeinput:re,onFocus:pe,onBlur:fe,onKeydown:de,class:["v-number-input",{"v-number-input--default":f.value==="default","v-number-input--hide-input":e.hideInput,"v-number-input--inset":e.inset,"v-number-input--reverse":e.reverse,"v-number-input--split":f.value==="split","v-number-input--stacked":f.value==="stacked"},e.class]},l,{style:e.style,inputmode:"decimal"}),{...i,"append-inner":x?function(){var P;for(var _=arguments.length,S=new Array(_),h=0;h<_;h++)S[h]=arguments[h];return o(M,null,[(P=i["append-inner"])==null?void 0:P.call(i,...S),U])}:void 0,"prepend-inner":ve?function(){var P;for(var _=arguments.length,S=new Array(_),h=0;h<_;h++)S[h]=arguments[h];return o(M,null,[I,(P=i["prepend-inner"])==null?void 0:P.call(i,...S)])}:void 0})}),$e({},p)}}),We={class:"n-modal__title"},Xe=["onUpdate:modelValue"];function Ye(e,s,i,p,v,m){const d=k("NButton"),r=k("NTextInput"),V=k("NSelectInputFromRequest"),$=k("SelectIcon"),D=k("NColourPicker"),N=k("NTimeInput"),u=k("RecordForm");return C(),G(u,{record:e.habit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:w(({openDialog:a})=>[xe(e.$slots,"trigger",{openDialog:a},()=>[o(d,{label:e.isEditMode?"Edit Habit":"Add Habit"},null,8,["label"])])]),title:w(()=>[g("h2",We,W(e.isEditMode?"Edit Habit":"Add New Habit"),1)]),form:w(({record:a})=>[o(Ee,null,{default:w(()=>[s[1]||(s[1]=g("h1",null,"Details",-1)),o(r,{value:a.name,"onUpdate:value":t=>a.name=t,label:"Name"},null,8,["value","onUpdate:value"]),o(V,{url:e.habitGroupsUrl,valueKey:"id",name:"habit_group_id",label:"Habit Group",accessToken:e.accessToken,modelValue:a.habit_group_id,"onUpdate:modelValue":t=>a.habit_group_id=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(V,{url:e.habitTypesUrl,valueKey:"name",name:"habit_type",label:"Habit Type",accessToken:e.accessToken,modelValue:a.habit_type,"onUpdate:modelValue":t=>a.habit_type=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o($,{modelValue:a.icon,"onUpdate:modelValue":t=>a.icon=t,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"]),o(D,{modelValue:a.colour,"onUpdate:modelValue":t=>a.colour=t},null,8,["modelValue","onUpdate:modelValue"]),s[2]||(s[2]=g("h1",null,"Goal",-1)),o(V,{url:e.goalConditionsUrl,valueKey:"name",name:"goal_condition",label:"Goal Condition",accessToken:e.accessToken,modelValue:a.goal_condition,"onUpdate:modelValue":t=>a.goal_condition=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),a.goal_condition==="No Goal"||a.goal_condition==="Anything"?L("",!0):(C(),G(r,{key:0,value:a.goal_value,"onUpdate:value":t=>a.goal_value=t,label:"Goal Value"},null,8,["value","onUpdate:value"])),s[3]||(s[3]=g("h1",null,"Reminder",-1)),g("p",null,[s[0]||(s[0]=ie("Would you like a reminder set for this habit? ")),He(g("input",{type:"checkbox","onUpdate:modelValue":t=>a.wants_reminder=t},null,8,Xe),[[Be,a.wants_reminder]])]),a.wants_reminder?(C(),G(N,{key:1,label:"Select Time",value:a.start_time,"onUpdate:value":t=>a.start_time=t},null,8,["value","onUpdate:value"])):L("",!0),a.wants_reminder?(C(),G(Je,{reverse:!1,controlVariant:"default",label:"Duration",hideInput:!1,inset:!1,key:"duration",name:"duration",modelValue:a.duration,"onUpdate:modelValue":t=>a.duration=t},null,8,["modelValue","onUpdate:modelValue"])):L("",!0),s[4]||(s[4]=g("h1",null,"Access",-1)),o(V,{url:e.friendsUrl,valueKey:"id",name:"role",label:"Select Users",accessToken:e.accessToken,modelValue:a.users_id,"onUpdate:modelValue":t=>a.users_id=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const Ze=oe(ze,[["render",Ye]]),Qe=ae({name:"Habit",props:{habit:{type:Object,required:!0},fetchHabits:{type:Function,required:!0}},components:{HabitForm:Ze}}),en={class:"d-flex justify-space-start align-center"},nn=["href"];function tn(e,s,i,p,v,m){const d=k("HabitForm");return C(),Re("div",en,[o(d,{habit:e.habit,fetchHabits:e.fetchHabits},{trigger:w(({openDialog:r})=>[o(J,{density:"default",icon:"mdi-dots-vertical",onClick:r,size:"x-small",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habit","fetchHabits"]),o(Me,{class:"mr-1"},{default:w(()=>[ie("mdi-"+W(e.habit.icon),1)]),_:1}),g("div",null,[g("a",{href:`/#/habits/${e.habit.id}`},W(e.habit.name),9,nn)])])}const on=oe(Qe,[["render",tn],["__scopeId","data-v-3761af0a"]]);function un(e,s="GET",i=null){return async function(){const{getAccessTokenSilently:v}=Ge(),m=await v(),d=await fetch(e,{method:s,headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:i?JSON.stringify(i):void 0});if(!d.ok)throw new Error(`API ${s} ${e} failed (${d.status})`);return d.json()}}export{on as H,Ze as a,un as r};
