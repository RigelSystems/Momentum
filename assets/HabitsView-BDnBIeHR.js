import{d as C,S as Y,R as A,u as I,r as g,b as U,_ as M,e as B,w as i,f as d,o as t,g as o,V as P,h as z,a as p,t as G,i as L,j as w,k as E,c as n,l as q,P as O,U as X,m as J,n as K,p as Q,q as N,F as V,s as D}from"./index-DjeOlQxX.js";import{H as W,a as Z}from"./Habit-BZwAVBYC.js";import{H as x,g as j}from"./dateUtils-vmBcxR3M.js";const ee=C({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:A,SelectIcon:Y},setup(e){I();const h=g([]),a=U(()=>!!e.habitGroup.id),f=U(()=>a.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),v=U(()=>a.value?"PUT":"POST");return{isEditMode:a,endpoint:f,method:v,handleSave:async s=>{window.location.reload()},value:h,updateRecordIcon:s=>{e.habitGroup.icon=s}}}});function te(e,h,a,f,v,u){const r=d("SelectIcon"),s=d("RecordForm");return t(),B(s,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:i(({openDialog:l})=>[L(e.$slots,"trigger",{openDialog:l},()=>[o(w,{color:"primary"},{default:i(()=>[E(G(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:i(()=>[p("span",null,G(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:i(({record:l})=>[o(P,null,{default:i(()=>[o(z,{modelValue:l.name,"onUpdate:modelValue":H=>l.name=H,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),o(r,{modelValue:l.icon,"onUpdate:modelValue":H=>l.icon=H,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const R=M(ee,[["render",te]]),oe=C({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:R}}),ae={class:"table-group-name habit-group"},se={class:"habit-group__name-wrapper"};function ne(e,h,a,f,v,u){const r=d("HabitGroupForm");return t(),n("div",ae,[p("div",se,[p("h3",null,G(e.habitGroup.name),1),o(q,{class:"mr-2",size:"x-small"},{default:i(()=>[E("mdi-"+G(e.habitGroup.icon),1)]),_:1})]),o(r,{habitGroup:e.habitGroup},{trigger:i(({openDialog:s})=>[o(w,{density:"default",icon:"mdi-dots-vertical",onClick:s,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])}const ie=M(oe,[["render",ne]]),re=C({name:"HabitsView",components:{Habit:Z,HabitForm:W,HabitEntry:x,HabitGroup:ie,User:X,PageHeader:O,HabitGroupForm:R},setup(){const{getAccessTokenSilently:e,user:h}=J(),a=g(null),f=g([]),v=g([]),u=g(!0),r=g(null),s=g({}),l=K().format("YYYY-MM-DD"),H=j(30,"YYYY-MM-DD"),T=j(30,"ddd<br>D"),$=async()=>{const b=await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habits/get_habits",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.value}`}});if(b.ok){u.value=!1;const c=await b.json();s.value=c.completion_percentages,f.value=c.habits,console.log(s.value)}else{u.value=!1;const c=await b.json();r.value=c.error}},F=async()=>{console.log("accessToken",a.value);const b=await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.value}`}});if(b.ok){u.value=!1;const c=await b.json();v.value=c}else{u.value=!1;const c=await b.json();r.value=c.error}},_=(k,b)=>k.habit_entries.find(c=>c.date===b),S=k=>k===100,m=async()=>{a.value=await e()},y="https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update";return Q(async()=>{await m(),$(),F()}),{accessToken:a,user:h,groupedHabits:f,habitGroups:v,loading:u,errorMessage:r,lastSevenDays:H,completionPercentages:s,todaysDateFormatted:l,getHabitEntiryForDate:_,lastSevenDaysNice:T,fetchHabits:$,habitComplete:S,habitBulkUpdateUrl:y}}}),le={class:"page-wrapper"},ce={class:"mb-5 d-flex justify-space-start"},de={key:0},pe={key:1},ue={key:2},me={key:3},be={class:"habit-table"},he={class:"horizontal-scroll"},_e={class:"completion-percentages-container"},fe=["innerHTML"],ve={class:"table-habit-name"};function He(e,h,a,f,v,u){const r=d("HabitForm"),s=d("HabitGroupForm"),l=d("HabitGroup"),H=d("Habit"),T=d("HabitEntry"),$=d("n-order-list"),F=d("n-dropdown");return t(),n("div",le,[p("div",ce,[e.fetchHabits?(t(),B(r,{key:0,fetchHabits:e.fetchHabits},{trigger:i(({openDialog:_})=>[o(w,{density:"comfortable",variant:"tonal",text:"New Habit",class:"mr-2",onClick:_},null,8,["onClick"])]),_:1},8,["fetchHabits"])):N("",!0),o(s,null,{trigger:i(({openDialog:_})=>[o(w,{density:"comfortable",variant:"tonal",text:"New Habit Group",onClick:_},null,8,["onClick"])]),_:1})]),e.loading?(t(),n("div",de,"Loading...")):e.errorMessage?(t(),n("div",pe,G(e.errorMessage),1)):e.groupedHabits.length===0?(t(),n("div",ue,"No habits found")):(t(),n("div",me,[p("div",be,[p("div",he,[(t(!0),n(V,null,D(e.groupedHabits,(_,S)=>(t(),n("div",{key:S,class:"table-habit-group"},[o(F,null,{label:i(()=>[o(l,{habitGroup:_[0].habit_group},null,8,["habitGroup"])]),content:i(()=>[p("div",_e,[h[0]||(h[0]=p("div",{class:"table-habit-name"},null,-1)),(t(!0),n(V,null,D(e.lastSevenDaysNice,m=>(t(),n("small",{class:"table-cell",key:m},[p("span",{class:"table-date",innerHTML:m},null,8,fe)]))),128))]),o($,{class:"table-habit-tr",items:_,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:i(m=>[p("div",ve,[o(H,{habit:m,fetchHabits:e.fetchHabits},null,8,["habit","fetchHabits"])]),(t(!0),n(V,null,D(e.lastSevenDays,y=>(t(),n("div",{class:"table-cell",key:y},[e.accessToken?(t(),B(T,{key:0,entry:e.getHabitEntiryForDate(m,y),habit:m,date:y,colour:m.colour,fetchHabits:e.fetchHabits,accessToken:e.accessToken},null,8,["entry","habit","date","colour","fetchHabits","accessToken"])):N("",!0)]))),128))]),_:2},1032,["items","updateUrl","loading","accessToken"])]),_:2},1024)]))),128))])])]))])}const Ge=M(re,[["render",He]]);export{Ge as default};
