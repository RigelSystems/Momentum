import{v as M,d as q,C as O,A as Y,j as z,r as C,k as I,_ as L,e as U,w as d,f as $,o as v,g as n,a as A,c as k,F as R,m as W,B as J,h as S,t as K,D as w,S as X,E as G,G as Q,H as Z,I as _,J as x,K as ee,L as te,M as oe,N as ae,O as ne,Q as le,T as B,U as T,W as se,X as re,Y as ie,l as V,Z as D,$ as H,n as ue,a0 as N,q as E}from"./index-Qcscy6Fn.js";function Ee(e=1,t="YYYY-MM-DD"){return Array.from({length:e},(c,i)=>M().subtract(i,"day").format(t))}const ce=q({name:"HabitEntryChecklist",props:{colour:{type:String,required:!0},date:{type:String,required:!0}},components:{ChecklistItemWeightedExercise:Y,ChecklistItemTask:O},setup(e){const{accessToken:t}=z(),c={backgroundColor:e.colour},i=C(!1),p=()=>{i.value=!0},b=()=>{i.value=!1},a=C(null),m=C(null),l=async o=>{console.log(`Fetching checklist with ID: ${o}`);const f=await fetch(`https://api.fordsdevelopment.co.uk/daily_discipline//checklists/${o}`,{headers:{Authorization:`Bearer ${t.value}`}});if(!f.ok)throw new Error("Failed to fetch checklist");const g=await f.json();console.log("Fetched checklist:",g),m.value=g};return I(a,o=>{o&&(console.log(`Selected checklist ID: ${o}`),l(o))}),{show:i,openDialog:p,closeDialog:b,styles:c,accessToken:t,checklistUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//checklists",checklistId:a,checklist:m}}}),de={class:"n-modal__title"},me={class:"standard-container-1"};function fe(e,t,c,i,p,b){const a=$("NButton"),m=$("NSelectInputFromRequest"),l=$("NModal");return v(),U(l,{modelValue:e.show,"onUpdate:modelValue":t[2]||(t[2]=s=>e.show=s)},{trigger:d(({openModal:s})=>[S(e.$slots,"trigger",{openDialog:s},()=>[n(a,{class:"habit-entry",style:w(e.styles),onClick:s},null,8,["style","onClick"])])]),header:d(()=>[S(e.$slots,"title",{},()=>[A("h2",de,"Checklist - "+K(e.date),1)])]),footer:d(()=>[S(e.$slots,"actions",{},()=>[n(a,{class:"mx-2",colour:"secondary",label:"Cancel",onClick:e.closeDialog},null,8,["onClick"]),n(a,{label:"Save",onClick:t[1]||(t[1]=()=>{})})])]),default:d(()=>{var s;return[n(m,{url:e.checklistUrl,valueKey:"id",name:"role",label:"Select Checklist",modelValue:e.checklistId,"onUpdate:modelValue":t[0]||(t[0]=o=>e.checklistId=o),accessToken:e.accessToken},null,8,["url","modelValue","accessToken"]),A("div",me,[(v(!0),k(R,null,W((s=e.checklist)==null?void 0:s.checklist_items,o=>(v(),k("div",{key:o.id},[(v(),U(J(`ChecklistItem${o.checklist_item_type_classify}`),{checklistItem:o},null,8,["checklistItem"]))]))),128))])]}),_:3},8,["modelValue"])}const he=L(ce,[["render",fe]]),ve=q({name:"HabitEntry",props:{accessToken:{type:String,required:!1},entry:{type:Object,required:!1},habit:{type:Object,required:!0},date:{type:String,required:!0},colour:{type:String,required:!0},loading:{type:Boolean,required:!1}},components:{SelectIcon:X,HabitEntryChecklist:he},setup(e,{emit:t}){var y;let c=!1,i=C(((y=e.entry)==null?void 0:y.value)||0);const p=async u=>{c=!0;const r=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries/${e.entry.id}`;return await fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({value:u})})},b=async u=>(c=!0,await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({habit_id:e.habit.id,date:e.date,value:u})})),a=async u=>{c=!0;const r=e.entry?await p(u):await b(u);if(r.ok){c=!1;const h=await r.json();i.value=h.value,console.log("updated entry",h),t("updated")}else{c=!1;const h=await r.json();console.error(h)}};let m;const l=C(!1),s=()=>{m=setTimeout(()=>{l.value=!0},500)},o=()=>{clearTimeout(m)},f=u=>{u&&a(u)};return{entry:e.entry,updateEntry:a,loading:c,value:i,startHold:s,endHold:o,modalIsActive:l,updateRecordIcon:f,checklistUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/checklists"}}}),pe=Q({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ae({origin:"center center",scrollStrategy:"block",transition:{component:ne},zIndex:2400})},"VDialog"),P=G()({name:"VDialog",props:pe(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,t){let{emit:c,slots:i}=t;const p=Z(e,"modelValue"),{scopeId:b}=_(),a=C();function m(o){var y,u;const f=o.relatedTarget,g=o.target;if(f!==g&&((y=a.value)!=null&&y.contentEl)&&((u=a.value)!=null&&u.globalTop)&&![document,a.value.contentEl].includes(g)&&!a.value.contentEl.contains(g)){const r=le(a.value.contentEl);if(!r.length)return;const h=r[0],j=r[r.length-1];f===h?j.focus():h.focus()}}x(()=>{document.removeEventListener("focusin",m)}),ee&&I(()=>p.value&&e.retainFocus,o=>{o?document.addEventListener("focusin",m):document.removeEventListener("focusin",m)},{immediate:!0});function l(){var o;c("afterEnter"),(o=a.value)!=null&&o.contentEl&&!a.value.contentEl.contains(document.activeElement)&&a.value.contentEl.focus({preventScroll:!0})}function s(){c("afterLeave")}return I(p,async o=>{var f;o||(await se(),(f=a.value.activatorEl)==null||f.focus({preventScroll:!0}))}),te(()=>{const o=B.filterProps(e),f=T({"aria-haspopup":"dialog"},e.activatorProps),g=T({tabindex:-1},e.contentProps);return n(B,T({ref:a,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},o,{modelValue:p.value,"onUpdate:modelValue":y=>p.value=y,"aria-modal":"true",activatorProps:f,contentProps:g,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:l,onAfterLeave:s},b),{activator:i.activator,default:function(){for(var y=arguments.length,u=new Array(y),r=0;r<y;r++)u[r]=arguments[r];return n(re,{root:"VDialog"},{default:()=>{var h;return[(h=i.default)==null?void 0:h.call(i,...u)]}})}})}),oe({},a)}}),F=ie("v-spacer","div","VSpacer"),ye={key:0},ke={key:1},ge={key:2},be={key:3},Ce={key:4};function Ve(e,t,c,i,p,b){const a=$("SelectIcon"),m=$("HabitEntryChecklist");return v(),k(R,null,[e.loading?(v(),k("div",ye,"Loading...")):V("",!0),e.habit.habit_type==="Yes or No"?(v(),k("div",ke,[e.value==="1"?(v(),k("button",{key:0,onClick:t[0]||(t[0]=l=>e.updateEntry("0")),class:"habit-entry habit-entry--check",style:w({backgroundColor:e.colour})},null,4)):(v(),k("button",{key:1,onClick:t[1]||(t[1]=l=>e.updateEntry("1")),class:"habit-entry habit-entry--close"}))])):V("",!0),e.habit.habit_type==="Numerical"?(v(),k("div",ge,[n(P,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[4]||(t[4]=l=>e.modalIsActive=l),persistent:""},{activator:d(({props:l})=>[n(E,{onClick:t[2]||(t[2]=s=>e.updateEntry((parseInt(e.value)+1).toString())),onMousedown:e.startHold,onMouseup:e.endHold,onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",text:e.value||"-",variant:"flat",class:"habit-entry habit-entry--number",style:w(e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`})},null,8,["onMousedown","onMouseup","onTouchstart","onTouchend","text","style"])]),default:d(({isActive:l})=>[n(D,{title:`${e.habit.name}: ${e.date}`},{default:d(()=>[n(H,null,{default:d(()=>[n(ue,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value=s),label:"Value",type:"number"},null,8,["modelValue"])]),_:1}),n(N,null,{default:d(()=>[n(F),n(E,{text:"Update Entry",onClick:s=>{l.value=!1,e.updateEntry(e.value)}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):V("",!0),e.habit.habit_type==="Icon"?(v(),k("div",be,[n(P,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[6]||(t[6]=l=>e.modalIsActive=l),persistent:""},{activator:d(({props:l})=>[n(E,T(l,{onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",variant:"flat",class:`habit-entry habit-entry--number mdi mdi-${e.value}`,style:e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`}}),null,16,["onTouchstart","onTouchend","class","style"])]),default:d(({isActive:l})=>[n(D,{title:`${e.habit.name}: ${e.date}`},{default:d(()=>[n(H,null,{default:d(()=>[n(a,{modelValue:e.value.value,"onUpdate:modelValue":t[5]||(t[5]=s=>e.value.value=s),onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate"])]),_:1}),n(N,null,{default:d(()=>[n(F),n(E,{text:"Update Entry",onClick:s=>l.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):V("",!0),e.habit.habit_type==="Checklist"?(v(),k("div",Ce,[n(m,{colour:e.colour,date:e.date},null,8,["colour","date"])])):V("",!0)],64)}const Te=L(ve,[["render",Ve]]);export{Te as H,Ee as g};
