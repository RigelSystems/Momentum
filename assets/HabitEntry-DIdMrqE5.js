import{v as G,d as K,C as Q,A as Z,j as _,r as $,k as D,_ as X,e as S,w as f,f as E,o as i,l as y,c as p,F as H,m as R,B as j,a as T,g as s,D as U,i as x,t as w,h as B,S as ee,E as te,G as le,H as oe,I as ne,J as ae,K as se,L as re,M as ie,N as ce,O as ue,Q as de,T as M,U as N,W as he,X as me,Y as ke,Z as O,$ as z,n as ve,a0 as Y,q as A}from"./index-CH7hzNg4.js";function Ue(e=1,t="YYYY-MM-DD"){return Array.from({length:e},(m,d)=>G().subtract(d,"day").format(t))}const fe=K({name:"HabitEntryChecklist",props:{colour:{type:String,required:!0},date:{type:String,required:!0},value:{type:Number,required:!1}},components:{ChecklistItemWeightedExercise:Z,ChecklistItemTask:Q},setup(e){const{accessToken:t}=_(),m={backgroundColor:e.value?e.colour:"#f0f0f0"},d=$(!1),g=()=>{d.value=!0},V=()=>{d.value=!1},n=$(null),k=$(null),a=$(!1),u=$(0),l=$(1),h=async o=>{console.log(`Fetching checklist with ID: ${o}`);const r=await fetch(`https://api.fordsdevelopment.co.uk/daily_discipline//checklists/${o}`,{headers:{Authorization:`Bearer ${t.value}`}});if(!r.ok)throw new Error("Failed to fetch checklist");const I=await r.json();console.log("Fetched checklist:",I),k.value=I};return D(n,o=>{o&&(console.log(`Selected checklist ID: ${o}`),h(o))}),{show:d,openDialog:g,closeDialog:V,styles:m,checklistSelected:a,accessToken:t,checklistUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//checklists",checklistId:n,checklist:k,startChecklist:()=>{a.value=!0},currentItemCount:u,currentSetCount:l,nextAction:()=>{var r;const o=(r=k.value)==null?void 0:r.checklist_items[u.value];o&&o.sets&&l.value<o.sets?l.value++:(u.value++,l.value=1)}}}}),pe={class:"n-modal__title"},ye={key:1,class:"standard-container-1"},ge={key:2};function be(e,t,m,d,g,V){const n=E("NButton"),k=E("NSelectInputFromRequest"),a=E("NCircleProgress"),u=E("NModal");return i(),S(u,{modelValue:e.show,"onUpdate:modelValue":t[2]||(t[2]=l=>e.show=l)},{trigger:f(({openModal:l})=>[B(e.$slots,"trigger",{openDialog:l},()=>[s(n,{class:"habit-entry",style:U(e.styles),onClick:l},null,8,["style","onClick"])])]),header:f(()=>[B(e.$slots,"title",{},()=>[T("h2",pe,"Checklist - "+w(e.date),1)])]),footer:f(()=>[B(e.$slots,"actions",{},()=>{var l;return[e.checklistSelected?(i(),S(n,{key:0,label:"Back",onClick:t[1]||(t[1]=h=>e.currentItemCount--)})):y("",!0),s(n,{class:"mx-2",colour:"secondary",label:"Cancel",onClick:e.closeDialog},null,8,["onClick"]),e.checklistId&&((l=e.checklist)!=null&&l.checklist_items)&&!e.checklistSelected?(i(),S(n,{key:1,label:"Start",onClick:e.startChecklist},null,8,["onClick"])):y("",!0),e.checklistSelected?(i(),S(n,{key:2,label:"Next",onClick:e.nextAction},null,8,["onClick"])):y("",!0)]})]),default:f(()=>{var l,h,b,v,c,o,r,I;return[e.checklistSelected?y("",!0):(i(),S(k,{key:0,url:e.checklistUrl,valueKey:"id",name:"role",label:"Select Checklist",modelValue:e.checklistId,"onUpdate:modelValue":t[0]||(t[0]=C=>e.checklistId=C),accessToken:e.accessToken},null,8,["url","modelValue","accessToken"])),e.checklistSelected?y("",!0):(i(),p("div",ye,[(i(!0),p(H,null,R((l=e.checklist)==null?void 0:l.checklist_items,C=>(i(),p("div",{key:C.id},[(i(),S(j(`ChecklistItem${C.checklist_item_type_classify}`),{checklistItem:C},null,8,["checklistItem"]))]))),128))])),e.checklistSelected?(i(),p("div",ge,[t[3]||(t[3]=T("p",{class:"text-center"},"You have started the checklist.",-1)),t[4]||(t[4]=T("p",{class:"text-center"},"Please complete the items in your checklist.",-1)),s(a,{current:e.currentItemCount+1,total:(b=(h=e.checklist)==null?void 0:h.checklist_items)==null?void 0:b.length,fontSize:35,size:40,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),(i(),S(j(`ChecklistItem${(c=(v=e.checklist)==null?void 0:v.checklist_items[e.currentItemCount])==null?void 0:c.checklist_item_type_classify}`),{checklistItem:(o=e.checklist)==null?void 0:o.checklist_items[e.currentItemCount]},null,8,["checklistItem"])),(i(!0),p(H,null,R((I=(r=e.checklist)==null?void 0:r.checklist_items[e.currentItemCount])==null?void 0:I.sets,C=>{var P,F,q,L;return i(),p("div",{key:C.id},[T("p",{style:U([`border: ${C==e.currentSetCount?"solid grey 1px":""};`])},[T("strong",null,"Set "+w(C)+":",1),x(" "+w((F=(P=e.checklist)==null?void 0:P.checklist_items[e.currentItemCount])==null?void 0:F.reps)+" reps at "+w((L=(q=e.checklist)==null?void 0:q.checklist_items[e.currentItemCount])==null?void 0:L.weight)+" kg ",1)],4)])}),128))])):y("",!0)]}),_:3},8,["modelValue"])}const Ce=X(fe,[["render",be]]),$e=K({name:"HabitEntry",props:{accessToken:{type:String,required:!1},entry:{type:Object,required:!1},habit:{type:Object,required:!0},date:{type:String,required:!0},colour:{type:String,required:!0},loading:{type:Boolean,required:!1}},components:{SelectIcon:ee,HabitEntryChecklist:Ce},setup(e,{emit:t}){var v;let m=!1,d=$(((v=e.entry)==null?void 0:v.value)||0);const g=async c=>{m=!0;const o=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries/${e.entry.id}`;return await fetch(o,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({value:c})})},V=async c=>(m=!0,await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({habit_id:e.habit.id,date:e.date,value:c})})),n=async c=>{m=!0;const o=e.entry?await g(c):await V(c);if(o.ok){m=!1;const r=await o.json();d.value=r.value,console.log("updated entry",r),t("updated")}else{m=!1;const r=await o.json();console.error(r)}};let k;const a=$(!1),u=()=>{k=setTimeout(()=>{a.value=!0},500)},l=()=>{clearTimeout(k)},h=c=>{c&&n(c)};return{entry:e.entry,updateEntry:n,loading:m,value:d,startHold:u,endHold:l,modalIsActive:a,updateRecordIcon:h,checklistUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/checklists"}}}),Ve=le({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ce({origin:"center center",scrollStrategy:"block",transition:{component:ue},zIndex:2400})},"VDialog"),W=te()({name:"VDialog",props:Ve(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,t){let{emit:m,slots:d}=t;const g=oe(e,"modelValue"),{scopeId:V}=ne(),n=$();function k(l){var v,c;const h=l.relatedTarget,b=l.target;if(h!==b&&((v=n.value)!=null&&v.contentEl)&&((c=n.value)!=null&&c.globalTop)&&![document,n.value.contentEl].includes(b)&&!n.value.contentEl.contains(b)){const o=de(n.value.contentEl);if(!o.length)return;const r=o[0],I=o[o.length-1];h===r?I.focus():r.focus()}}ae(()=>{document.removeEventListener("focusin",k)}),se&&D(()=>g.value&&e.retainFocus,l=>{l?document.addEventListener("focusin",k):document.removeEventListener("focusin",k)},{immediate:!0});function a(){var l;m("afterEnter"),(l=n.value)!=null&&l.contentEl&&!n.value.contentEl.contains(document.activeElement)&&n.value.contentEl.focus({preventScroll:!0})}function u(){m("afterLeave")}return D(g,async l=>{var h;l||(await he(),(h=n.value.activatorEl)==null||h.focus({preventScroll:!0}))}),re(()=>{const l=M.filterProps(e),h=N({"aria-haspopup":"dialog"},e.activatorProps),b=N({tabindex:-1},e.contentProps);return s(M,N({ref:n,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},l,{modelValue:g.value,"onUpdate:modelValue":v=>g.value=v,"aria-modal":"true",activatorProps:h,contentProps:b,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:a,onAfterLeave:u},V),{activator:d.activator,default:function(){for(var v=arguments.length,c=new Array(v),o=0;o<v;o++)c[o]=arguments[o];return s(me,{root:"VDialog"},{default:()=>{var r;return[(r=d.default)==null?void 0:r.call(d,...c)]}})}})}),ie({},n)}}),J=ke("v-spacer","div","VSpacer"),Ie={key:0},Se={key:1},Ee={key:2},Te={key:3},we={key:4};function Ae(e,t,m,d,g,V){const n=E("SelectIcon"),k=E("HabitEntryChecklist");return i(),p(H,null,[e.loading?(i(),p("div",Ie,"Loading...")):y("",!0),e.habit.habit_type==="Yes or No"?(i(),p("div",Se,[e.value==="1"?(i(),p("button",{key:0,onClick:t[0]||(t[0]=a=>e.updateEntry("0")),class:"habit-entry habit-entry--check",style:U({backgroundColor:e.colour})},null,4)):(i(),p("button",{key:1,onClick:t[1]||(t[1]=a=>e.updateEntry("1")),class:"habit-entry habit-entry--close"}))])):y("",!0),e.habit.habit_type==="Numerical"?(i(),p("div",Ee,[s(W,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[4]||(t[4]=a=>e.modalIsActive=a),persistent:""},{activator:f(({props:a})=>[s(A,{onClick:t[2]||(t[2]=u=>e.updateEntry((parseInt(e.value)+1).toString())),onMousedown:e.startHold,onMouseup:e.endHold,onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",text:e.value||"-",variant:"flat",class:"habit-entry habit-entry--number",style:U(e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`})},null,8,["onMousedown","onMouseup","onTouchstart","onTouchend","text","style"])]),default:f(({isActive:a})=>[s(O,{title:`${e.habit.name}: ${e.date}`},{default:f(()=>[s(z,null,{default:f(()=>[s(ve,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=u=>e.value=u),label:"Value",type:"number"},null,8,["modelValue"])]),_:1}),s(Y,null,{default:f(()=>[s(J),s(A,{text:"Update Entry",onClick:u=>{a.value=!1,e.updateEntry(e.value)}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):y("",!0),e.habit.habit_type==="Icon"?(i(),p("div",Te,[s(W,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[6]||(t[6]=a=>e.modalIsActive=a),persistent:""},{activator:f(({props:a})=>[s(A,N(a,{onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",variant:"flat",class:`habit-entry habit-entry--number mdi mdi-${e.value}`,style:e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`}}),null,16,["onTouchstart","onTouchend","class","style"])]),default:f(({isActive:a})=>[s(O,{title:`${e.habit.name}: ${e.date}`},{default:f(()=>[s(z,null,{default:f(()=>[s(n,{modelValue:e.value.value,"onUpdate:modelValue":t[5]||(t[5]=u=>e.value.value=u),onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate"])]),_:1}),s(Y,null,{default:f(()=>[s(J),s(A,{text:"Update Entry",onClick:u=>a.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):y("",!0),e.habit.habit_type==="Checklist"?(i(),p("div",we,[s(k,{colour:e.colour,date:e.date,value:e.value},null,8,["colour","date","value"])])):y("",!0)],64)}const Be=X($e,[["render",Ae]]);export{Be as H,Ue as g};
