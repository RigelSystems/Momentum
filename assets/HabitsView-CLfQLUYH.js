import{d as V,S as A,R as D,u as I,r as g,b as U,_ as E,e as v,w as l,f as b,o as t,g as n,V as j,h as q,a as c,t as k,i as L,j as H,k as B,l as z,m as N,c as s,n as C,F as G,p as w,q as Y}from"./index-CalNuQpA.js";import{H as O,g as M}from"./HabitEntry-CQFZ4mIs.js";import{H as P,a as X,r as J}from"./Habit-DwgktJ9J.js";const K=V({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:D,SelectIcon:A},setup(e){I();const i=g([]),d=U(()=>!!e.habitGroup.id),u=U(()=>d.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),m=U(()=>d.value?"PUT":"POST");return{isEditMode:d,endpoint:u,method:m,handleSave:async p=>{window.location.reload()},value:i,updateRecordIcon:p=>{e.habitGroup.icon=p}}}});function Q(e,i,d,u,m,_){const a=b("SelectIcon"),p=b("RecordForm");return t(),v(p,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:l(({openDialog:o})=>[L(e.$slots,"trigger",{openDialog:o},()=>[n(H,{color:"primary"},{default:l(()=>[B(k(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:l(()=>[c("span",null,k(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:l(({record:o})=>[n(j,null,{default:l(()=>[n(q,{modelValue:o.name,"onUpdate:modelValue":h=>o.name=h,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),n(a,{modelValue:o.icon,"onUpdate:modelValue":h=>o.icon=h,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const R=E(K,[["render",Q]]),W=V({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:R,HabitForm:X,HabitEntry:O,Habit:P},setup(e){const i=M(30,"ddd<br>D"),d=M(30,"YYYY-MM-DD"),u=g([]),m=g(!0),_=g(null),a=async y=>{m.value=!0;const F=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,f=await fetch(F,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h.value}`}});if(f.ok){const T=await f.json();u.value=T}else{const T=await f.json();_.value=T.error}m.value=!1},{getAccessTokenSilently:p,user:o}=z(),h=g(null),$=async()=>{h.value=await p()};return N(async()=>{await $(),a()}),{accessToken:h,habits:u,last30daysNiceFormat:i,last30days:d,loading:m,errorMessage:_,fetchHabits:a,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(y,F)=>y.habit_entries.find(f=>f.date===F)}}}),Z={class:"table-group-name habit-group"},x={class:"habit-group__name-wrapper"},ee={key:0,class:"p-1"},te={key:1,class:"completion-percentages-container"},oe=["innerHTML"],ae={class:"table-habit-name"};function se(e,i,d,u,m,_){const a=b("HabitGroupForm"),p=b("Habit"),o=b("HabitEntry"),h=b("n-order-list"),$=b("HabitForm"),S=b("n-dropdown");return t(),v(S,null,{label:l(()=>[c("div",Z,[c("div",x,[c("h3",null,k(e.habitGroup.name),1),n(Y,{class:"mr-2",size:"x-small"},{default:l(()=>[B("mdi-"+k(e.habitGroup.icon),1)]),_:1})]),n(a,{habitGroup:e.habitGroup},{trigger:l(({openDialog:r})=>[n(H,{density:"default",icon:"mdi-dots-vertical",onClick:r,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:l(()=>[e.habits.length===0?(t(),s("p",ee,"Add your first habit to this group.")):(t(),s("div",te,[i[0]||(i[0]=c("div",{class:"table-habit-name"},null,-1)),(t(!0),s(G,null,w(e.last30daysNiceFormat,r=>(t(),s("small",{class:"table-cell",key:r},[c("span",{class:"table-date",innerHTML:r},null,8,oe)]))),128))])),n(h,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:l(r=>[c("div",ae,[n(p,{habit:r},null,8,["habit"])]),(t(!0),s(G,null,w(e.last30days,y=>(t(),s("div",{class:"table-cell",key:y},[e.accessToken?(t(),v(o,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(r,y),habit:r,date:y,colour:r.colour,onUpdated:e.fetchHabits,loading:e.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):C("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"]),e.fetchHabits?(t(),v($,{key:2,fetchHabits:e.fetchHabits},{trigger:l(({openDialog:r})=>[n(H,{density:"comfortable",variant:"tonal",text:"New Habit",onClick:r},null,8,["onClick"])]),_:1},8,["fetchHabits"])):C("",!0)]),_:1})}const ne=E(W,[["render",se]]),ie=V({name:"HabitsView",components:{HabitGroup:ne,HabitGroupForm:R},setup(){const e=g([]),i=g(!0),d=g(null),u=async()=>{i.value=!0;const _=J("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const a=await _();console.log("data:",a),e.value=a}catch{d.value="Failed to fetch records"}i.value=!1};return N(async()=>{u()}),{habitGroups:e,fetchHabitGroups:u,loading:i,errorMessage:d}}}),re={class:"p-1"},le={class:"page-wrapper"},de={key:0},ce={key:1},ue={key:2},pe={key:3},be={class:"habit-table"},me={class:"horizontal-scroll"};function he(e,i,d,u,m,_){const a=b("HabitGroupForm"),p=b("HabitGroup");return t(),s(G,null,[c("div",re,[n(a,null,{trigger:l(({openDialog:o})=>[n(H,{density:"comfortable",variant:"tonal",text:"New Habit Group",onClick:o},null,8,["onClick"])]),_:1})]),c("div",le,[e.loading?(t(),s("div",de,"Loading...")):e.errorMessage?(t(),s("div",ce,k(e.errorMessage),1)):e.habitGroups.length===0?(t(),s("div",ue,"Create your first habit group.")):(t(),s("div",pe,[c("div",be,[c("div",me,[(t(!0),s(G,null,w(e.habitGroups,o=>(t(),s("div",{key:o.id,class:"table-habit-group"},[n(p,{habitGroup:o},null,8,["habitGroup"])]))),128))])])]))])],64)}const fe=E(ie,[["render",he]]);export{fe as default};
