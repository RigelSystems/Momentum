import{d as V,S as D,R as z,u as I,r as y,b as U,_ as B,e as F,w as c,f as n,V as q,g as r,h as L,a as u,t as $,i as P,j as E,o,k as Y,l as A,c as l,m as N,F as T,n as C,p as M,q as O}from"./index-BSkj9F-8.js";import{H as W,g as j}from"./HabitEntry-B-zTm7Pk.js";import{H as X,a as J,r as K}from"./Habit-B5ONMY18.js";const Q=V({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:z,SelectIcon:D},setup(e){I();const a=y([]),d=U(()=>!!e.habitGroup.id),p=U(()=>d.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),m=U(()=>d.value?"PUT":"POST");return{isEditMode:d,endpoint:p,method:m,handleSave:async b=>{window.location.reload()},value:a,updateRecordIcon:b=>{e.habitGroup.icon=b}}}});function Z(e,a,d,p,m,_){const s=r("n-button"),b=r("SelectIcon"),g=r("RecordForm");return o(),F(g,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:c(({openDialog:t})=>[P(e.$slots,"trigger",{openDialog:t},()=>[n(s,{color:"primary"},{default:c(()=>[E($(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:c(()=>[u("span",null,$(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:c(({record:t})=>[n(L,null,{default:c(()=>[n(q,{modelValue:t.name,"onUpdate:modelValue":k=>t.name=k,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),n(b,{modelValue:t.icon,"onUpdate:modelValue":k=>t.icon=k,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const R=B(Q,[["render",Z]]),x=V({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:R,HabitForm:J,HabitEntry:W,Habit:X},setup(e){const a=j(30,"ddd<br>D"),d=j(30,"YYYY-MM-DD"),p=y([]),m=y(!0),_=y(null),s=y({id:e.habitGroup.id,name:e.habitGroup.name,icon:e.habitGroup.icon,habits_with_goals_count:e.habitGroup.habits_with_goals_count,completed_today_count:e.habitGroup.completed_today_count}),b=async G=>{console.log("fetchHabitGroup",G);const H=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${G}`,h=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.value}`}});if(console.log("response",h),h.ok){const f=await h.json();console.log("responseBody",f),s.value=f}else{const f=await h.json();_.value=f.error}},g=async G=>{console.log("fetchHabits",G),m.value=!0;const H=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,h=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.value}`}});if(h.ok){const f=await h.json();p.value=f}else{const f=await h.json();_.value=f.error}m.value=!1},t=async()=>{console.log("updateComponent",e.habitGroup.id),b(e.habitGroup.id),g(e.habitGroup.id)},{getAccessTokenSilently:k,user:S}=Y(),v=y(null),i=async()=>{v.value=await k()};return A(async()=>{await i(),g()}),{habitGroup:s,updateComponent:t,accessToken:v,habits:p,last30daysNiceFormat:a,last30days:d,loading:m,errorMessage:_,fetchHabits:g,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(G,H)=>G.habit_entries.find(h=>h.date===H)}}}),ee={class:"table-group-name habit-group"},oe={class:"habit-group__name-wrapper"},te={key:0,class:"p-1"},ae={key:1,class:"completion-percentages-container"},ne=["innerHTML"],se={class:"table-habit-name"};function ie(e,a,d,p,m,_){const s=r("NCircleProgress"),b=r("HabitGroupForm"),g=r("Habit"),t=r("HabitEntry"),k=r("n-order-list"),S=r("HabitForm"),v=r("n-dropdown");return o(),F(v,null,{label:c(()=>[u("div",ee,[u("div",oe,[n(s,{current:e.habitGroup.completed_today_count,total:e.habitGroup.habits_with_goals_count,fontSize:35,size:30,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),u("h3",null,$(e.habitGroup.name),1),n(O,{class:"mr-2",size:"x-small"},{default:c(()=>[E("mdi-"+$(e.habitGroup.icon),1)]),_:1})]),n(b,{habitGroup:e.habitGroup},{trigger:c(({openDialog:i})=>[n(M,{density:"default",icon:"mdi-dots-vertical",onClick:i,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:c(()=>[e.habits.length===0?(o(),l("p",te,"Add your first habit to this group.")):(o(),l("div",ae,[a[0]||(a[0]=u("div",{class:"table-habit-name"},null,-1)),(o(!0),l(T,null,C(e.last30daysNiceFormat,i=>(o(),l("small",{class:"table-cell",key:i},[u("span",{class:"table-date",innerHTML:i},null,8,ne)]))),128))])),n(k,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:c(i=>[u("div",se,[n(g,{habit:i},null,8,["habit"])]),(o(!0),l(T,null,C(e.last30days,w=>(o(),l("div",{class:"table-cell",key:w},[e.accessToken?(o(),F(t,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(i,w),habit:i,date:w,colour:i.colour,onUpdated:e.updateComponent,loading:e.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):N("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"]),e.fetchHabits?(o(),F(S,{key:2,fetchHabits:e.fetchHabits},{trigger:c(({openDialog:i})=>[n(M,{density:"comfortable",variant:"tonal",text:"New Habit",onClick:i},null,8,["onClick"])]),_:1},8,["fetchHabits"])):N("",!0)]),_:1})}const re=B(x,[["render",ie]]),le=V({name:"HabitsView",components:{HabitGroup:re,HabitGroupForm:R},setup(){const e=y([]),a=y(!0),d=y(null),p=async()=>{a.value=!0;const _=K("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const s=await _();console.log("data:",s),e.value=s}catch{d.value="Failed to fetch records"}a.value=!1};return A(async()=>{p()}),{habitGroups:e,fetchHabitGroups:p,loading:a,errorMessage:d}}}),ce={class:"p-1"},de={class:"page-wrapper"},ue={key:0},pe={key:1},be={key:2},he={key:3},me={class:"habit-table"},_e={class:"horizontal-scroll"};function ge(e,a,d,p,m,_){const s=r("n-button"),b=r("HabitGroupForm"),g=r("HabitGroup");return o(),l(T,null,[u("div",ce,[n(b,null,{trigger:c(({openDialog:t})=>[n(s,{onClick:t},{default:c(()=>a[0]||(a[0]=[E("New Habit Group")])),_:2},1032,["onClick"])]),_:1})]),u("div",de,[e.loading?(o(),l("div",ue,"Loading...")):e.errorMessage?(o(),l("div",pe,$(e.errorMessage),1)):e.habitGroups.length===0?(o(),l("div",be,"Create your first habit group.")):(o(),l("div",he,[u("div",me,[u("div",_e,[(o(!0),l(T,null,C(e.habitGroups,t=>(o(),l("div",{key:t.id,class:"table-habit-group"},[n(g,{habitGroup:t},null,8,["habitGroup"])]))),128))])])]))])],64)}const Ge=B(le,[["render",ge]]);export{Ge as default};
