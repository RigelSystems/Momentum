import{d as N,R as j,u as R,r as f,b as U,_ as B,e as $,w as r,f as s,o as t,g as c,V as D,h as I,i as w,t as F,j as A,k as z,c as i,a as p,F as T,m as C,l as S,n as L,p as q}from"./index-BGU5o5H4.js";import{S as P}from"./SelectIcon-BHRwP6xQ.js";import{H as Y,g as E}from"./HabitEntry-Byt-QqyE.js";import{H as O,a as V,r as W}from"./requestApi-Bxu6vK14.js";import"./ChecklistItemForm-BacoGyN-.js";const X=N({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:j,SelectIcon:P},setup(e){R();const o=f([]),d=U(()=>!!e.habitGroup.id),m=U(()=>d.value?`https://api.rigelsystems.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.rigelsystems.co.uk/daily_discipline//habit_groups"),y=U(()=>d.value?"PUT":"POST");return{isEditMode:d,endpoint:m,method:y,handleSave:async u=>{window.location.reload()},value:o,updateRecordIcon:u=>{e.habitGroup.icon=u}}}});function J(e,o,d,m,y,_){const n=s("n-button"),u=s("NTextInput"),k=s("SelectIcon"),g=s("RecordForm");return t(),$(g,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave,modelName:"Habit Group"},{trigger:r(({openDialog:a})=>[I(e.$slots,"trigger",{openDialog:a},()=>[c(n,{color:"primary"},{default:r(()=>[w(F(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),form:r(({record:a})=>[c(D,null,{default:r(()=>[c(u,{value:a.name,"onUpdate:value":v=>a.name=v,label:"Name",required:""},null,8,["value","onUpdate:value"]),c(k,{modelValue:a.icon,"onUpdate:modelValue":v=>a.icon=v,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const M=B(X,[["render",J]]),K=N({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:M,HabitForm:V,HabitEntry:Y,Habit:O},setup(e){const{accessToken:o}=A(),d=E(30,"ddd<br>D"),m=E(30,"YYYY-MM-DD"),y=f([]),_=f(!0),n=f(null),u=f({id:e.habitGroup.id,name:e.habitGroup.name,icon:e.habitGroup.icon,habits_with_goals_count:e.habitGroup.habits_with_goals_count,completed_today_count:e.habitGroup.completed_today_count}),k=async l=>{console.log("fetchHabitGroup",l);const H=`https://api.rigelsystems.co.uk/daily_discipline/habit_groups/${l}`,h=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.value}`}});if(console.log("response",h),h.ok){const G=await h.json();console.log("responseBody",G),u.value=G}else{const G=await h.json();n.value=G.error}},g=async l=>{console.log("fetchHabits",l),_.value=!0;const H=`https://api.rigelsystems.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,h=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.value}`}});if(h.ok){const G=await h.json();y.value=G}else{const G=await h.json();n.value=G.error}_.value=!1},a=async()=>{console.log("updateComponent",e.habitGroup.id),k(e.habitGroup.id),g(e.habitGroup.id)};return z(o,l=>{l&&o.value&&g(e.habitGroup.id)},{immediate:!0}),{habitGroup:u,updateComponent:a,accessToken:o,habits:y,last30daysNiceFormat:d,last30days:m,loading:_,errorMessage:n,fetchHabits:g,habitBulkUpdateUrl:"https://api.rigelsystems.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(l,H)=>l.habit_entries.find(h=>h.date===H)}}}),Q={class:"table-group-name habit-group"},Z={class:"habit-group__name-wrapper"},x=["onClick"],ee={key:0,class:"p-1"},oe={key:1,class:"completion-percentages-container"},te=["innerHTML"],ae={class:"table-habit-name"};function ne(e,o,d,m,y,_){const n=s("NCircleProgress"),u=s("HabitGroupForm"),k=s("Habit"),g=s("HabitEntry"),a=s("n-order-list"),v=s("n-dropdown");return t(),$(v,null,{label:r(()=>[p("div",Q,[p("div",Z,[e.habitGroup.habits_with_goals_count>0?(t(),$(n,{key:0,current:e.habitGroup.completed_today_count,total:e.habitGroup.habits_with_goals_count,fontSize:35,size:30,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"])):S("",!0),p("h3",null,F(e.habitGroup.name),1),c(L,{class:"mr-2",size:"x-small"},{default:r(()=>[w("mdi-"+F(e.habitGroup.icon),1)]),_:1})]),c(u,{habitGroup:e.habitGroup},{trigger:r(({openDialog:b})=>[p("span",{class:"mdi mdi-pencil clickable",onClick:b},null,8,x)]),_:1},8,["habitGroup"])])]),content:r(()=>[e.habits.length===0?(t(),i("p",ee,"Add your first habit to this group.")):(t(),i("div",oe,[o[0]||(o[0]=p("div",{class:"table-habit-name"},null,-1)),(t(!0),i(T,null,C(e.last30daysNiceFormat,b=>(t(),i("small",{class:"table-cell",key:b},[p("span",{class:"table-date",innerHTML:b},null,8,te)]))),128))])),c(a,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:r(b=>[p("div",ae,[c(k,{habit:b},null,8,["habit"])]),(t(!0),i(T,null,C(e.last30days,l=>(t(),i("div",{class:"table-cell",key:l},[e.accessToken?(t(),$(g,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(b,l),habit:b,date:l,colour:b.colour,onUpdated:e.updateComponent,loading:e.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):S("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"])]),_:1})}const se=B(K,[["render",ne]]),ie=N({name:"HabitsView",components:{HabitGroup:se,HabitForm:V,HabitGroupForm:M},setup(){const e=f([]),o=f(!0),d=f(null),m=async()=>{o.value=!0;const _=W("https://api.rigelsystems.co.uk/daily_discipline/habit_groups","GET");try{const n=await _();console.log("data:",n),e.value=n}catch{d.value="Failed to fetch records"}o.value=!1};return q(async()=>{m()}),{habitGroups:e,fetchHabitGroups:m,loading:o,errorMessage:d}}}),re={class:"standard-container p-1"},le={class:"page-wrapper"},ce={key:0},de={key:1},ue={key:2},pe={key:3},be={class:"habit-table"},he={class:"horizontal-scroll"};function me(e,o,d,m,y,_){const n=s("n-button"),u=s("HabitGroupForm"),k=s("HabitForm"),g=s("HabitGroup");return t(),i(T,null,[p("div",re,[c(u,null,{trigger:r(({openDialog:a})=>[c(n,{onClick:a},{default:r(()=>o[0]||(o[0]=[w("New Habit Group")])),_:2},1032,["onClick"])]),_:1}),e.habitGroups.length>0?(t(),$(k,{key:0,onSave:e.fetchHabitGroups},{trigger:r(({openDialog:a})=>[c(n,{onClick:a},{default:r(()=>o[1]||(o[1]=[w("New Habit")])),_:2},1032,["onClick"])]),_:1},8,["onSave"])):S("",!0)]),p("div",le,[e.loading?(t(),i("div",ce,"Loading...")):e.errorMessage?(t(),i("div",de,F(e.errorMessage),1)):e.habitGroups.length===0?(t(),i("div",ue,"Create your first habit group.")):(t(),i("div",pe,[p("div",be,[p("div",he,[(t(!0),i(T,null,C(e.habitGroups,a=>(t(),i("div",{key:a.id,class:"table-habit-group"},[c(g,{habitGroup:a},null,8,["habitGroup"])]))),128))])])]))])],64)}const ke=B(ie,[["render",me]]);export{ke as default};
