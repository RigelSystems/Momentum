import{d as ue,R as Ne,as as ye,j as ke,r as K,k as se,b as c,at as Ve,A as we,E as Te,au as Ue,av as Ie,ag as Se,aw as J,ax as Ce,ay as Pe,p as Fe,D as De,aq as ne,g as o,az as j,F as H,a2 as $e,ar as ae,J as le,ak as Ee,aA as Ae,aB as He,ap as Ge,_ as re,e as S,w as P,f as y,o as k,V as xe,a as p,l as C,c as de,i as W,a0 as oe,aC as ie,t as X,h as Be,n as Re,s as Me}from"./index-CZJbcl6n.js";import{S as qe}from"./SelectIcon-DNiiuQ7M.js";const Oe=ue({name:"HabitForm",props:{habit:{type:Object,required:!1,default:()=>({name:"",colour:"#fff",icon:"",goal_condition:"No Goal"})}},emits:["save"],components:{RecordForm:Ne,SelectIcon:qe},setup(e,{emit:i}){const{isFeatureEnabled:u}=ye(),{accessToken:v}=ke(),h=K([]),f=b=>b%5===0,d=K(e.habit.habit_type||""),r=K([]);se(d,()=>{d.value==="Yes or No"?r.value=[{value:"No Goal",label:"No Goal"},{value:"Equals",label:"Equals"}]:r.value=[{value:"No Goal",label:"No Goal"},{value:"Equals",label:"Equals"},{value:"Greater than",label:"Greater than"},{value:"Less than",label:"Less than"},{value:"Anything",label:"Anything"},{value:"Not equals",label:"Not equals"},{value:"Not greater than",label:"Not greater than"},{value:"Not less than",label:"Not less than"}]},{immediate:!0});const w=c(()=>!!e.habit.id),U=c(()=>w.value?`https://api.rigelsystems.co.uk/daily_discipline//habits/${e.habit.id}`:"https://api.rigelsystems.co.uk/daily_discipline//habits"),g=c(()=>w.value?"PUT":"POST");return{isEditMode:w,accessToken:v,friendsUrl:"https://api.rigelsystems.co.uk/daily_discipline//friends/friends",habitGroupsUrl:"https://api.rigelsystems.co.uk/daily_discipline//habit_groups",habitTypesUrl:"https://api.rigelsystems.co.uk/daily_discipline//habits/types",goalConditionOptions:r,endpoint:U,method:g,handleSave:b=>{console.log("habit form handle save",b),window.location.reload(),i("save",b)},value:h,updateRecordIcon:b=>{e.habit.icon=b},updateHabitType:b=>{d.value=b},allowedMinutes:f,isFeatureEnabled:u}}}),ze=50,je=500;function Ke(e){let{toggleUpDown:i}=e,u=-1,v=-1;Ve(f);function h(r){f(),d(r),u=window.setTimeout(()=>{v=window.setInterval(()=>d(r),ze)},je)}function f(){window.clearTimeout(u),window.clearInterval(v)}function d(r){i(r==="up")}return{holdStart:h,holdStop:f}}const Le=Te({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},...Ae(He(),["modelValue","validationValue"])},"VNumberInput"),Ye=we()({name:"VNumberInput",props:{...Le()},emits:{"update:modelValue":e=>!0},setup(e,i){let{slots:u}=i;const v=K(),{holdStart:h,holdStop:f}=Ke({toggleUpDown:L}),d=Ue(e),r=c(()=>d.isDisabled.value||d.isReadonly.value),{isFocused:V,focus:w,blur:U}=Ie(e);function g(t){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.precision;const _=l==null?String(t):t.toFixed(l);return V.value?Number(_).toString():_}const s=Se(e,"modelValue",null,t=>t??null,t=>t==null?t??null:J(Number(t),e.min,e.max)),n=Ce(null);Pe(()=>{V.value&&!r.value||(s.value==null?n.value=null:isNaN(s.value)||(n.value=g(s.value)))});const a=c({get:()=>n.value,set(t){t===null||t===""?(s.value=null,n.value=null):!isNaN(Number(t))&&Number(t)<=e.max&&Number(t)>=e.min&&(s.value=Number(t),n.value=t)}}),G=c(()=>r.value?!1:(s.value??0)+e.step<=e.max),x=c(()=>r.value?!1:(s.value??0)-e.step>=e.min),m=c(()=>e.hideInput?"stacked":e.controlVariant),b=c(()=>m.value==="split"?"$plus":"$collapse"),Z=c(()=>m.value==="split"?"$minus":"$expand"),B=c(()=>m.value==="split"?"default":"small"),R=c(()=>m.value==="stacked"?"auto":"100%"),ce=c(()=>({props:{onClick:M,onPointerup:q,onPointerdown:ee}})),me=c(()=>({props:{onClick:M,onPointerup:q,onPointerdown:te}}));se(()=>e.precision,()=>fe()),Fe(()=>{Y()});function Q(t){if(t==null)return 0;const l=t.toString(),_=l.indexOf(".");return~_?l.length-_:0}function L(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(r.value)return;if(s.value==null){a.value=g(J(0,e.min,e.max));return}let l=Math.max(Q(s.value),Q(e.step));e.precision!=null&&(l=Math.max(l,e.precision)),t?G.value&&(a.value=g(s.value+e.step,l)):x.value&&(a.value=g(s.value-e.step,l))}function pe(t){var F,D,z,$;if(!t.data)return;const l=(F=t.target)==null?void 0:F.value,_=(D=t.target)==null?void 0:D.selectionStart,O=(z=t.target)==null?void 0:z.selectionEnd,I=l?l.slice(0,_)+t.data+l.slice(O):t.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(I)||t.preventDefault(),e.precision!=null&&((($=I.split(".")[1])==null?void 0:$.length)>e.precision&&t.preventDefault(),e.precision===0&&I.includes(".")&&t.preventDefault())}async function ve(t){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(t.key)||t.ctrlKey||["ArrowDown","ArrowUp"].includes(t.key)&&(t.preventDefault(),Y(),await Ge(),t.key==="ArrowDown"?L(!1):L())}function M(t){t.stopPropagation()}function q(t){const l=t.currentTarget;l==null||l.releasePointerCapture(t.pointerId),t.preventDefault(),t.stopPropagation(),f()}function ee(t){const l=t.currentTarget;l==null||l.setPointerCapture(t.pointerId),t.preventDefault(),t.stopPropagation(),h("up")}function te(t){const l=t.currentTarget;l==null||l.setPointerCapture(t.pointerId),t.preventDefault(),t.stopPropagation(),h("down")}function Y(){if(r.value||!v.value)return;const t=v.value.value;t&&!isNaN(Number(t))?a.value=g(J(Number(t),e.min,e.max)):a.value=null}function fe(){if(!r.value){if(s.value===null||isNaN(s.value)){a.value=null;return}a.value=e.precision==null?String(s.value):s.value.toFixed(e.precision)}}function be(){if(!r.value){if(s.value===null||isNaN(s.value)){a.value=null;return}a.value=s.value.toString()}}function he(){w(),be()}function ge(){U(),Y()}return De(()=>{const{modelValue:t,...l}=ne.filterProps(e);function _(){return u.increment?o(le,{key:"increment-defaults",defaults:{VBtn:{disabled:!G.value,flat:!0,height:R.value,size:B.value,icon:b.value}}},{default:()=>[u.increment(ce.value)]}):o(ae,{disabled:!G.value,flat:!0,key:"increment-btn",height:R.value,"data-testid":"increment","aria-hidden":"true",icon:b.value,onClick:M,onPointerup:q,onPointerdown:ee,size:B.value,tabindex:"-1"},null)}function O(){return u.decrement?o(le,{key:"decrement-defaults",defaults:{VBtn:{disabled:!x.value,flat:!0,height:R.value,size:B.value,icon:Z.value}}},{default:()=>[u.decrement(me.value)]}):o(ae,{disabled:!x.value,flat:!0,key:"decrement-btn",height:R.value,"data-testid":"decrement","aria-hidden":"true",icon:Z.value,size:B.value,tabindex:"-1",onClick:M,onPointerup:q,onPointerdown:te},null)}function I(){return o("div",{class:"v-number-input__control"},[O(),o(j,{vertical:m.value!=="stacked"},null),_()])}function F(){return!e.hideInput&&!e.inset?o(j,{vertical:!0},null):void 0}const D=m.value==="split"?o("div",{class:"v-number-input__control"},[o(j,{vertical:!0},null),_()]):e.reverse||m.value==="hidden"?void 0:o(H,null,[F(),I()]),z=u["append-inner"]||D,$=m.value==="split"?o("div",{class:"v-number-input__control"},[O(),o(j,{vertical:!0},null)]):e.reverse&&m.value!=="hidden"?o(H,null,[I(),F()]):void 0,_e=u["prepend-inner"]||$;return o(ne,$e({ref:v,modelValue:a.value,"onUpdate:modelValue":T=>a.value=T,validationValue:s.value,onBeforeinput:pe,onFocus:he,onBlur:ge,onKeydown:ve,class:["v-number-input",{"v-number-input--default":m.value==="default","v-number-input--hide-input":e.hideInput,"v-number-input--inset":e.inset,"v-number-input--reverse":e.reverse,"v-number-input--split":m.value==="split","v-number-input--stacked":m.value==="stacked"},e.class]},l,{style:e.style,inputmode:"decimal"}),{...u,"append-inner":z?function(){var A;for(var T=arguments.length,E=new Array(T),N=0;N<T;N++)E[N]=arguments[N];return o(H,null,[(A=u["append-inner"])==null?void 0:A.call(u,...E),D])}:void 0,"prepend-inner":_e?function(){var A;for(var T=arguments.length,E=new Array(T),N=0;N<T;N++)E[N]=arguments[N];return o(H,null,[$,(A=u["prepend-inner"])==null?void 0:A.call(u,...E)])}:void 0})}),Ee({},v)}}),Je={class:"n-modal__title"},We=["onUpdate:modelValue"],Xe=["onUpdate:modelValue"];function Ze(e,i,u,v,h,f){const d=y("NButton"),r=y("NTextInput"),V=y("NSelectInputFromRequest"),w=y("NColourPicker"),U=y("NSelect"),g=y("NTimeInput"),s=y("RecordForm");return k(),S(s,{record:e.habit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:P(({openDialog:n})=>[Be(e.$slots,"trigger",{openDialog:n},()=>[o(d,{label:e.isEditMode?"Edit Habit":"Add Habit"},null,8,["label"])])]),title:P(()=>[p("h2",Je,X(e.isEditMode?"Edit Habit":"Add New Habit"),1)]),form:P(({record:n})=>[o(xe,null,{default:P(()=>[i[5]||(i[5]=p("h1",null,"Details",-1)),o(r,{value:n.name,"onUpdate:value":a=>n.name=a,label:"Name"},null,8,["value","onUpdate:value"]),o(V,{url:e.habitGroupsUrl,valueKey:"id",name:"habit_group_id",label:"Habit Group",accessToken:e.accessToken,modelValue:n.habit_group_id,"onUpdate:modelValue":a=>n.habit_group_id=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(V,{url:e.habitTypesUrl,valueKey:"name",name:"habit_type",label:"Habit Type",accessToken:e.accessToken,modelValue:n.habit_type,"onUpdate:modelValue":[a=>n.habit_type=a,e.updateHabitType]},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(w,{modelValue:n.colour,"onUpdate:modelValue":a=>n.colour=a},null,8,["modelValue","onUpdate:modelValue"]),i[6]||(i[6]=p("h1",null,"Goal",-1)),o(U,{value:n.goal_condition,"onUpdate:value":a=>n.goal_condition=a,name:"goal_condition",label:"Goal Condition",options:e.goalConditionOptions},null,8,["value","onUpdate:value","options"]),n.goal_condition==="No Goal"||n.goal_condition==="Anything"||n.habit_type==="Yes or No"||!n.goal_condition?C("",!0):(k(),S(r,{key:0,value:n.goal_value,"onUpdate:value":a=>n.goal_value=a,label:"Goal Value"},null,8,["value","onUpdate:value"])),n.goal_condition==="Equals"&&n.habit_type==="Yes or No"?(k(),S(U,{key:1,value:n.goal_value,"onUpdate:value":a=>n.goal_value=a,name:"goal_value",label:"Goal value",options:[{value:"1",label:"Yes"}]},null,8,["value","onUpdate:value"])):C("",!0),e.isFeatureEnabled()?(k(),de(H,{key:2},[i[2]||(i[2]=p("h1",null,"Reminder",-1)),p("p",null,[i[0]||(i[0]=W("Would you like a reminder set for this habit? ")),oe(p("input",{type:"checkbox","onUpdate:modelValue":a=>n.wants_reminder=a},null,8,We),[[ie,n.wants_reminder]])]),n.wants_reminder||n.start_time?(k(),S(g,{key:0,label:"Select Time",value:n.start_time,"onUpdate:value":a=>n.start_time=a},null,8,["value","onUpdate:value"])):C("",!0),n.wants_reminder?(k(),S(Ye,{reverse:!1,controlVariant:"default",label:"Duration",hideInput:!1,inset:!1,key:"duration",name:"duration",modelValue:n.duration,"onUpdate:modelValue":a=>n.duration=a},null,8,["modelValue","onUpdate:modelValue"])):C("",!0),i[3]||(i[3]=p("h1",null,"Check-in",-1)),p("p",null,[i[1]||(i[1]=W("Would you like a check-in set for this habit? ")),oe(p("input",{type:"checkbox","onUpdate:modelValue":a=>n.wants_check_in=a},null,8,Xe),[[ie,n.wants_check_in]])]),n.wants_check_in||n.check_in_time?(k(),S(g,{key:2,label:"Select Time",value:n.check_in_time,"onUpdate:value":a=>n.check_in_time=a},null,8,["value","onUpdate:value"])):C("",!0),i[4]||(i[4]=p("h1",null,"Access",-1)),o(V,{url:e.friendsUrl,valueKey:"id",name:"role",label:"Select Users",accessToken:e.accessToken,modelValue:n.users_id,"onUpdate:modelValue":a=>n.users_id=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"])],64)):C("",!0)]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const Qe=re(Oe,[["render",Ze]]),et=ue({name:"Habit",props:{habit:{type:Object,required:!0},fetchHabits:{type:Function,required:!0}},components:{HabitForm:Qe}}),tt={class:"d-flex justify-space-start align-center"},nt=["onClick"],at=["href"];function lt(e,i,u,v,h,f){const d=y("HabitForm");return k(),de("div",tt,[o(d,{habit:e.habit,fetchHabits:e.fetchHabits},{trigger:P(({openDialog:r})=>[p("span",{class:"mdi mdi-pencil clickable",onClick:r},null,8,nt)]),_:1},8,["habit","fetchHabits"]),o(Re,{class:"mr-1"},{default:P(()=>[W("mdi-"+X(e.habit.icon),1)]),_:1}),p("div",null,[p("a",{href:`/#/habits/${e.habit.id}`},X(e.habit.name),9,at)])])}const ut=re(et,[["render",lt],["__scopeId","data-v-89222faf"]]);function st(e,i="GET",u=null){return async function(){const{getAccessTokenSilently:h}=Me(),f=await h(),d=await fetch(e,{method:i,headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:u?JSON.stringify(u):void 0});if(!d.ok)throw new Error(`API ${i} ${e} failed (${d.status})`);return d.json()}}export{ut as H,Qe as a,st as r};
