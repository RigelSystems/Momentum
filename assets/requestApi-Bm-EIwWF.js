import{d as ie,R as ge,j as Ve,r as ue,b as c,as as ke,B as _e,G as Ne,at as ye,au as we,ah as Te,av as L,aw as Ue,ax as Ie,k as Se,q as Pe,E as Ce,n as te,g as o,ay as M,F as G,a3 as $e,ar as W,K as ae,al as De,az as Fe,aA as Ae,aq as Ee,_ as se,e as $,w as T,f as _,o as w,V as He,a as v,l as q,i as J,a1 as le,aB as oe,t as X,h as xe,c as Be,p as Re,v as Me}from"./index-BclTkAu-.js";import{S as Ge}from"./SelectIcon-C7j0KoNK.js";const qe=ie({name:"HabitForm",props:{habit:{type:Object,required:!1,default:()=>({name:"",colour:"#fff",icon:""})}},emits:["save"],components:{RecordForm:ge,SelectIcon:Ge},setup(e,{emit:i}){const{accessToken:u}=Ve(),p=ue([]),h=t=>t%5===0,m=c(()=>!!e.habit.id),d=c(()=>m.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habits/${e.habit.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habits"),r=c(()=>m.value?"PUT":"POST");return{isEditMode:m,accessToken:u,friendsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//friends/friends",habitGroupsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups",habitTypesUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/types",goalConditionsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/goal_conditions",endpoint:d,method:r,handleSave:t=>{console.log("habit form handle save",t),window.location.reload(),i("save",t)},value:p,updateRecordIcon:t=>{e.habit.icon=t},allowedMinutes:h}}}),ze=50,Ke=500;function Oe(e){let{toggleUpDown:i}=e,u=-1,p=-1;ke(m);function h(r){m(),d(r),u=window.setTimeout(()=>{p=window.setInterval(()=>d(r),ze)},Ke)}function m(){window.clearTimeout(u),window.clearInterval(p)}function d(r){i(r==="up")}return{holdStart:h,holdStop:m}}const je=Ne({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},...Fe(Ae(),["modelValue","validationValue"])},"VNumberInput"),Le=_e()({name:"VNumberInput",props:{...je()},emits:{"update:modelValue":e=>!0},setup(e,i){let{slots:u}=i;const p=ue(),{holdStart:h,holdStop:m}=Oe({toggleUpDown:O}),d=ye(e),r=c(()=>d.isDisabled.value||d.isReadonly.value),{isFocused:k,focus:D,blur:F}=we(e);function g(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.precision;const b=l==null?String(n):n.toFixed(l);return k.value?Number(b).toString():b}const s=Te(e,"modelValue",null,n=>n??null,n=>n==null?n??null:L(Number(n),e.min,e.max)),a=Ue(null);Ie(()=>{k.value&&!r.value||(s.value==null?a.value=null:isNaN(s.value)||(a.value=g(s.value)))});const t=c({get:()=>a.value,set(n){n===null||n===""?(s.value=null,a.value=null):!isNaN(Number(n))&&Number(n)<=e.max&&Number(n)>=e.min&&(s.value=Number(n),a.value=n)}}),z=c(()=>r.value?!1:(s.value??0)+e.step<=e.max),K=c(()=>r.value?!1:(s.value??0)-e.step>=e.min),f=c(()=>e.hideInput?"stacked":e.controlVariant),Y=c(()=>f.value==="split"?"$plus":"$collapse"),Z=c(()=>f.value==="split"?"$minus":"$expand"),A=c(()=>f.value==="split"?"default":"small"),E=c(()=>f.value==="stacked"?"auto":"100%"),re=c(()=>({props:{onClick:H,onPointerup:x,onPointerdown:ee}})),de=c(()=>({props:{onClick:H,onPointerup:x,onPointerdown:ne}}));Se(()=>e.precision,()=>pe()),Pe(()=>{j()});function Q(n){if(n==null)return 0;const l=n.toString(),b=l.indexOf(".");return~b?l.length-b:0}function O(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(r.value)return;if(s.value==null){t.value=g(L(0,e.min,e.max));return}let l=Math.max(Q(s.value),Q(e.step));e.precision!=null&&(l=Math.max(l,e.precision)),n?z.value&&(t.value=g(s.value+e.step,l)):K.value&&(t.value=g(s.value-e.step,l))}function ce(n){var U,I,R,S;if(!n.data)return;const l=(U=n.target)==null?void 0:U.value,b=(I=n.target)==null?void 0:I.selectionStart,B=(R=n.target)==null?void 0:R.selectionEnd,y=l?l.slice(0,b)+n.data+l.slice(B):n.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(y)||n.preventDefault(),e.precision!=null&&(((S=y.split(".")[1])==null?void 0:S.length)>e.precision&&n.preventDefault(),e.precision===0&&y.includes(".")&&n.preventDefault())}async function me(n){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(n.key)||n.ctrlKey||["ArrowDown","ArrowUp"].includes(n.key)&&(n.preventDefault(),j(),await Ee(),n.key==="ArrowDown"?O(!1):O())}function H(n){n.stopPropagation()}function x(n){const l=n.currentTarget;l==null||l.releasePointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),m()}function ee(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),h("up")}function ne(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),h("down")}function j(){if(r.value||!p.value)return;const n=p.value.value;n&&!isNaN(Number(n))?t.value=g(L(Number(n),e.min,e.max)):t.value=null}function pe(){if(!r.value){if(s.value===null||isNaN(s.value)){t.value=null;return}t.value=e.precision==null?String(s.value):s.value.toFixed(e.precision)}}function fe(){if(!r.value){if(s.value===null||isNaN(s.value)){t.value=null;return}t.value=s.value.toString()}}function ve(){D(),fe()}function he(){F(),j()}return Ce(()=>{const{modelValue:n,...l}=te.filterProps(e);function b(){return u.increment?o(ae,{key:"increment-defaults",defaults:{VBtn:{disabled:!z.value,flat:!0,height:E.value,size:A.value,icon:Y.value}}},{default:()=>[u.increment(re.value)]}):o(W,{disabled:!z.value,flat:!0,key:"increment-btn",height:E.value,"data-testid":"increment","aria-hidden":"true",icon:Y.value,onClick:H,onPointerup:x,onPointerdown:ee,size:A.value,tabindex:"-1"},null)}function B(){return u.decrement?o(ae,{key:"decrement-defaults",defaults:{VBtn:{disabled:!K.value,flat:!0,height:E.value,size:A.value,icon:Z.value}}},{default:()=>[u.decrement(de.value)]}):o(W,{disabled:!K.value,flat:!0,key:"decrement-btn",height:E.value,"data-testid":"decrement","aria-hidden":"true",icon:Z.value,size:A.value,tabindex:"-1",onClick:H,onPointerup:x,onPointerdown:ne},null)}function y(){return o("div",{class:"v-number-input__control"},[B(),o(M,{vertical:f.value!=="stacked"},null),b()])}function U(){return!e.hideInput&&!e.inset?o(M,{vertical:!0},null):void 0}const I=f.value==="split"?o("div",{class:"v-number-input__control"},[o(M,{vertical:!0},null),b()]):e.reverse||f.value==="hidden"?void 0:o(G,null,[U(),y()]),R=u["append-inner"]||I,S=f.value==="split"?o("div",{class:"v-number-input__control"},[B(),o(M,{vertical:!0},null)]):e.reverse&&f.value!=="hidden"?o(G,null,[y(),U()]):void 0,be=u["prepend-inner"]||S;return o(te,$e({ref:p,modelValue:t.value,"onUpdate:modelValue":N=>t.value=N,validationValue:s.value,onBeforeinput:ce,onFocus:ve,onBlur:he,onKeydown:me,class:["v-number-input",{"v-number-input--default":f.value==="default","v-number-input--hide-input":e.hideInput,"v-number-input--inset":e.inset,"v-number-input--reverse":e.reverse,"v-number-input--split":f.value==="split","v-number-input--stacked":f.value==="stacked"},e.class]},l,{style:e.style,inputmode:"decimal"}),{...u,"append-inner":R?function(){var C;for(var N=arguments.length,P=new Array(N),V=0;V<N;V++)P[V]=arguments[V];return o(G,null,[(C=u["append-inner"])==null?void 0:C.call(u,...P),I])}:void 0,"prepend-inner":be?function(){var C;for(var N=arguments.length,P=new Array(N),V=0;V<N;V++)P[V]=arguments[V];return o(G,null,[S,(C=u["prepend-inner"])==null?void 0:C.call(u,...P)])}:void 0})}),De({},p)}}),We={class:"n-modal__title"},Je=["onUpdate:modelValue"],Xe=["onUpdate:modelValue"];function Ye(e,i,u,p,h,m){const d=_("NButton"),r=_("NTextInput"),k=_("NSelectInputFromRequest"),D=_("SelectIcon"),F=_("NColourPicker"),g=_("NTimeInput"),s=_("RecordForm");return w(),$(s,{record:e.habit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:T(({openDialog:a})=>[xe(e.$slots,"trigger",{openDialog:a},()=>[o(d,{label:e.isEditMode?"Edit Habit":"Add Habit"},null,8,["label"])])]),title:T(()=>[v("h2",We,X(e.isEditMode?"Edit Habit":"Add New Habit"),1)]),form:T(({record:a})=>[o(He,null,{default:T(()=>[i[2]||(i[2]=v("h1",null,"Details",-1)),o(r,{value:a.name,"onUpdate:value":t=>a.name=t,label:"Name"},null,8,["value","onUpdate:value"]),o(k,{url:e.habitGroupsUrl,valueKey:"id",name:"habit_group_id",label:"Habit Group",accessToken:e.accessToken,modelValue:a.habit_group_id,"onUpdate:modelValue":t=>a.habit_group_id=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(k,{url:e.habitTypesUrl,valueKey:"name",name:"habit_type",label:"Habit Type",accessToken:e.accessToken,modelValue:a.habit_type,"onUpdate:modelValue":t=>a.habit_type=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(D,{modelValue:a.icon,"onUpdate:modelValue":t=>a.icon=t,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"]),o(F,{modelValue:a.colour,"onUpdate:modelValue":t=>a.colour=t},null,8,["modelValue","onUpdate:modelValue"]),i[3]||(i[3]=v("h1",null,"Goal",-1)),o(k,{url:e.goalConditionsUrl,valueKey:"name",name:"goal_condition",label:"Goal Condition",accessToken:e.accessToken,modelValue:a.goal_condition,"onUpdate:modelValue":t=>a.goal_condition=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),a.goal_condition==="No Goal"||a.goal_condition==="Anything"?q("",!0):(w(),$(r,{key:0,value:a.goal_value,"onUpdate:value":t=>a.goal_value=t,label:"Goal Value"},null,8,["value","onUpdate:value"])),i[4]||(i[4]=v("h1",null,"Reminder",-1)),v("p",null,[i[0]||(i[0]=J("Would you like a reminder set for this habit? ")),le(v("input",{type:"checkbox","onUpdate:modelValue":t=>a.wants_reminder=t},null,8,Je),[[oe,a.wants_reminder]])]),a.wants_reminder||a.start_time?(w(),$(g,{key:1,label:"Select Time",value:a.start_time,"onUpdate:value":t=>a.start_time=t},null,8,["value","onUpdate:value"])):q("",!0),a.wants_reminder?(w(),$(Le,{reverse:!1,controlVariant:"default",label:"Duration",hideInput:!1,inset:!1,key:"duration",name:"duration",modelValue:a.duration,"onUpdate:modelValue":t=>a.duration=t},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),i[5]||(i[5]=v("h1",null,"Check-in",-1)),v("p",null,[i[1]||(i[1]=J("Would you like a check-in set for this habit? ")),le(v("input",{type:"checkbox","onUpdate:modelValue":t=>a.wants_check_in=t},null,8,Xe),[[oe,a.wants_check_in]])]),a.wants_check_in||a.check_in_time?(w(),$(g,{key:3,label:"Select Time",value:a.check_in_time,"onUpdate:value":t=>a.check_in_time=t},null,8,["value","onUpdate:value"])):q("",!0),i[6]||(i[6]=v("h1",null,"Access",-1)),o(k,{url:e.friendsUrl,valueKey:"id",name:"role",label:"Select Users",accessToken:e.accessToken,modelValue:a.users_id,"onUpdate:modelValue":t=>a.users_id=t},null,8,["url","accessToken","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const Ze=se(qe,[["render",Ye]]),Qe=ie({name:"Habit",props:{habit:{type:Object,required:!0},fetchHabits:{type:Function,required:!0}},components:{HabitForm:Ze}}),en={class:"d-flex justify-space-start align-center"},nn=["href"];function tn(e,i,u,p,h,m){const d=_("HabitForm");return w(),Be("div",en,[o(d,{habit:e.habit,fetchHabits:e.fetchHabits},{trigger:T(({openDialog:r})=>[o(W,{density:"default",icon:"mdi-dots-vertical",onClick:r,size:"x-small",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habit","fetchHabits"]),o(Re,{class:"mr-1"},{default:T(()=>[J("mdi-"+X(e.habit.icon),1)]),_:1}),v("div",null,[v("a",{href:`/#/habits/${e.habit.id}`},X(e.habit.name),9,nn)])])}const on=se(Qe,[["render",tn],["__scopeId","data-v-3761af0a"]]);function un(e,i="GET",u=null){return async function(){const{getAccessTokenSilently:h}=Me(),m=await h(),d=await fetch(e,{method:i,headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:u?JSON.stringify(u):void 0});if(!d.ok)throw new Error(`API ${i} ${e} failed (${d.status})`);return d.json()}}export{on as H,Ze as a,un as r};
