import{d as F,S as R,R as D,u as I,r as g,b as T,_ as w,e as M,w as c,f as _,o,g as i,V as A,h as C,a as d,t as y,i as j,j as B,k as U,l as q,m as N,c as s,F as k,n as V,p as L,q as z}from"./index-BjnAizGF.js";import{H as Y,g as S}from"./HabitEntry-CTRTb6SU.js";import{H as O,r as P}from"./Habit-CLSEmgBe.js";const X=F({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:D,SelectIcon:R},setup(e){I();const a=g([]),n=T(()=>!!e.habitGroup.id),u=T(()=>n.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),p=T(()=>n.value?"PUT":"POST");return{isEditMode:n,endpoint:u,method:p,handleSave:async r=>{window.location.reload()},value:a,updateRecordIcon:r=>{e.habitGroup.icon=r}}}});function J(e,a,n,u,p,h){const t=_("SelectIcon"),r=_("RecordForm");return o(),M(r,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:c(({openDialog:m})=>[j(e.$slots,"trigger",{openDialog:m},()=>[i(B,{color:"primary"},{default:c(()=>[U(y(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:c(()=>[d("span",null,y(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:c(({record:m})=>[i(A,null,{default:c(()=>[i(C,{modelValue:m.name,"onUpdate:modelValue":b=>m.name=b,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),i(t,{modelValue:m.icon,"onUpdate:modelValue":b=>m.icon=b,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const K=w(X,[["render",J]]),Q=F({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:K,HabitEntry:Y,Habit:O},setup(e){const a=S(30,"ddd<br>D"),n=S(30,"YYYY-MM-DD"),u=g([]),p=g(!0),h=g(null),t=async E=>{p.value=!0;const H=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,f=await fetch(H,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.value}`}});if(f.ok){const $=await f.json();u.value=$}else{const $=await f.json();h.value=$.error}p.value=!1},{getAccessTokenSilently:r,user:m}=q(),b=g(null),G=async()=>{b.value=await r()};return N(async()=>{await G(),t()}),{accessToken:b,habits:u,last30daysNiceFormat:a,last30days:n,loading:p,errorMessage:h,fetchHabits:t,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(E,H)=>E.habit_entries.find(f=>f.date===H)}}}),W={class:"table-group-name habit-group"},Z={class:"habit-group__name-wrapper"},x={class:"completion-percentages-container"},ee=["innerHTML"],oe={class:"table-habit-name"};function te(e,a,n,u,p,h){const t=_("HabitGroupForm"),r=_("Habit"),m=_("HabitEntry"),b=_("n-order-list"),G=_("n-dropdown");return o(),s(k,null,[U(y(e.errorMessage)+" ",1),i(G,null,{label:c(()=>[d("div",W,[d("div",Z,[d("h3",null,y(e.habitGroup.name),1),i(z,{class:"mr-2",size:"x-small"},{default:c(()=>[U("mdi-"+y(e.habitGroup.icon),1)]),_:1})]),i(t,{habitGroup:e.habitGroup},{trigger:c(({openDialog:l})=>[i(B,{density:"default",icon:"mdi-dots-vertical",onClick:l,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:c(()=>[d("div",x,[a[0]||(a[0]=d("div",{class:"table-habit-name"},null,-1)),(o(!0),s(k,null,V(e.last30daysNiceFormat,l=>(o(),s("small",{class:"table-cell",key:l},[d("span",{class:"table-date",innerHTML:l},null,8,ee)]))),128))]),i(b,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:c(l=>[d("div",oe,[i(r,{habit:l},null,8,["habit"])]),(o(!0),s(k,null,V(e.last30days,v=>(o(),s("div",{class:"table-cell",key:v},[e.accessToken?(o(),M(m,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(l,v),habit:l,date:v,colour:l.colour,onUpdated:e.fetchHabits,loading:e.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):L("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"])]),_:1})],64)}const ae=w(Q,[["render",te]]),se=F({name:"HabitsView",components:{HabitGroup:ae},setup(){const e=g([]),a=g(!0),n=g(null),u=async()=>{a.value=!0;const h=P("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const t=await h();console.log("data:",t),e.value=t}catch{n.value="Failed to fetch records"}a.value=!1};return N(async()=>{u()}),{habitGroups:e,loading:a,errorMessage:n}}}),ne={class:"page-wrapper"},re={key:0},ie={key:1},le={key:2},de={key:3},ce={class:"habit-table"},ue={class:"horizontal-scroll"};function pe(e,a,n,u,p,h){const t=_("HabitGroup");return o(),s("div",ne,[e.loading?(o(),s("div",re,"Loading...")):e.errorMessage?(o(),s("div",ie,y(e.errorMessage),1)):e.habitGroups.length===0?(o(),s("div",le,"No habits found")):(o(),s("div",de,[d("div",ce,[d("div",ue,[(o(!0),s(k,null,V(e.habitGroups,r=>(o(),s("div",{key:r.id,class:"table-habit-group"},[i(t,{habitGroup:r},null,8,["habitGroup"])]))),128))])])]))])}const _e=w(se,[["render",pe]]);export{_e as default};
