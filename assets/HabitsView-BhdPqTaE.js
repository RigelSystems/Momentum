import{d as C,S as j,R,u as A,r as G,b as T,_ as V,e as $,w as r,f as d,o as t,g as i,V as D,n as z,a as b,t as H,h as I,i as w,j as q,k as L,c as l,F,m as U,l as E,p as P,q as Y,s as O}from"./index-Qcscy6Fn.js";import{H as W,g as B}from"./HabitEntry-CJrxWhdf.js";import{H as X,a as N,r as J}from"./requestApi-B9OPKywd.js";const K=C({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:R,SelectIcon:j},setup(e){A();const o=G([]),u=T(()=>!!e.habitGroup.id),_=T(()=>u.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),y=T(()=>u.value?"PUT":"POST");return{isEditMode:u,endpoint:_,method:y,handleSave:async p=>{window.location.reload()},value:o,updateRecordIcon:p=>{e.habitGroup.icon=p}}}});function Q(e,o,u,_,y,g){const a=d("n-button"),p=d("SelectIcon"),v=d("RecordForm");return t(),$(v,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:r(({openDialog:n})=>[I(e.$slots,"trigger",{openDialog:n},()=>[i(a,{color:"primary"},{default:r(()=>[w(H(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:r(()=>[b("span",null,H(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:r(({record:n})=>[i(D,null,{default:r(()=>[i(z,{modelValue:n.name,"onUpdate:modelValue":s=>n.name=s,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),i(p,{modelValue:n.icon,"onUpdate:modelValue":s=>n.icon=s,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const M=V(K,[["render",Q]]),Z=C({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:M,HabitForm:N,HabitEntry:W,Habit:X},setup(e){const{accessToken:o}=q(),u=B(30,"ddd<br>D"),_=B(30,"YYYY-MM-DD"),y=G([]),g=G(!0),a=G(null),p=G({id:e.habitGroup.id,name:e.habitGroup.name,icon:e.habitGroup.icon,habits_with_goals_count:e.habitGroup.habits_with_goals_count,completed_today_count:e.habitGroup.completed_today_count}),v=async c=>{console.log("fetchHabitGroup",c);const k=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${c}`,m=await fetch(k,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.value}`}});if(console.log("response",m),m.ok){const f=await m.json();console.log("responseBody",f),p.value=f}else{const f=await m.json();a.value=f.error}},n=async c=>{console.log("fetchHabits",c),g.value=!0;const k=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,m=await fetch(k,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.value}`}});if(m.ok){const f=await m.json();y.value=f}else{const f=await m.json();a.value=f.error}g.value=!1},s=async()=>{console.log("updateComponent",e.habitGroup.id),v(e.habitGroup.id),n(e.habitGroup.id)};return L(o,c=>{c&&o.value&&n(e.habitGroup.id)},{immediate:!0}),{habitGroup:p,updateComponent:s,accessToken:o,habits:y,last30daysNiceFormat:u,last30days:_,loading:g,errorMessage:a,fetchHabits:n,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(c,k)=>c.habit_entries.find(m=>m.date===k)}}}),x={class:"table-group-name habit-group"},ee={class:"habit-group__name-wrapper"},oe={key:0,class:"p-1"},te={key:1,class:"completion-percentages-container"},ae=["innerHTML"],ne={class:"table-habit-name"};function se(e,o,u,_,y,g){const a=d("NCircleProgress"),p=d("HabitGroupForm"),v=d("Habit"),n=d("HabitEntry"),s=d("n-order-list"),S=d("n-dropdown");return t(),$(S,null,{label:r(()=>[b("div",x,[b("div",ee,[i(a,{current:e.habitGroup.completed_today_count,total:e.habitGroup.habits_with_goals_count,fontSize:35,size:30,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),b("h3",null,H(e.habitGroup.name),1),i(P,{class:"mr-2",size:"x-small"},{default:r(()=>[w("mdi-"+H(e.habitGroup.icon),1)]),_:1})]),i(p,{habitGroup:e.habitGroup},{trigger:r(({openDialog:h})=>[i(Y,{density:"default",icon:"mdi-dots-vertical",onClick:h,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:r(()=>[e.habits.length===0?(t(),l("p",oe,"Add your first habit to this group.")):(t(),l("div",te,[o[0]||(o[0]=b("div",{class:"table-habit-name"},null,-1)),(t(!0),l(F,null,U(e.last30daysNiceFormat,h=>(t(),l("small",{class:"table-cell",key:h},[b("span",{class:"table-date",innerHTML:h},null,8,ae)]))),128))])),i(s,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:r(h=>[b("div",ne,[i(v,{habit:h},null,8,["habit"])]),(t(!0),l(F,null,U(e.last30days,c=>(t(),l("div",{class:"table-cell",key:c},[e.accessToken?(t(),$(n,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(h,c),habit:h,date:c,colour:h.colour,onUpdated:e.updateComponent,loading:e.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):E("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"])]),_:1})}const ie=V(Z,[["render",se]]),re=C({name:"HabitsView",components:{HabitGroup:ie,HabitForm:N,HabitGroupForm:M},setup(){const e=G([]),o=G(!0),u=G(null),_=async()=>{o.value=!0;const g=J("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const a=await g();console.log("data:",a),e.value=a}catch{u.value="Failed to fetch records"}o.value=!1};return O(async()=>{_()}),{habitGroups:e,fetchHabitGroups:_,loading:o,errorMessage:u}}}),le={class:"standard-container p-1"},de={class:"page-wrapper"},ce={key:0},ue={key:1},pe={key:2},be={key:3},he={class:"habit-table"},me={class:"horizontal-scroll"};function _e(e,o,u,_,y,g){const a=d("n-button"),p=d("HabitGroupForm"),v=d("HabitForm"),n=d("HabitGroup");return t(),l(F,null,[b("div",le,[i(p,null,{trigger:r(({openDialog:s})=>[i(a,{onClick:s},{default:r(()=>o[0]||(o[0]=[w("New Habit Group")])),_:2},1032,["onClick"])]),_:1}),e.habitGroups.length>0?(t(),$(v,{key:0,onSaved:e.fetchHabitGroups},{trigger:r(({openDialog:s})=>[i(a,{onClick:s},{default:r(()=>o[1]||(o[1]=[w("New Habit")])),_:2},1032,["onClick"])]),_:1},8,["onSaved"])):E("",!0)]),b("div",de,[e.loading?(t(),l("div",ce,"Loading...")):e.errorMessage?(t(),l("div",ue,H(e.errorMessage),1)):e.habitGroups.length===0?(t(),l("div",pe,"Create your first habit group.")):(t(),l("div",be,[b("div",he,[b("div",me,[(t(!0),l(F,null,U(e.habitGroups,s=>(t(),l("div",{key:s.id,class:"table-habit-group"},[i(n,{habitGroup:s},null,8,["habitGroup"])]))),128))])])]))])],64)}const Ge=V(re,[["render",_e]]);export{Ge as default};
