import{d as B,S as R,R as Y,u as A,r as y,b as M,_ as C,e as T,w as n,f as c,o as t,g as a,V as I,h as L,a as o,t as k,i as z,j as V,k as E,c as s,l as q,P as O,U as X,m as J,n as K,p as Q,F as $,q as F,s as N,v as W}from"./index-DzFiuCIJ.js";import{H as Z,a as x}from"./Habit-Cn0YDPOQ.js";import{H as ee,g as j}from"./dateUtils-D8WPx2Ba.js";const te=B({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:Y,SelectIcon:R},setup(e){A();const d=y([]),i=M(()=>!!e.habitGroup.id),g=M(()=>i.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),v=M(()=>i.value?"PUT":"POST");return{isEditMode:i,endpoint:g,method:v,handleSave:async r=>{window.location.reload()},value:d,updateRecordIcon:r=>{e.habitGroup.icon=r}}}});function oe(e,d,i,g,v,h){const u=c("SelectIcon"),r=c("RecordForm");return t(),T(r,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:n(({openDialog:p})=>[z(e.$slots,"trigger",{openDialog:p},()=>[a(V,{color:"primary"},{default:n(()=>[E(k(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:n(()=>[o("span",null,k(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:n(({record:p})=>[a(I,null,{default:n(()=>[a(L,{modelValue:p.name,"onUpdate:modelValue":H=>p.name=H,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),a(u,{modelValue:p.icon,"onUpdate:modelValue":H=>p.icon=H,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const P=C(te,[["render",oe]]),ae=B({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:P}}),se={class:"table-group-name habit-group"},ne={class:"habit-group__name-wrapper"};function ie(e,d,i,g,v,h){const u=c("HabitGroupForm");return t(),s("div",se,[o("div",ne,[o("h3",null,k(e.habitGroup.name),1),a(q,{class:"mr-2",size:"x-small"},{default:n(()=>[E("mdi-"+k(e.habitGroup.icon),1)]),_:1})]),a(u,{habitGroup:e.habitGroup},{trigger:n(({openDialog:r})=>[a(V,{density:"default",icon:"mdi-dots-vertical",onClick:r,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])}const re=C(ae,[["render",ie]]),le=B({name:"HabitsView",components:{Habit:x,HabitForm:Z,HabitEntry:ee,HabitGroup:re,User:X,PageHeader:O,HabitGroupForm:P},setup(){const{getAccessTokenSilently:e,user:d}=J(),i=y(null),g=y([]),v=y([]),h=y(!0),u=y(null),r=y({}),p=K().format("YYYY-MM-DD"),H=j(30,"YYYY-MM-DD"),S=j(30,"ddd<br>D"),w=async()=>{const f=await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habits/get_habits",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.value}`}});if(f.ok){h.value=!1;const b=await f.json();r.value=b.completion_percentages,g.value=b.habits,console.log(r.value)}else{h.value=!1;const b=await f.json();u.value=b.error}},U=async()=>{console.log("accessToken",i.value);const f=await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.value}`}});if(f.ok){h.value=!1;const b=await f.json();v.value=b}else{h.value=!1;const b=await f.json();u.value=b.error}},D=(_,f)=>_.habit_entries.find(b=>b.date===f),m=_=>_===100,G=async()=>{i.value=await e()},l="https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update";return Q(async()=>{await G(),w(),U()}),{accessToken:i,user:d,groupedHabits:g,habitGroups:v,loading:h,errorMessage:u,lastSevenDays:H,completionPercentages:r,todaysDateFormatted:p,getHabitEntiryForDate:D,lastSevenDaysNice:S,fetchHabits:w,habitComplete:m,habitBulkUpdateUrl:l}}}),ce={class:"page-header"},de={class:"page-header-card shadow"},ue={class:"page-wrapper"},pe={key:0},me={key:1},be={key:2},he={key:3},_e={class:"habit-table"},fe={class:"horizontal-scroll"},ge={class:"completion-percentages-container"},ve=["innerHTML"],He={class:"table-habit-name"},ye={class:"mt-5 d-flex justify-space-start"};function ke(e,d,i,g,v,h){const u=c("PageHeader"),r=c("HabitGroup"),p=c("Habit"),H=c("HabitEntry"),S=c("n-order-list"),w=c("n-dropdown"),U=c("HabitForm"),D=c("HabitGroupForm");return t(),s($,null,[o("div",ce,[a(u,{title:"My Habits"}),o("div",de,[d[0]||(d[0]=o("h2",{class:"mb-3"},[o("b",null,"Progress")],-1)),(t(!0),s($,null,F(e.completionPercentages,(m,G)=>(t(),T(W,{color:"light-blue",height:"25","model-value":m[e.todaysDateFormatted],striped:""},{default:n(({value:l})=>[o("strong",null,k(G)+" "+k(Math.ceil(l))+"%",1)]),_:2},1032,["model-value"]))),256))])]),o("div",ue,[e.loading?(t(),s("div",pe,"Loading...")):e.errorMessage?(t(),s("div",me,k(e.errorMessage),1)):e.groupedHabits.length===0?(t(),s("div",be,"No habits found")):(t(),s("div",he,[o("div",_e,[o("div",fe,[(t(!0),s($,null,F(e.groupedHabits,(m,G)=>(t(),s("div",{key:G,class:"table-habit-group"},[a(w,null,{label:n(()=>[a(r,{habitGroup:m[0].habit_group},null,8,["habitGroup"])]),content:n(()=>[o("div",ge,[d[1]||(d[1]=o("div",{class:"table-habit-name"},null,-1)),(t(!0),s($,null,F(e.lastSevenDaysNice,l=>(t(),s("small",{class:"table-cell",key:l},[o("span",{class:"table-date",innerHTML:l},null,8,ve)]))),128))]),a(S,{class:"table-habit-tr",items:m,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:n(l=>[o("div",He,[a(p,{habit:l,fetchHabits:e.fetchHabits},null,8,["habit","fetchHabits"])]),(t(!0),s($,null,F(e.lastSevenDays,_=>(t(),s("div",{class:"table-cell",key:_},[e.accessToken?(t(),T(H,{key:0,entry:e.getHabitEntiryForDate(l,_),habit:l,date:_,colour:l.colour,fetchHabits:e.fetchHabits,accessToken:e.accessToken},null,8,["entry","habit","date","colour","fetchHabits","accessToken"])):N("",!0)]))),128))]),_:2},1032,["items","updateUrl","loading","accessToken"])]),_:2},1024)]))),128))])]),o("div",ye,[e.fetchHabits?(t(),T(U,{key:0,fetchHabits:e.fetchHabits},{trigger:n(({openDialog:m})=>[a(V,{density:"comfortable",variant:"tonal",text:"New Habit",class:"mr-2",onClick:m},null,8,["onClick"])]),_:1},8,["fetchHabits"])):N("",!0),a(D,null,{trigger:n(({openDialog:m})=>[a(V,{density:"comfortable",variant:"tonal",text:"New Habit Group",onClick:m},null,8,["onClick"])]),_:1})])]))])],64)}const Fe=C(le,[["render",ke]]);export{Fe as default};
