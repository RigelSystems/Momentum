import{d as F,P as M,s as S,r as y,v as B,k as P,p as V,_ as Y,c,a as l,g as i,f as m,w as p,F as d,m as u,o as n,n as x,l as f,e as k,t as h,i as A}from"./index-DSd1PwLk.js";import{H as R,r as I}from"./requestApi-BYihWYVQ.js";import{H as L,g as N}from"./HabitEntry-DqlcQDxu.js";import{V as O}from"./VBreadcrumbs-BSA3hyBe.js";import"./SelectIcon-CMcsiTzv.js";import"./ChecklistItemForm-C0NaTpaZ.js";const q=F({name:"HabitView",components:{PageHeader:M,HabitEntry:L,Habit:R},setup(){const o=N(365,"YYYY-MM-DD"),C=N(365,"ddd<br>D"),{getAccessTokenSilently:w,user:E}=S(),T=y(null),$=y(null),H=y(!0),b=y([{title:"Habits",disabled:!1,href:"/#/habits"}]),_=y({}),v=B(),g=y(v.params.id);P(()=>v.params.id,e=>{g.value=e}),V(async()=>{const e=`https://api.fordsdevelopment.co.uk/daily_discipline/habits/${g.value}`,a=I(e,"GET");try{const r=await a();console.log("Habit data:",r),_.value=r,console.log(r),b.value.push({title:r.name,disabled:!0,href:`/habits/${g}`})}catch{$.value="Failed to fetch records"}H.value=!1});const D=(e,a)=>e.habit_entries.find(r=>r.date===a),s=async()=>{T.value=await w()};V(async()=>{await s()});function t(e){if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}return{habit:_,breadcrumbs:b,lastSevenDays:o,lastSevenDaysNice:C,getHabitEntiryForDate:D,accessToken:T,getOrdinal:t}}}),z={class:"page-header"},G={class:"standard-container-3"},U={class:"standard-container-3"},W={class:"standard-container-3"},X={class:"standard-container-3"},j={class:"standard-container-3 calendar-yearly"},J={class:"calendar-month-title"},K={class:"calendar-days-header"},Q={class:"calendar-days-grid"},Z={class:"calendar-day-number"},ee={class:"calendar-month-stats"};function ae(o,C,w,E,T,$){const H=m("PageHeader"),b=m("n-tab"),_=m("NDashboardTile"),v=m("n-tab-panel"),g=m("n-tabs"),D=m("HabitEntry");return n(),c(d,null,[l("div",z,[i(H,{title:o.habit.name},null,8,["title"]),i(O,{items:o.breadcrumbs},{prepend:p(()=>[i(x,{icon:"$vuetify",size:"small"})]),_:1},8,["items"])]),i(g,null,{tabs:p(({activeTab:s,setActiveTab:t})=>[i(b,{label:"Totals",active:s===0,onClick:e=>t(0)},null,8,["active","onClick"]),i(b,{label:"Averages",active:s===1,onClick:e=>t(1)},null,8,["active","onClick"]),i(b,{label:"Changes",active:s===2,onClick:e=>t(2)},null,8,["active","onClick"]),i(b,{label:"Records",active:s===3,onClick:e=>t(3)},null,8,["active","onClick"])]),default:p(({activeTab:s})=>[i(v,{index:0,activeTab:s},{default:p(()=>{var t,e;return[l("div",G,[((e=(t=o.habit)==null?void 0:t.dashboard_data_totals)==null?void 0:e.length)>0?(n(!0),c(d,{key:0},u(o.habit.dashboard_data_totals,(a,r)=>(n(),k(_,{key:r,title:a.title,value:a.value,icon:a.icon,colour:a.colour,bottomText:a.bottomText},null,8,["title","value","icon","colour","bottomText"]))),128)):f("",!0)])]}),_:2},1032,["activeTab"]),i(v,{index:1,activeTab:s},{default:p(()=>{var t,e;return[l("div",U,[((e=(t=o.habit)==null?void 0:t.dashboard_data_averages)==null?void 0:e.length)>0?(n(!0),c(d,{key:0},u(o.habit.dashboard_data_averages,(a,r)=>(n(),k(_,{key:r,title:a.title,value:a.value,icon:a.icon,colour:a.colour,bottomText:a.bottomText},null,8,["title","value","icon","colour","bottomText"]))),128)):f("",!0)])]}),_:2},1032,["activeTab"]),i(v,{index:2,activeTab:s},{default:p(()=>{var t,e;return[l("div",W,[((e=(t=o.habit)==null?void 0:t.dashboard_data_changes)==null?void 0:e.length)>0?(n(!0),c(d,{key:0},u(o.habit.dashboard_data_changes,(a,r)=>(n(),k(_,{key:r,title:a.title,value:a.value,icon:a.icon,colour:a.colour,bottomText:a.bottomText},null,8,["title","value","icon","colour","bottomText"]))),128)):f("",!0)])]}),_:2},1032,["activeTab"]),i(v,{index:3,activeTab:s},{default:p(()=>{var t,e;return[l("div",X,[((e=(t=o.habit)==null?void 0:t.dashboard_data_records)==null?void 0:e.length)>0?(n(!0),c(d,{key:0},u(o.habit.dashboard_data_records,(a,r)=>(n(),k(_,{key:r,title:a.title,value:a.value,icon:a.icon,colour:a.colour,bottomText:a.bottomText},null,8,["title","value","icon","colour","bottomText"]))),128)):f("",!0)])]}),_:2},1032,["activeTab"])]),_:1}),l("div",j,[(n(!0),c(d,null,u(o.habit.monthly_data,s=>{var t;return n(),c("div",{key:s.month,class:"calendar-month-card"},[l("h4",J,h(s.month)+" "+h(s.year||((t=o.habit.created_at)==null?void 0:t.slice(0,4))),1),l("div",K,[(n(),c(d,null,u(["Su","Mo","Tu","We","Th","Fr","Sa"],e=>l("span",{key:e,class:"calendar-day-header"},h(e),1)),64))]),l("div",Q,[(n(!0),c(d,null,u(s.first_day_of_week,e=>(n(),c("span",{key:"empty-"+e,class:"calendar-day-cell empty"}))),128)),(n(!0),c(d,null,u(s.entries,e=>(n(),c("div",{key:e.id,class:"calendar-day-cell",style:{position:"relative"}},[l("span",Z,[A(h(new Date(e.date).getDate()),1),l("sup",null,h(o.getOrdinal(new Date(e.date).getDate())),1)]),o.accessToken?(n(),k(D,{key:0,entry:e.entry,habit:o.habit,date:e.date,colour:o.habit.colour,fetchHabits:o.fetchHabits,accessToken:o.accessToken},null,8,["entry","habit","date","colour","fetchHabits","accessToken"])):f("",!0)]))),128))]),l("div",ee,[l("p",null,"Total: "+h(s.total_entries),1),l("p",null,"Daily Average: "+h(s.daily_average),1),l("p",null,"Monthly Average: "+h(s.monthly_average),1)])])}),128))])],64)}const ce=Y(q,[["render",ae]]);export{ce as default};
