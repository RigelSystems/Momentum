import{d as w,S as B,R as D,u as I,r as f,b as $,_ as E,e as F,w as c,f as _,o as t,g as d,V as A,h as C,a as l,t as g,i as q,j as M,k as N,l as L,m as T,c as i,F as V,n as U,p as Y,q as j}from"./index-CeaCAxSM.js";import{H as z,g as S}from"./HabitEntry-B3rOd_Qg.js";import{H as O,r as R}from"./Habit-D_C2UBO6.js";const P=w({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:D,SelectIcon:B},setup(e){I();const a=f([]),s=$(()=>!!e.habitGroup.id),u=$(()=>s.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),p=$(()=>s.value?"PUT":"POST");return{isEditMode:s,endpoint:u,method:p,handleSave:async n=>{window.location.reload()},value:a,updateRecordIcon:n=>{e.habitGroup.icon=n}}}});function X(e,a,s,u,p,b){const o=_("SelectIcon"),n=_("RecordForm");return t(),F(n,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:c(({openDialog:m})=>[q(e.$slots,"trigger",{openDialog:m},()=>[d(M,{color:"primary"},{default:c(()=>[N(g(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:c(()=>[l("span",null,g(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:c(({record:m})=>[d(A,null,{default:c(()=>[d(C,{modelValue:m.name,"onUpdate:modelValue":h=>m.name=h,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),d(o,{modelValue:m.icon,"onUpdate:modelValue":h=>m.icon=h,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const J=E(P,[["render",X]]),K=w({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:J,HabitEntry:z,Habit:O},setup(e){const a=S(30,"ddd<br>D"),s=S(30,"YYYY-MM-DD"),u=f([]),p=f(!0),b=f(null),o=async()=>{p.value=!0;const H=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,G=R(H,"GET");try{const y=await G();console.log("data:",y),u.value=y}catch{b.value="Failed to fetch records"}p.value=!1},{getAccessTokenSilently:n,user:m}=L(),h=f(null),k=async()=>{h.value=await n()};return T(async()=>{await k()}),T(async()=>{o()}),{accessToken:h,habits:u,last30daysNiceFormat:a,last30days:s,loading:p,errorMessage:b,fetchHabits:o,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(H,G)=>H.habit_entries.find(y=>y.date===G)}}}),Q={class:"table-group-name habit-group"},W={class:"habit-group__name-wrapper"},Z={class:"completion-percentages-container"},x=["innerHTML"],ee={class:"table-habit-name"};function te(e,a,s,u,p,b){const o=_("HabitGroupForm"),n=_("Habit"),m=_("HabitEntry"),h=_("n-order-list"),k=_("n-dropdown");return t(),F(k,null,{label:c(()=>[l("div",Q,[l("div",W,[l("h3",null,g(e.habitGroup.name),1),d(j,{class:"mr-2",size:"x-small"},{default:c(()=>[N("mdi-"+g(e.habitGroup.icon),1)]),_:1})]),d(o,{habitGroup:e.habitGroup},{trigger:c(({openDialog:r})=>[d(M,{density:"default",icon:"mdi-dots-vertical",onClick:r,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:c(()=>[l("div",Z,[a[0]||(a[0]=l("div",{class:"table-habit-name"},null,-1)),(t(!0),i(V,null,U(e.last30daysNiceFormat,r=>(t(),i("small",{class:"table-cell",key:r},[l("span",{class:"table-date",innerHTML:r},null,8,x)]))),128))]),d(h,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:c(r=>[l("div",ee,[d(n,{habit:r},null,8,["habit"])]),(t(!0),i(V,null,U(e.last30days,v=>(t(),i("div",{class:"table-cell",key:v},[e.accessToken?(t(),F(m,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(r,v),habit:r,date:v,colour:r.colour,fetchHabits:e.fetchHabits},null,8,["accessToken","entry","habit","date","colour","fetchHabits"])):Y("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"])]),_:1})}const oe=E(K,[["render",te]]),ae=w({name:"HabitsView",components:{HabitGroup:oe},setup(){const e=f([]),a=f(!0),s=f(null),u=async()=>{a.value=!0;const b=R("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const o=await b();console.log("data:",o),e.value=o}catch{s.value="Failed to fetch records"}a.value=!1};return T(async()=>{u()}),{habitGroups:e,loading:a,errorMessage:s}}}),se={class:"page-wrapper"},ne={key:0},ie={key:1},re={key:2},le={key:3},ce={class:"habit-table"},de={class:"horizontal-scroll"};function ue(e,a,s,u,p,b){const o=_("HabitGroup");return t(),i("div",se,[e.loading?(t(),i("div",ne,"Loading...")):e.errorMessage?(t(),i("div",ie,g(e.errorMessage),1)):e.habitGroups.length===0?(t(),i("div",re,"No habits found")):(t(),i("div",le,[l("div",ce,[l("div",de,[(t(!0),i(V,null,U(e.habitGroups,n=>(t(),i("div",{key:n.id,class:"table-habit-group"},[d(o,{habitGroup:n},null,8,["habitGroup"])]))),128))])])]))])}const he=E(ae,[["render",ue]]);export{he as default};
