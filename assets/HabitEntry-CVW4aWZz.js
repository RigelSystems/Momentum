import{s as I,d as A,S as U,r as k,z as B,_ as j,c as i,n as m,A as V,g as a,w as n,B as g,F as N,f as q,o as u,C,D as $,h as M,E as T,j as v,G as D}from"./index-R_Z9bXlG.js";function L(e=1,t="YYYY-MM-DD"){return Array.from({length:e},(s,y)=>I().subtract(y,"day").format(t))}const F=A({name:"HabitEntry",props:{accessToken:{type:String,required:!1},entry:{type:Object,required:!1},habit:{type:Object,required:!0},date:{type:String,required:!0},colour:{type:String,required:!0},loading:{type:Boolean,required:!1}},components:{SelectIcon:U},setup(e,{emit:t}){var h;let s=!1,y=k(((h=e.entry)==null?void 0:h.value)||0);const f=async r=>{s=!0;const d=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries/${e.entry.id}`;return await fetch(d,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({value:r})})},b=async r=>(s=!0,await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({habit_id:e.habit.id,date:e.date,value:r})})),c=async r=>{s=!0;const d=e.entry?await f(r):await b(r);if(d.ok){s=!1;const p=await d.json();y.value=p.value,console.log("updated entry",p),t("updated")}else{s=!1;const p=await d.json();console.error(p)}};let o;const l=k(!1),w=()=>{o=setTimeout(()=>{l.value=!0},500)},E=()=>{clearTimeout(o)},H=r=>{r&&c(r)};return{entry:e.entry,updateEntry:c,loading:s,value:y,startHold:w,endHold:E,modalIsActive:l,updateRecordIcon:H}}}),S=B("v-spacer","div","VSpacer"),O={key:0},Y={key:1},z={key:2},P={key:3};function R(e,t,s,y,f,b){const c=q("SelectIcon");return u(),i(N,null,[e.loading?(u(),i("div",O,"Loading...")):m("",!0),e.habit.habit_type==="Yes or No"?(u(),i("div",Y,[e.value==="1"?(u(),i("button",{key:0,onClick:t[0]||(t[0]=o=>e.updateEntry("0")),class:"habit-entry habit-entry--check",style:V({backgroundColor:e.colour})},null,4)):(u(),i("button",{key:1,onClick:t[1]||(t[1]=o=>e.updateEntry("1")),class:"habit-entry habit-entry--close"}))])):m("",!0),e.habit.habit_type==="Numerical"?(u(),i("div",z,[a(g,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[4]||(t[4]=o=>e.modalIsActive=o),persistent:""},{activator:n(({props:o})=>[a(v,{onClick:t[2]||(t[2]=l=>e.updateEntry((parseInt(e.value)+1).toString())),onMousedown:e.startHold,onMouseup:e.endHold,onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",text:e.value||"-",variant:"flat",class:"habit-entry habit-entry--number",style:V(e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`})},null,8,["onMousedown","onMouseup","onTouchstart","onTouchend","text","style"])]),default:n(({isActive:o})=>[a(C,{title:`${e.habit.name}: ${e.date}`},{default:n(()=>[a($,null,{default:n(()=>[a(M,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value=l),label:"Value",type:"number"},null,8,["modelValue"])]),_:1}),a(T,null,{default:n(()=>[a(S),a(v,{text:"Update Entry",onClick:l=>{o.value=!1,e.updateEntry(e.value)}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):m("",!0),e.habit.habit_type==="Icon"?(u(),i("div",P,[a(g,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[6]||(t[6]=o=>e.modalIsActive=o),persistent:""},{activator:n(({props:o})=>[a(v,D(o,{onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",variant:"flat",class:`habit-entry habit-entry--number mdi mdi-${e.value}`,style:e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`}}),null,16,["onTouchstart","onTouchend","class","style"])]),default:n(({isActive:o})=>[a(C,{title:`${e.habit.name}: ${e.date}`},{default:n(()=>[a($,null,{default:n(()=>[a(c,{modelValue:e.value.value,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.value=l),onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate"])]),_:1}),a(T,null,{default:n(()=>[a(S),a(v,{text:"Update Entry",onClick:l=>o.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):m("",!0)],64)}const G=j(F,[["render",R]]);export{G as H,L as g};
