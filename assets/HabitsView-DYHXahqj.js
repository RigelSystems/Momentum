import{d as U,R as j,u as R,r as G,b as F,_ as C,e as H,w as d,f as r,o as a,g as l,V as A,n as D,a as b,t as k,h as z,i as $,j as I,k as q,c,F as w,m as T,l as E,p as L,q as P}from"./index-6bb5rSoQ.js";import{S as Y}from"./SelectIcon-CCaMDl7L.js";import{H as O,g as S}from"./HabitEntry-n0wseJHK.js";import{H as W,a as N,r as X}from"./requestApi-B18rqVHN.js";import"./ChecklistItemTask-BromNF02.js";const J=U({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:j,SelectIcon:Y},setup(o){R();const e=G([]),u=F(()=>!!o.habitGroup.id),h=F(()=>u.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${o.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),y=F(()=>u.value?"PUT":"POST");return{isEditMode:u,endpoint:h,method:y,handleSave:async p=>{window.location.reload()},value:e,updateRecordIcon:p=>{o.habitGroup.icon=p}}}});function K(o,e,u,h,y,_){const n=r("n-button"),p=r("SelectIcon"),v=r("RecordForm");return a(),H(v,{record:o.habitGroup,endpoint:o.endpoint,method:o.method,onSave:o.handleSave},{trigger:d(({openDialog:s})=>[z(o.$slots,"trigger",{openDialog:s},()=>[l(n,{color:"primary"},{default:d(()=>[$(k(o.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:d(()=>[b("span",null,k(o.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:d(({record:s})=>[l(A,null,{default:d(()=>[l(D,{modelValue:s.name,"onUpdate:modelValue":i=>s.name=i,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),l(p,{modelValue:s.icon,"onUpdate:modelValue":i=>s.icon=i,onUpdate:o.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const M=C(J,[["render",K]]),Q=U({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:M,HabitForm:N,HabitEntry:O,Habit:W},setup(o){const{accessToken:e}=I(),u=S(30,"ddd<br>D"),h=S(30,"YYYY-MM-DD"),y=G([]),_=G(!0),n=G(null),p=G({id:o.habitGroup.id,name:o.habitGroup.name,icon:o.habitGroup.icon,habits_with_goals_count:o.habitGroup.habits_with_goals_count,completed_today_count:o.habitGroup.completed_today_count}),v=async t=>{console.log("fetchHabitGroup",t);const g=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${t}`,m=await fetch(g,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.value}`}});if(console.log("response",m),m.ok){const f=await m.json();console.log("responseBody",f),p.value=f}else{const f=await m.json();n.value=f.error}},s=async t=>{console.log("fetchHabits",t),_.value=!0;const g=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${o.habitGroup.id}/habits`,m=await fetch(g,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.value}`}});if(m.ok){const f=await m.json();y.value=f}else{const f=await m.json();n.value=f.error}_.value=!1},i=async()=>{console.log("updateComponent",o.habitGroup.id),v(o.habitGroup.id),s(o.habitGroup.id)};return q(e,t=>{t&&e.value&&s(o.habitGroup.id)},{immediate:!0}),{habitGroup:p,updateComponent:i,accessToken:e,habits:y,last30daysNiceFormat:u,last30days:h,loading:_,errorMessage:n,fetchHabits:s,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(t,g)=>t.habit_entries.find(m=>m.date===g)}}}),Z={class:"table-group-name habit-group"},x={class:"habit-group__name-wrapper"},oo={key:0,class:"p-1"},eo={key:1,class:"completion-percentages-container"},to=["innerHTML"],ao={class:"table-habit-name"};function no(o,e,u,h,y,_){const n=r("NCircleProgress"),p=r("NButton"),v=r("HabitGroupForm"),s=r("Habit"),i=r("HabitEntry"),V=r("n-order-list"),B=r("n-dropdown");return a(),H(B,null,{label:d(()=>[b("div",Z,[b("div",x,[l(n,{current:o.habitGroup.completed_today_count,total:o.habitGroup.habits_with_goals_count,fontSize:35,size:30,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),b("h3",null,k(o.habitGroup.name),1),l(L,{class:"mr-2",size:"x-small"},{default:d(()=>[$("mdi-"+k(o.habitGroup.icon),1)]),_:1})]),l(v,{habitGroup:o.habitGroup},{trigger:d(({openDialog:t})=>[l(p,{icon:"mdi-dots-vertical",onClick:t,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:d(()=>[o.habits.length===0?(a(),c("p",oo,"Add your first habit to this group.")):(a(),c("div",eo,[e[0]||(e[0]=b("div",{class:"table-habit-name"},null,-1)),(a(!0),c(w,null,T(o.last30daysNiceFormat,t=>(a(),c("small",{class:"table-cell",key:t},[b("span",{class:"table-date",innerHTML:t},null,8,to)]))),128))])),l(V,{class:"table-habit-tr",items:o.habits,updateUrl:o.habitBulkUpdateUrl,loading:o.loading,accessToken:o.accessToken,modelName:"habits"},{default:d(t=>[b("div",ao,[l(s,{habit:t},null,8,["habit"])]),(a(!0),c(w,null,T(o.last30days,g=>(a(),c("div",{class:"table-cell",key:g},[o.accessToken?(a(),H(i,{key:0,accessToken:o.accessToken,entry:o.getHabitEntiryForDate(t,g),habit:t,date:g,colour:t.colour,onUpdated:o.updateComponent,loading:o.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):E("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"])]),_:1})}const so=C(Q,[["render",no]]),io=U({name:"HabitsView",components:{HabitGroup:so,HabitForm:N,HabitGroupForm:M},setup(){const o=G([]),e=G(!0),u=G(null),h=async()=>{e.value=!0;const _=X("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const n=await _();console.log("data:",n),o.value=n}catch{u.value="Failed to fetch records"}e.value=!1};return P(async()=>{h()}),{habitGroups:o,fetchHabitGroups:h,loading:e,errorMessage:u}}}),ro={class:"standard-container p-1"},lo={class:"page-wrapper"},co={key:0},uo={key:1},po={key:2},bo={key:3},mo={class:"habit-table"},ho={class:"horizontal-scroll"};function _o(o,e,u,h,y,_){const n=r("n-button"),p=r("HabitGroupForm"),v=r("HabitForm"),s=r("HabitGroup");return a(),c(w,null,[b("div",ro,[l(p,null,{trigger:d(({openDialog:i})=>[l(n,{onClick:i},{default:d(()=>e[0]||(e[0]=[$("New Habit Group")])),_:2},1032,["onClick"])]),_:1}),o.habitGroups.length>0?(a(),H(v,{key:0,onSaved:o.fetchHabitGroups},{trigger:d(({openDialog:i})=>[l(n,{onClick:i},{default:d(()=>e[1]||(e[1]=[$("New Habit")])),_:2},1032,["onClick"])]),_:1},8,["onSaved"])):E("",!0)]),b("div",lo,[o.loading?(a(),c("div",co,"Loading...")):o.errorMessage?(a(),c("div",uo,k(o.errorMessage),1)):o.habitGroups.length===0?(a(),c("div",po,"Create your first habit group.")):(a(),c("div",bo,[b("div",mo,[b("div",ho,[(a(!0),c(w,null,T(o.habitGroups,i=>(a(),c("div",{key:i.id,class:"table-habit-group"},[l(s,{habitGroup:i},null,8,["habitGroup"])]))),128))])])]))])],64)}const ko=C(io,[["render",_o]]);export{ko as default};
