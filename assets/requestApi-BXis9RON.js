import{d as ee,S as fe,Z as ve,R as be,k as he,r as ne,b as c,$ as ge,A as Ve,B as Ne,a0 as ke,a1 as ye,C as _e,a2 as j,a3 as Te,a4 as we,l as Ie,s as Ue,G as Se,h as Y,g as a,a5 as x,F as B,N as Pe,q as M,Q as W,H as Ce,a6 as $e,a7 as De,O as Fe,_ as te,e as Ae,w as k,f as N,o as ae,V as He,a as y,t as G,i as Ee,j as le,c as Re,p as xe,x as Be}from"./index-4F7Ld6lh.js";const Me=ee({name:"HabitForm",props:{habit:{type:Object,required:!1,default:()=>({name:"",colour:"#fff",icon:""})}},emits:["saved"],components:{RecordForm:be,SelectFromRequest:ve,SelectIcon:fe},setup(e,{emit:r}){const{accessToken:u}=he(),p=ne([]),v=s=>s%5===0,m=c(()=>!!e.habit.id),d=c(()=>m.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habits/${e.habit.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habits"),i=c(()=>m.value?"PUT":"POST");return{isEditMode:m,accessToken:u,friendsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//friends/friends",habitGroupsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups",habitTypesUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/types",goalConditionsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/goal_conditions",endpoint:d,method:i,handleSave:s=>{console.log("habit form handle save",s),window.location.reload(),r("saved",s)},value:p,updateRecordIcon:s=>{e.habit.icon=s},allowedMinutes:v}}}),Ge=50,qe=500;function Oe(e){let{toggleUpDown:r}=e,u=-1,p=-1;ge(m);function v(i){m(),d(i),u=window.setTimeout(()=>{p=window.setInterval(()=>d(i),Ge)},qe)}function m(){window.clearTimeout(u),window.clearInterval(p)}function d(i){r(i==="up")}return{holdStart:v,holdStop:m}}const ze=Ne({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},...$e(De(),["modelValue","validationValue"])},"VNumberInput"),Ke=Ve()({name:"VNumberInput",props:{...ze()},emits:{"update:modelValue":e=>!0},setup(e,r){let{slots:u}=r;const p=ne(),{holdStart:v,holdStop:m}=Oe({toggleUpDown:z}),d=ke(e),i=c(()=>d.isDisabled.value||d.isReadonly.value),{isFocused:T,focus:C,blur:$}=ye(e);function g(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.precision;const b=l==null?String(n):n.toFixed(l);return T.value?Number(b).toString():b}const t=_e(e,"modelValue",null,n=>n??null,n=>n==null?n??null:j(Number(n),e.min,e.max)),o=Te(null);we(()=>{T.value&&!i.value||(t.value==null?o.value=null:isNaN(t.value)||(o.value=g(t.value)))});const s=c({get:()=>o.value,set(n){n===null||n===""?(t.value=null,o.value=null):!isNaN(Number(n))&&Number(n)<=e.max&&Number(n)>=e.min&&(t.value=Number(n),o.value=n)}}),q=c(()=>i.value?!1:(t.value??0)+e.step<=e.max),O=c(()=>i.value?!1:(t.value??0)-e.step>=e.min),f=c(()=>e.hideInput?"stacked":e.controlVariant),L=c(()=>f.value==="split"?"$plus":"$collapse"),Z=c(()=>f.value==="split"?"$minus":"$expand"),D=c(()=>f.value==="split"?"default":"small"),F=c(()=>f.value==="stacked"?"auto":"100%"),oe=c(()=>({props:{onClick:A,onPointerup:H,onPointerdown:Q}})),ue=c(()=>({props:{onClick:A,onPointerup:H,onPointerdown:X}}));Ie(()=>e.precision,()=>se()),Ue(()=>{K()});function J(n){if(n==null)return 0;const l=n.toString(),b=l.indexOf(".");return~b?l.length-b:0}function z(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(i.value)return;if(t.value==null){s.value=g(j(0,e.min,e.max));return}let l=Math.max(J(t.value),J(e.step));e.precision!=null&&(l=Math.max(l,e.precision)),n?q.value&&(s.value=g(t.value+e.step,l)):O.value&&(s.value=g(t.value-e.step,l))}function ie(n){var w,I,R,U;if(!n.data)return;const l=(w=n.target)==null?void 0:w.value,b=(I=n.target)==null?void 0:I.selectionStart,E=(R=n.target)==null?void 0:R.selectionEnd,_=l?l.slice(0,b)+n.data+l.slice(E):n.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(_)||n.preventDefault(),e.precision!=null&&(((U=_.split(".")[1])==null?void 0:U.length)>e.precision&&n.preventDefault(),e.precision===0&&_.includes(".")&&n.preventDefault())}async function re(n){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(n.key)||n.ctrlKey||["ArrowDown","ArrowUp"].includes(n.key)&&(n.preventDefault(),K(),await Fe(),n.key==="ArrowDown"?z(!1):z())}function A(n){n.stopPropagation()}function H(n){const l=n.currentTarget;l==null||l.releasePointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),m()}function Q(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v("up")}function X(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v("down")}function K(){if(i.value||!p.value)return;const n=p.value.value;n&&!isNaN(Number(n))?s.value=g(j(Number(n),e.min,e.max)):s.value=null}function se(){if(!i.value){if(t.value===null||isNaN(t.value)){s.value=null;return}s.value=e.precision==null?String(t.value):t.value.toFixed(e.precision)}}function de(){if(!i.value){if(t.value===null||isNaN(t.value)){s.value=null;return}s.value=t.value.toString()}}function ce(){C(),de()}function me(){$(),K()}return Se(()=>{const{modelValue:n,...l}=Y.filterProps(e);function b(){return u.increment?a(W,{key:"increment-defaults",defaults:{VBtn:{disabled:!q.value,flat:!0,height:F.value,size:D.value,icon:L.value}}},{default:()=>[u.increment(oe.value)]}):a(M,{disabled:!q.value,flat:!0,key:"increment-btn",height:F.value,"data-testid":"increment","aria-hidden":"true",icon:L.value,onClick:A,onPointerup:H,onPointerdown:Q,size:D.value,tabindex:"-1"},null)}function E(){return u.decrement?a(W,{key:"decrement-defaults",defaults:{VBtn:{disabled:!O.value,flat:!0,height:F.value,size:D.value,icon:Z.value}}},{default:()=>[u.decrement(ue.value)]}):a(M,{disabled:!O.value,flat:!0,key:"decrement-btn",height:F.value,"data-testid":"decrement","aria-hidden":"true",icon:Z.value,size:D.value,tabindex:"-1",onClick:A,onPointerup:H,onPointerdown:X},null)}function _(){return a("div",{class:"v-number-input__control"},[E(),a(x,{vertical:f.value!=="stacked"},null),b()])}function w(){return!e.hideInput&&!e.inset?a(x,{vertical:!0},null):void 0}const I=f.value==="split"?a("div",{class:"v-number-input__control"},[a(x,{vertical:!0},null),b()]):e.reverse||f.value==="hidden"?void 0:a(B,null,[w(),_()]),R=u["append-inner"]||I,U=f.value==="split"?a("div",{class:"v-number-input__control"},[E(),a(x,{vertical:!0},null)]):e.reverse&&f.value!=="hidden"?a(B,null,[_(),w()]):void 0,pe=u["prepend-inner"]||U;return a(Y,Pe({ref:p,modelValue:s.value,"onUpdate:modelValue":V=>s.value=V,validationValue:t.value,onBeforeinput:ie,onFocus:ce,onBlur:me,onKeydown:re,class:["v-number-input",{"v-number-input--default":f.value==="default","v-number-input--hide-input":e.hideInput,"v-number-input--inset":e.inset,"v-number-input--reverse":e.reverse,"v-number-input--split":f.value==="split","v-number-input--stacked":f.value==="stacked"},e.class]},l,{style:e.style,inputmode:"decimal"}),{...u,"append-inner":R?function(){var P;for(var V=arguments.length,S=new Array(V),h=0;h<V;h++)S[h]=arguments[h];return a(B,null,[(P=u["append-inner"])==null?void 0:P.call(u,...S),I])}:void 0,"prepend-inner":pe?function(){var P;for(var V=arguments.length,S=new Array(V),h=0;h<V;h++)S[h]=arguments[h];return a(B,null,[U,(P=u["prepend-inner"])==null?void 0:P.call(u,...S)])}:void 0})}),Ce({},p)}}),je={class:"n-modal__title"};function Le(e,r,u,p,v,m){const d=N("NTextInput"),i=N("NSelectInputFromRequest"),T=N("SelectIcon"),C=N("NColourPicker"),$=N("NTimeInput"),g=N("RecordForm");return ae(),Ae(g,{record:e.habit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:k(({openDialog:t})=>[Ee(e.$slots,"trigger",{openDialog:t},()=>[a(M,{color:"primary"},{default:k(()=>[le(G(e.isEditMode?"Edit Habit":"Add Habit"),1)]),_:1})])]),title:k(()=>[y("h2",je,G(e.isEditMode?"Edit Habit":"Add New Habit"),1)]),form:k(({record:t})=>[a(He,null,{default:k(()=>[r[0]||(r[0]=y("h1",null,"Details",-1)),a(d,{value:t.name,"onUpdate:value":o=>t.name=o,label:"Name",required:""},null,8,["value","onUpdate:value"]),a(i,{url:e.habitGroupsUrl,valueKey:"id",name:"habit_group_id",label:"Habit Group",accessToken:e.accessToken,modelValue:t.habit_group_id,"onUpdate:modelValue":o=>t.habit_group_id=o},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),a(i,{url:e.habitTypesUrl,valueKey:"name",name:"habit_type",label:"Habit Type",accessToken:e.accessToken,modelValue:t.habit_type,"onUpdate:modelValue":o=>t.habit_type=o},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),a(T,{modelValue:t.icon,"onUpdate:modelValue":o=>t.icon=o,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"]),a(C,{modelValue:t.colour,"onUpdate:modelValue":o=>t.colour=o},null,8,["modelValue","onUpdate:modelValue"]),r[1]||(r[1]=y("h1",null,"Goal",-1)),a(i,{url:e.goalConditionsUrl,valueKey:"name",name:"goal_condition",label:"Goal Condition",accessToken:e.accessToken,modelValue:t.goal_condition,"onUpdate:modelValue":o=>t.goal_condition=o},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),a(d,{value:t.goal_value,"onUpdate:value":o=>t.goal_value=o,label:"Goal Value"},null,8,["value","onUpdate:value"]),r[2]||(r[2]=y("h1",null,"Reminder",-1)),a($,{label:"Select Time",value:t.start_time,"onUpdate:value":o=>t.start_time=o},null,8,["value","onUpdate:value"]),a(Ke,{reverse:!1,controlVariant:"default",label:"Duration",hideInput:!1,inset:!1,key:"duration",name:"duration",modelValue:t.duration,"onUpdate:modelValue":o=>t.duration=o},null,8,["modelValue","onUpdate:modelValue"]),r[3]||(r[3]=y("h1",null,"Access",-1)),a(i,{url:e.friendsUrl,valueKey:"id",name:"role",label:"Select Users",accessToken:e.accessToken,modelValue:t.users_id,"onUpdate:modelValue":o=>t.users_id=o},null,8,["url","accessToken","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const Ze=te(Me,[["render",Le]]),Je=ee({name:"Habit",props:{habit:{type:Object,required:!0},fetchHabits:{type:Function,required:!0}},components:{HabitForm:Ze}}),Qe={class:"d-flex justify-space-start align-center"},Xe=["href"];function Ye(e,r,u,p,v,m){const d=N("HabitForm");return ae(),Re("div",Qe,[a(d,{habit:e.habit,fetchHabits:e.fetchHabits},{trigger:k(({openDialog:i})=>[a(M,{density:"default",icon:"mdi-dots-vertical",onClick:i,size:"x-small",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habit","fetchHabits"]),a(xe,{class:"mr-1"},{default:k(()=>[le("mdi-"+G(e.habit.icon),1)]),_:1}),y("div",null,[y("a",{href:`/#/habits/${e.habit.id}`},G(e.habit.name),9,Xe)])])}const en=te(Je,[["render",Ye],["__scopeId","data-v-3761af0a"]]);function nn(e,r="GET",u=null){return async function(){const{getAccessTokenSilently:v}=Be(),m=await v(),d=await fetch(e,{method:r,headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:u?JSON.stringify(u):void 0});if(!d.ok)throw new Error(`API ${r} ${e} failed (${d.status})`);return d.json()}}export{en as H,Ze as a,nn as r};
