import{d as B,S as D,R as z,u as I,r as g,b as C,_ as E,e as w,w as l,f as d,o as t,g as a,V as q,h as L,a as u,t as H,i as P,j as F,k as j,l as Y,m as A,c as i,n as N,F as T,p as V,q as O}from"./index-R_Z9bXlG.js";import{H as W,g as M}from"./HabitEntry-CVW4aWZz.js";import{H as X,a as J,r as K}from"./Habit-cVGDdsgZ.js";const Q=B({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:z,SelectIcon:D},setup(e){I();const r=g([]),c=C(()=>!!e.habitGroup.id),p=C(()=>c.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),m=C(()=>c.value?"PUT":"POST");return{isEditMode:c,endpoint:p,method:m,handleSave:async b=>{window.location.reload()},value:r,updateRecordIcon:b=>{e.habitGroup.icon=b}}}});function Z(e,r,c,p,m,_){const n=d("SelectIcon"),b=d("RecordForm");return t(),w(b,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:l(({openDialog:o})=>[P(e.$slots,"trigger",{openDialog:o},()=>[a(F,{color:"primary"},{default:l(()=>[j(H(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:l(()=>[u("span",null,H(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:l(({record:o})=>[a(q,null,{default:l(()=>[a(L,{modelValue:o.name,"onUpdate:modelValue":f=>o.name=f,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),a(n,{modelValue:o.icon,"onUpdate:modelValue":f=>o.icon=f,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const R=E(Q,[["render",Z]]),x=B({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:R,HabitForm:J,HabitEntry:W,Habit:X},setup(e){const r=M(30,"ddd<br>D"),c=M(30,"YYYY-MM-DD"),p=g([]),m=g(!0),_=g(null),n=g({id:e.habitGroup.id,name:e.habitGroup.name,icon:e.habitGroup.icon,habits_with_goals_count:e.habitGroup.habits_with_goals_count,completed_today_count:e.habitGroup.completed_today_count}),b=async k=>{console.log("fetchHabitGroup",k);const G=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${k}`,h=await fetch(G,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.value}`}});if(console.log("response",h),h.ok){const y=await h.json();console.log("responseBody",y),n.value=y}else{const y=await h.json();_.value=y.error}},o=async k=>{console.log("fetchHabits",k),m.value=!0;const G=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups/${e.habitGroup.id}/habits`,h=await fetch(G,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.value}`}});if(h.ok){const y=await h.json();p.value=y}else{const y=await h.json();_.value=y.error}m.value=!1},f=async()=>{console.log("updateComponent",e.habitGroup.id),b(e.habitGroup.id),o(e.habitGroup.id)},{getAccessTokenSilently:U,user:S}=Y(),v=g(null),s=async()=>{v.value=await U()};return A(async()=>{await s(),o()}),{habitGroup:n,updateComponent:f,accessToken:v,habits:p,last30daysNiceFormat:r,last30days:c,loading:m,errorMessage:_,fetchHabits:o,habitBulkUpdateUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update",getHabitEntiryForDate:(k,G)=>k.habit_entries.find(h=>h.date===G)}}}),ee={class:"table-group-name habit-group"},oe={class:"habit-group__name-wrapper"},te={key:0,class:"p-1"},ae={key:1,class:"completion-percentages-container"},ne=["innerHTML"],se={class:"table-habit-name"};function ie(e,r,c,p,m,_){const n=d("NCircleProgress"),b=d("HabitGroupForm"),o=d("Habit"),f=d("HabitEntry"),U=d("n-order-list"),S=d("HabitForm"),v=d("n-dropdown");return t(),w(v,null,{label:l(()=>[u("div",ee,[u("div",oe,[a(n,{current:e.habitGroup.completed_today_count,total:e.habitGroup.habits_with_goals_count,fontSize:35,size:30,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),u("h3",null,H(e.habitGroup.name),1),a(O,{class:"mr-2",size:"x-small"},{default:l(()=>[j("mdi-"+H(e.habitGroup.icon),1)]),_:1})]),a(b,{habitGroup:e.habitGroup},{trigger:l(({openDialog:s})=>[a(F,{density:"default",icon:"mdi-dots-vertical",onClick:s,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])]),content:l(()=>[e.habits.length===0?(t(),i("p",te,"Add your first habit to this group.")):(t(),i("div",ae,[r[0]||(r[0]=u("div",{class:"table-habit-name"},null,-1)),(t(!0),i(T,null,V(e.last30daysNiceFormat,s=>(t(),i("small",{class:"table-cell",key:s},[u("span",{class:"table-date",innerHTML:s},null,8,ne)]))),128))])),a(U,{class:"table-habit-tr",items:e.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:l(s=>[u("div",se,[a(o,{habit:s},null,8,["habit"])]),(t(!0),i(T,null,V(e.last30days,$=>(t(),i("div",{class:"table-cell",key:$},[e.accessToken?(t(),w(f,{key:0,accessToken:e.accessToken,entry:e.getHabitEntiryForDate(s,$),habit:s,date:$,colour:s.colour,onUpdated:e.updateComponent,loading:e.loading},null,8,["accessToken","entry","habit","date","colour","onUpdated","loading"])):N("",!0)]))),128))]),_:1},8,["items","updateUrl","loading","accessToken"]),e.fetchHabits?(t(),w(S,{key:2,fetchHabits:e.fetchHabits},{trigger:l(({openDialog:s})=>[a(F,{density:"comfortable",variant:"tonal",text:"New Habit",onClick:s},null,8,["onClick"])]),_:1},8,["fetchHabits"])):N("",!0)]),_:1})}const re=E(x,[["render",ie]]),le=B({name:"HabitsView",components:{HabitGroup:re,HabitGroupForm:R},setup(){const e=g([]),r=g(!0),c=g(null),p=async()=>{r.value=!0;const _=K("https://api.fordsdevelopment.co.uk/daily_discipline/habit_groups","GET");try{const n=await _();console.log("data:",n),e.value=n}catch{c.value="Failed to fetch records"}r.value=!1};return A(async()=>{p()}),{habitGroups:e,fetchHabitGroups:p,loading:r,errorMessage:c}}}),ce={class:"p-1"},de={class:"page-wrapper"},ue={key:0},pe={key:1},be={key:2},he={key:3},me={class:"habit-table"},_e={class:"horizontal-scroll"};function ge(e,r,c,p,m,_){const n=d("HabitGroupForm"),b=d("HabitGroup");return t(),i(T,null,[u("div",ce,[a(n,null,{trigger:l(({openDialog:o})=>[a(F,{density:"comfortable",variant:"tonal",text:"New Habit Group",onClick:o},null,8,["onClick"])]),_:1})]),u("div",de,[e.loading?(t(),i("div",ue,"Loading...")):e.errorMessage?(t(),i("div",pe,H(e.errorMessage),1)):e.habitGroups.length===0?(t(),i("div",be,"Create your first habit group.")):(t(),i("div",he,[u("div",me,[u("div",_e,[(t(!0),i(T,null,V(e.habitGroups,o=>(t(),i("div",{key:o.id,class:"table-habit-group"},[a(b,{habitGroup:o},null,8,["habitGroup"])]))),128))])])]))])],64)}const Ge=E(le,[["render",ge]]);export{Ge as default};
