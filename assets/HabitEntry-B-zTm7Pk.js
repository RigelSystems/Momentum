import{s as D,d as L,S as F,r as C,z as N,A as O,B as M,C as R,D as j,I as q,x as $,E as z,G as Y,H as W,J,K as X,L as S,M as k,f as n,N as G,O as K,Q,_ as Z,c as p,m as V,T as w,w as f,U as A,W as I,V as x,X as P,p as E,g as _,F as ee,o as h}from"./index-BSkj9F-8.js";function ie(e=1,t="YYYY-MM-DD"){return Array.from({length:e},(i,c)=>D().subtract(c,"day").format(t))}const te=L({name:"HabitEntry",props:{accessToken:{type:String,required:!1},entry:{type:Object,required:!1},habit:{type:Object,required:!0},date:{type:String,required:!0},colour:{type:String,required:!0},loading:{type:Boolean,required:!1}},components:{SelectIcon:F},setup(e,{emit:t}){var m;let i=!1,c=C(((m=e.entry)==null?void 0:m.value)||0);const y=async o=>{i=!0;const u=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries/${e.entry.id}`;return await fetch(u,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({value:o})})},g=async o=>(i=!0,await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({habit_id:e.habit.id,date:e.date,value:o})})),l=async o=>{i=!0;const u=e.entry?await y(o):await g(o);if(u.ok){i=!1;const r=await u.json();c.value=r.value,console.log("updated entry",r),t("updated")}else{i=!1;const r=await u.json();console.error(r)}};let a;const d=C(!1),T=()=>{a=setTimeout(()=>{d.value=!0},500)},s=()=>{clearTimeout(a)},v=o=>{o&&l(o)};return{entry:e.entry,updateEntry:l,loading:i,value:c,startHold:T,endHold:s,modalIsActive:d,updateRecordIcon:v}}}),ae=O({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...W({origin:"center center",scrollStrategy:"block",transition:{component:J},zIndex:2400})},"VDialog"),H=N()({name:"VDialog",props:ae(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,t){let{emit:i,slots:c}=t;const y=M(e,"modelValue"),{scopeId:g}=R(),l=C();function a(s){var o,u;const v=s.relatedTarget,m=s.target;if(v!==m&&((o=l.value)!=null&&o.contentEl)&&((u=l.value)!=null&&u.globalTop)&&![document,l.value.contentEl].includes(m)&&!l.value.contentEl.contains(m)){const r=X(l.value.contentEl);if(!r.length)return;const b=r[0],U=r[r.length-1];v===b?U.focus():b.focus()}}j(()=>{document.removeEventListener("focusin",a)}),q&&$(()=>y.value&&e.retainFocus,s=>{s?document.addEventListener("focusin",a):document.removeEventListener("focusin",a)},{immediate:!0});function d(){var s;i("afterEnter"),(s=l.value)!=null&&s.contentEl&&!l.value.contentEl.contains(document.activeElement)&&l.value.contentEl.focus({preventScroll:!0})}function T(){i("afterLeave")}return $(y,async s=>{var v;s||(await G(),(v=l.value.activatorEl)==null||v.focus({preventScroll:!0}))}),z(()=>{const s=S.filterProps(e),v=k({"aria-haspopup":"dialog"},e.activatorProps),m=k({tabindex:-1},e.contentProps);return n(S,k({ref:l,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},s,{modelValue:y.value,"onUpdate:modelValue":o=>y.value=o,"aria-modal":"true",activatorProps:v,contentProps:m,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:d,onAfterLeave:T},g),{activator:c.activator,default:function(){for(var o=arguments.length,u=new Array(o),r=0;r<o;r++)u[r]=arguments[r];return n(K,{root:"VDialog"},{default:()=>{var b;return[(b=c.default)==null?void 0:b.call(c,...u)]}})}})}),Y({},l)}}),B=Q("v-spacer","div","VSpacer"),ne={key:0},oe={key:1},le={key:2},re={key:3};function se(e,t,i,c,y,g){const l=_("SelectIcon");return h(),p(ee,null,[e.loading?(h(),p("div",ne,"Loading...")):V("",!0),e.habit.habit_type==="Yes or No"?(h(),p("div",oe,[e.value==="1"?(h(),p("button",{key:0,onClick:t[0]||(t[0]=a=>e.updateEntry("0")),class:"habit-entry habit-entry--check",style:w({backgroundColor:e.colour})},null,4)):(h(),p("button",{key:1,onClick:t[1]||(t[1]=a=>e.updateEntry("1")),class:"habit-entry habit-entry--close"}))])):V("",!0),e.habit.habit_type==="Numerical"?(h(),p("div",le,[n(H,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[4]||(t[4]=a=>e.modalIsActive=a),persistent:""},{activator:f(({props:a})=>[n(E,{onClick:t[2]||(t[2]=d=>e.updateEntry((parseInt(e.value)+1).toString())),onMousedown:e.startHold,onMouseup:e.endHold,onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",text:e.value||"-",variant:"flat",class:"habit-entry habit-entry--number",style:w(e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`})},null,8,["onMousedown","onMouseup","onTouchstart","onTouchend","text","style"])]),default:f(({isActive:a})=>[n(A,{title:`${e.habit.name}: ${e.date}`},{default:f(()=>[n(I,null,{default:f(()=>[n(x,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=d=>e.value=d),label:"Value",type:"number"},null,8,["modelValue"])]),_:1}),n(P,null,{default:f(()=>[n(B),n(E,{text:"Update Entry",onClick:d=>{a.value=!1,e.updateEntry(e.value)}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):V("",!0),e.habit.habit_type==="Icon"?(h(),p("div",re,[n(H,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[6]||(t[6]=a=>e.modalIsActive=a),persistent:""},{activator:f(({props:a})=>[n(E,k(a,{onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",variant:"flat",class:`habit-entry habit-entry--number mdi mdi-${e.value}`,style:e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`}}),null,16,["onTouchstart","onTouchend","class","style"])]),default:f(({isActive:a})=>[n(A,{title:`${e.habit.name}: ${e.date}`},{default:f(()=>[n(I,null,{default:f(()=>[n(l,{modelValue:e.value.value,"onUpdate:modelValue":t[5]||(t[5]=d=>e.value.value=d),onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate"])]),_:1}),n(P,null,{default:f(()=>[n(B),n(E,{text:"Update Entry",onClick:d=>a.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):V("",!0)],64)}const de=Z(te,[["render",se]]);export{de as H,ie as g};
