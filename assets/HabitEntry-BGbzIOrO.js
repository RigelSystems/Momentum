import{v as K,d as W,C as X,A as G,B as Q,j as Z,r as S,b as H,k as P,_ as J,e as V,w as f,f as E,o as i,l as I,c as k,F as q,m as F,D as L,a as w,g as r,E as U,i as _,t as A,h as D,S as x,G as ee,H as te,I as le,J as ne,K as oe,L as ae,M as se,N as re,O as ie,Q as ue,T as ce,U as R,W as B,X as de,Y as me,Z as he,$ as j,a0 as M,n as fe,a1 as O,q as N}from"./index-BZi0SMls.js";function Ne(e=1,t="YYYY-MM-DD"){return Array.from({length:e},(h,d)=>K().subtract(d,"day").format(t))}const ve=W({name:"HabitEntryChecklist",components:{ChecklistItemWeightedExercise:G,ChecklistItemTask:X},props:{colour:{type:String,required:!0},date:{type:String,required:!0},value:{type:Number,required:!1}},setup(e){const{colour:t,value:h}=Q(e),{accessToken:d}=Z(),g=S(!1),$=S(null),o=S(null),v=S(!1),a=S(0),c=S(1),n=H(()=>({backgroundColor:h.value?t.value:"#f0f0f0"})),m=H(()=>{var C;return((C=o.value)==null?void 0:C.checklist_items[a.value])??null}),y="https://api.fordsdevelopment.co.uk/daily_discipline//checklists",p=async C=>{try{const T=await fetch(`${y}/${C}`,{headers:{Authorization:`Bearer ${d.value}`}});if(!T.ok)throw new Error(`Checklist fetch failed: ${T.status}`);o.value=await T.json()}catch(T){console.error(T)}};return P($,C=>C&&p(C)),{show:g,checklistId:$,checklist:o,checklistStarted:v,currentItemIdx:a,currentSetIdx:c,styles:n,currentItem:m,checklistUrl:y,openDialog:()=>g.value=!0,closeDialog:()=>g.value=!1,startChecklist:()=>v.value=!0,nextAction:()=>{const C=m.value;C&&(C.sets&&c.value<C.sets?c.value++:(a.value++,c.value=1))},accessToken:d}}}),ye={class:"n-modal__title"},pe={key:1,class:"standard-container-1"},ke={key:2};function ge(e,t,h,d,g,$){const o=E("NButton"),v=E("NSelectInputFromRequest"),a=E("NCircleProgress"),c=E("NModal");return i(),V(c,{show:e.show,"onUpdate:show":t[2]||(t[2]=n=>e.show=n)},{trigger:f(({openModal:n})=>[D(e.$slots,"trigger",{openDialog:n},()=>[r(o,{class:"habit-entry",style:U(e.styles),onClick:n},null,8,["style","onClick"])])]),header:f(()=>[D(e.$slots,"title",{},()=>[w("h2",ye,"Checklist - "+A(e.date),1)])]),footer:f(()=>[D(e.$slots,"actions",{},()=>{var n;return[e.checklistStarted?(i(),V(o,{key:0,label:"Back",onClick:t[1]||(t[1]=m=>e.currentItemIdx--)})):I("",!0),r(o,{class:"mx-2",colour:"secondary",label:"Cancel",onClick:e.closeDialog},null,8,["onClick"]),e.checklistId&&((n=e.checklist)!=null&&n.checklist_items)&&!e.checklistStarted?(i(),V(o,{key:1,label:"Start",onClick:e.startChecklist},null,8,["onClick"])):I("",!0),e.checklistStarted?(i(),V(o,{key:2,label:"Next",onClick:e.nextAction},null,8,["onClick"])):I("",!0)]})]),default:f(()=>{var n,m,y,p;return[e.checklistStarted?I("",!0):(i(),V(v,{key:0,url:e.checklistUrl,valueKey:"id",name:"role",label:"Select Checklist",modelValue:e.checklistId,"onUpdate:modelValue":t[0]||(t[0]=u=>e.checklistId=u),accessToken:e.accessToken},null,8,["url","modelValue","accessToken"])),e.checklistStarted?I("",!0):(i(),k("div",pe,[(i(!0),k(q,null,F((n=e.checklist)==null?void 0:n.checklist_items,u=>(i(),V(L(`ChecklistItem${u.checklist_item_type_classify}`),{key:u.id,checklistItem:u},null,8,["checklistItem"]))),128))])),e.checklistStarted?(i(),k("div",ke,[t[3]||(t[3]=w("p",{class:"text-center"}," You have started the checklist. Please complete the items in your checklist. ",-1)),r(a,{current:e.currentItemIdx+1,total:(m=e.checklist)==null?void 0:m.checklist_items.length,fontSize:35,size:40,strokeWidth:11,progressColor:"#88bdb9"},null,8,["current","total"]),(i(),V(L(`ChecklistItem${(y=e.currentItem)==null?void 0:y.checklist_item_type_classify}`),{checklistItem:e.currentItem},null,8,["checklistItem"])),(i(!0),k(q,null,F((p=e.currentItem)==null?void 0:p.sets,u=>{var l,s;return i(),k("div",{key:u},[w("p",{style:U({border:u===e.currentSetIdx?"1px solid grey":""})},[w("strong",null,"Set "+A(u)+":",1),_(" "+A((l=e.currentItem)==null?void 0:l.reps)+" reps at "+A((s=e.currentItem)==null?void 0:s.weight)+" kg ",1)],4)])}),128))])):I("",!0)]}),_:3},8,["show"])}const be=J(ve,[["render",ge]]),Ce=W({name:"HabitEntry",props:{accessToken:{type:String,required:!1},entry:{type:Object,required:!1},habit:{type:Object,required:!0},date:{type:String,required:!0},colour:{type:String,required:!0},loading:{type:Boolean,required:!1}},components:{SelectIcon:x,HabitEntryChecklist:be},setup(e,{emit:t}){var u;let h=!1,d=S(((u=e.entry)==null?void 0:u.value)||0);const g=H(()=>{var b;let l=null;const s=(b=e.entry)==null?void 0:b.value.toString().length;return s===1?l="18px":s===2?l="16px":s===3?l="10px":s===4?l="8px":s>=5&&(l="6px"),{fontSize:l,backgroundColor:d.value==="0"||d.value===null?null:`${e.colour} !important`}}),$=async l=>{h=!0;const s=`https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries/${e.entry.id}`;return await fetch(s,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({value:l})})},o=async l=>(h=!0,await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habit_entries",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({habit_id:e.habit.id,date:e.date,value:l})})),v=async l=>{h=!0;const s=e.entry?await $(l):await o(l);if(s.ok){h=!1;const b=await s.json();d.value=b.value,console.log("updated entry",b),t("updated")}else{h=!1;const b=await s.json();console.error(b)}};let a;const c=S(!1),n=()=>{a=setTimeout(()=>{c.value=!0},500)},m=()=>{clearTimeout(a)},y=l=>{l&&v(l)};return{entry:e.entry,updateEntry:v,loading:h,value:d,startHold:n,endHold:m,modalIsActive:c,updateRecordIcon:y,checklistUrl:"https://api.fordsdevelopment.co.uk/daily_discipline/checklists",habitEntryStyle:g}}}),Ie=te({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ie({origin:"center center",scrollStrategy:"block",transition:{component:ue},zIndex:2400})},"VDialog"),z=ee()({name:"VDialog",props:Ie(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,t){let{emit:h,slots:d}=t;const g=le(e,"modelValue"),{scopeId:$}=ne(),o=S();function v(n){var p,u;const m=n.relatedTarget,y=n.target;if(m!==y&&((p=o.value)!=null&&p.contentEl)&&((u=o.value)!=null&&u.globalTop)&&![document,o.value.contentEl].includes(y)&&!o.value.contentEl.contains(y)){const l=ce(o.value.contentEl);if(!l.length)return;const s=l[0],b=l[l.length-1];m===s?b.focus():s.focus()}}oe(()=>{document.removeEventListener("focusin",v)}),ae&&P(()=>g.value&&e.retainFocus,n=>{n?document.addEventListener("focusin",v):document.removeEventListener("focusin",v)},{immediate:!0});function a(){var n;h("afterEnter"),(n=o.value)!=null&&n.contentEl&&!o.value.contentEl.contains(document.activeElement)&&o.value.contentEl.focus({preventScroll:!0})}function c(){h("afterLeave")}return P(g,async n=>{var m;n||(await de(),(m=o.value.activatorEl)==null||m.focus({preventScroll:!0}))}),se(()=>{const n=R.filterProps(e),m=B({"aria-haspopup":"dialog"},e.activatorProps),y=B({tabindex:-1},e.contentProps);return r(R,B({ref:o,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},n,{modelValue:g.value,"onUpdate:modelValue":p=>g.value=p,"aria-modal":"true",activatorProps:m,contentProps:y,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:a,onAfterLeave:c},$),{activator:d.activator,default:function(){for(var p=arguments.length,u=new Array(p),l=0;l<p;l++)u[l]=arguments[l];return r(me,{root:"VDialog"},{default:()=>{var s;return[(s=d.default)==null?void 0:s.call(d,...u)]}})}})}),re({},o)}}),Y=he("v-spacer","div","VSpacer"),Se={key:0},$e={key:1},Ve={key:2},Ee={key:3},Te={key:4};function we(e,t,h,d,g,$){const o=E("SelectIcon"),v=E("HabitEntryChecklist");return i(),k(q,null,[e.loading?(i(),k("div",Se,"Loading...")):I("",!0),e.habit.habit_type==="Yes or No"?(i(),k("div",$e,[e.value==="1"?(i(),k("button",{key:0,onClick:t[0]||(t[0]=a=>e.updateEntry("0")),class:"habit-entry habit-entry--check",style:U({backgroundColor:e.colour})},null,4)):(i(),k("button",{key:1,onClick:t[1]||(t[1]=a=>e.updateEntry("1")),class:"habit-entry habit-entry--close"}))])):I("",!0),e.habit.habit_type==="Numerical"?(i(),k("div",Ve,[r(z,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[4]||(t[4]=a=>e.modalIsActive=a),persistent:""},{activator:f(({props:a})=>[r(N,{onClick:t[2]||(t[2]=c=>e.updateEntry((parseInt(e.value)+1).toString())),onMousedown:e.startHold,onMouseup:e.endHold,onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",text:e.value||"-",variant:"flat",class:"habit-entry habit-entry--number",style:U(e.habitEntryStyle)},null,8,["onMousedown","onMouseup","onTouchstart","onTouchend","text","style"])]),default:f(({isActive:a})=>[r(j,{title:`${e.habit.name}: ${e.date}`},{default:f(()=>[r(M,null,{default:f(()=>[r(fe,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=c=>e.value=c),label:"Value",type:"number"},null,8,["modelValue"])]),_:1}),r(O,null,{default:f(()=>[r(Y),r(N,{text:"Update Entry",onClick:c=>{a.value=!1,e.updateEntry(e.value)}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):I("",!0),e.habit.habit_type==="Icon"?(i(),k("div",Ee,[r(z,{"max-width":"500",modelValue:e.modalIsActive,"onUpdate:modelValue":t[6]||(t[6]=a=>e.modalIsActive=a),persistent:""},{activator:f(({props:a})=>[r(N,B(a,{onTouchstart:e.startHold,onTouchend:e.endHold,color:"surface-variant",variant:"flat",class:`habit-entry habit-entry--number mdi mdi-${e.value}`,style:e.value=="0"||e.value===null?null:{backgroundColor:`${e.colour} !important`}}),null,16,["onTouchstart","onTouchend","class","style"])]),default:f(({isActive:a})=>[r(j,{title:`${e.habit.name}: ${e.date}`},{default:f(()=>[r(M,null,{default:f(()=>[r(o,{modelValue:e.value.value,"onUpdate:modelValue":t[5]||(t[5]=c=>e.value.value=c),onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate"])]),_:1}),r(O,null,{default:f(()=>[r(Y),r(N,{text:"Update Entry",onClick:c=>a.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1},8,["modelValue"])])):I("",!0),e.habit.habit_type==="Checklist"?(i(),k("div",Te,[r(v,{colour:e.colour,date:e.date,value:e.value},null,8,["colour","date","value"])])):I("",!0)],64)}const Be=J(Ce,[["render",we]]);export{Be as H,Ne as g};
