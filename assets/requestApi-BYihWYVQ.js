import{d as ie,R as _e,as as ke,j as Ve,r as ue,b as c,at as Ne,A as ye,E as we,au as Te,av as Ue,ag as Ie,aw as L,ax as Se,ay as Pe,k as Ce,p as Fe,D as $e,aq as ne,g as o,az as z,F as A,a2 as De,ar as te,J as ae,ak as Ae,aA as Ee,aB as He,ap as xe,_ as se,e as $,w as U,f as N,o as w,V as Be,a as m,l as D,c as re,i as J,a0 as le,aC as oe,t as W,h as Re,n as Me,s as Ge}from"./index-DSd1PwLk.js";import{S as qe}from"./SelectIcon-CMcsiTzv.js";const ze=ie({name:"HabitForm",props:{habit:{type:Object,required:!1,default:()=>({name:"",colour:"#fff",icon:"",goal_condition:"No Goal"})}},emits:["save"],components:{RecordForm:_e,SelectIcon:qe},setup(e,{emit:i}){const{isFeatureEnabled:u}=ke(),{accessToken:p}=Ve(),b=ue([]),v=h=>h%5===0,d=c(()=>!!e.habit.id),r=c(()=>d.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habits/${e.habit.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habits"),_=c(()=>d.value?"PUT":"POST");return{isEditMode:d,accessToken:p,friendsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//friends/friends",habitGroupsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups",habitTypesUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/types",goalConditionsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/goal_conditions",endpoint:r,method:_,handleSave:h=>{console.log("habit form handle save",h),window.location.reload(),i("save",h)},value:b,updateRecordIcon:h=>{e.habit.icon=h},allowedMinutes:v,isFeatureEnabled:u}}}),Ke=50,Oe=500;function je(e){let{toggleUpDown:i}=e,u=-1,p=-1;Ne(v);function b(r){v(),d(r),u=window.setTimeout(()=>{p=window.setInterval(()=>d(r),Ke)},Oe)}function v(){window.clearTimeout(u),window.clearInterval(p)}function d(r){i(r==="up")}return{holdStart:b,holdStop:v}}const Le=we({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},...Ee(He(),["modelValue","validationValue"])},"VNumberInput"),Je=ye()({name:"VNumberInput",props:{...Le()},emits:{"update:modelValue":e=>!0},setup(e,i){let{slots:u}=i;const p=ue(),{holdStart:b,holdStop:v}=je({toggleUpDown:O}),d=Te(e),r=c(()=>d.isDisabled.value||d.isReadonly.value),{isFocused:_,focus:E,blur:H}=Ue(e);function k(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.precision;const g=l==null?String(n):n.toFixed(l);return _.value?Number(g).toString():g}const s=Ie(e,"modelValue",null,n=>n??null,n=>n==null?n??null:L(Number(n),e.min,e.max)),t=Se(null);Pe(()=>{_.value&&!r.value||(s.value==null?t.value=null:isNaN(s.value)||(t.value=k(s.value)))});const a=c({get:()=>t.value,set(n){n===null||n===""?(s.value=null,t.value=null):!isNaN(Number(n))&&Number(n)<=e.max&&Number(n)>=e.min&&(s.value=Number(n),t.value=n)}}),h=c(()=>r.value?!1:(s.value??0)+e.step<=e.max),K=c(()=>r.value?!1:(s.value??0)-e.step>=e.min),f=c(()=>e.hideInput?"stacked":e.controlVariant),X=c(()=>f.value==="split"?"$plus":"$collapse"),Y=c(()=>f.value==="split"?"$minus":"$expand"),x=c(()=>f.value==="split"?"default":"small"),B=c(()=>f.value==="stacked"?"auto":"100%"),de=c(()=>({props:{onClick:R,onPointerup:M,onPointerdown:Q}})),ce=c(()=>({props:{onClick:R,onPointerup:M,onPointerdown:ee}}));Ce(()=>e.precision,()=>fe()),Fe(()=>{j()});function Z(n){if(n==null)return 0;const l=n.toString(),g=l.indexOf(".");return~g?l.length-g:0}function O(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(r.value)return;if(s.value==null){a.value=k(L(0,e.min,e.max));return}let l=Math.max(Z(s.value),Z(e.step));e.precision!=null&&(l=Math.max(l,e.precision)),n?h.value&&(a.value=k(s.value+e.step,l)):K.value&&(a.value=k(s.value-e.step,l))}function me(n){var I,S,q,P;if(!n.data)return;const l=(I=n.target)==null?void 0:I.value,g=(S=n.target)==null?void 0:S.selectionStart,G=(q=n.target)==null?void 0:q.selectionEnd,T=l?l.slice(0,g)+n.data+l.slice(G):n.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(T)||n.preventDefault(),e.precision!=null&&(((P=T.split(".")[1])==null?void 0:P.length)>e.precision&&n.preventDefault(),e.precision===0&&T.includes(".")&&n.preventDefault())}async function pe(n){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(n.key)||n.ctrlKey||["ArrowDown","ArrowUp"].includes(n.key)&&(n.preventDefault(),j(),await xe(),n.key==="ArrowDown"?O(!1):O())}function R(n){n.stopPropagation()}function M(n){const l=n.currentTarget;l==null||l.releasePointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v()}function Q(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),b("up")}function ee(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),b("down")}function j(){if(r.value||!p.value)return;const n=p.value.value;n&&!isNaN(Number(n))?a.value=k(L(Number(n),e.min,e.max)):a.value=null}function fe(){if(!r.value){if(s.value===null||isNaN(s.value)){a.value=null;return}a.value=e.precision==null?String(s.value):s.value.toFixed(e.precision)}}function ve(){if(!r.value){if(s.value===null||isNaN(s.value)){a.value=null;return}a.value=s.value.toString()}}function be(){E(),ve()}function he(){H(),j()}return $e(()=>{const{modelValue:n,...l}=ne.filterProps(e);function g(){return u.increment?o(ae,{key:"increment-defaults",defaults:{VBtn:{disabled:!h.value,flat:!0,height:B.value,size:x.value,icon:X.value}}},{default:()=>[u.increment(de.value)]}):o(te,{disabled:!h.value,flat:!0,key:"increment-btn",height:B.value,"data-testid":"increment","aria-hidden":"true",icon:X.value,onClick:R,onPointerup:M,onPointerdown:Q,size:x.value,tabindex:"-1"},null)}function G(){return u.decrement?o(ae,{key:"decrement-defaults",defaults:{VBtn:{disabled:!K.value,flat:!0,height:B.value,size:x.value,icon:Y.value}}},{default:()=>[u.decrement(ce.value)]}):o(te,{disabled:!K.value,flat:!0,key:"decrement-btn",height:B.value,"data-testid":"decrement","aria-hidden":"true",icon:Y.value,size:x.value,tabindex:"-1",onClick:R,onPointerup:M,onPointerdown:ee},null)}function T(){return o("div",{class:"v-number-input__control"},[G(),o(z,{vertical:f.value!=="stacked"},null),g()])}function I(){return!e.hideInput&&!e.inset?o(z,{vertical:!0},null):void 0}const S=f.value==="split"?o("div",{class:"v-number-input__control"},[o(z,{vertical:!0},null),g()]):e.reverse||f.value==="hidden"?void 0:o(A,null,[I(),T()]),q=u["append-inner"]||S,P=f.value==="split"?o("div",{class:"v-number-input__control"},[G(),o(z,{vertical:!0},null)]):e.reverse&&f.value!=="hidden"?o(A,null,[T(),I()]):void 0,ge=u["prepend-inner"]||P;return o(ne,De({ref:p,modelValue:a.value,"onUpdate:modelValue":y=>a.value=y,validationValue:s.value,onBeforeinput:me,onFocus:be,onBlur:he,onKeydown:pe,class:["v-number-input",{"v-number-input--default":f.value==="default","v-number-input--hide-input":e.hideInput,"v-number-input--inset":e.inset,"v-number-input--reverse":e.reverse,"v-number-input--split":f.value==="split","v-number-input--stacked":f.value==="stacked"},e.class]},l,{style:e.style,inputmode:"decimal"}),{...u,"append-inner":q?function(){var F;for(var y=arguments.length,C=new Array(y),V=0;V<y;V++)C[V]=arguments[V];return o(A,null,[(F=u["append-inner"])==null?void 0:F.call(u,...C),S])}:void 0,"prepend-inner":ge?function(){var F;for(var y=arguments.length,C=new Array(y),V=0;V<y;V++)C[V]=arguments[V];return o(A,null,[P,(F=u["prepend-inner"])==null?void 0:F.call(u,...C)])}:void 0})}),Ae({},p)}}),We={class:"n-modal__title"},Xe=["onUpdate:modelValue"],Ye=["onUpdate:modelValue"];function Ze(e,i,u,p,b,v){const d=N("NButton"),r=N("NTextInput"),_=N("NSelectInputFromRequest"),E=N("SelectIcon"),H=N("NColourPicker"),k=N("NTimeInput"),s=N("RecordForm");return w(),$(s,{record:e.habit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:U(({openDialog:t})=>[Re(e.$slots,"trigger",{openDialog:t},()=>[o(d,{label:e.isEditMode?"Edit Habit":"Add Habit"},null,8,["label"])])]),title:U(()=>[m("h2",We,W(e.isEditMode?"Edit Habit":"Add New Habit"),1)]),form:U(({record:t})=>[o(Be,null,{default:U(()=>[i[5]||(i[5]=m("h1",null,"Details",-1)),o(r,{value:t.name,"onUpdate:value":a=>t.name=a,label:"Name"},null,8,["value","onUpdate:value"]),o(_,{url:e.habitGroupsUrl,valueKey:"id",name:"habit_group_id",label:"Habit Group",accessToken:e.accessToken,modelValue:t.habit_group_id,"onUpdate:modelValue":a=>t.habit_group_id=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(_,{url:e.habitTypesUrl,valueKey:"name",name:"habit_type",label:"Habit Type",accessToken:e.accessToken,modelValue:t.habit_type,"onUpdate:modelValue":a=>t.habit_type=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(E,{modelValue:t.icon,"onUpdate:modelValue":a=>t.icon=a,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"]),o(H,{modelValue:t.colour,"onUpdate:modelValue":a=>t.colour=a},null,8,["modelValue","onUpdate:modelValue"]),i[6]||(i[6]=m("h1",null,"Goal",-1)),o(_,{url:e.goalConditionsUrl,valueKey:"name",name:"goal_condition",label:"Goal Condition",accessToken:e.accessToken,modelValue:t.goal_condition,"onUpdate:modelValue":a=>t.goal_condition=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),t.goal_condition==="No Goal"||t.goal_condition==="Anything"||!t.goal_condition?D("",!0):(w(),$(r,{key:0,value:t.goal_value,"onUpdate:value":a=>t.goal_value=a,label:"Goal Value"},null,8,["value","onUpdate:value"])),e.isFeatureEnabled()?(w(),re(A,{key:1},[i[2]||(i[2]=m("h1",null,"Reminder",-1)),m("p",null,[i[0]||(i[0]=J("Would you like a reminder set for this habit? ")),le(m("input",{type:"checkbox","onUpdate:modelValue":a=>t.wants_reminder=a},null,8,Xe),[[oe,t.wants_reminder]])]),t.wants_reminder||t.start_time?(w(),$(k,{key:0,label:"Select Time",value:t.start_time,"onUpdate:value":a=>t.start_time=a},null,8,["value","onUpdate:value"])):D("",!0),t.wants_reminder?(w(),$(Je,{reverse:!1,controlVariant:"default",label:"Duration",hideInput:!1,inset:!1,key:"duration",name:"duration",modelValue:t.duration,"onUpdate:modelValue":a=>t.duration=a},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),i[3]||(i[3]=m("h1",null,"Check-in",-1)),m("p",null,[i[1]||(i[1]=J("Would you like a check-in set for this habit? ")),le(m("input",{type:"checkbox","onUpdate:modelValue":a=>t.wants_check_in=a},null,8,Ye),[[oe,t.wants_check_in]])]),t.wants_check_in||t.check_in_time?(w(),$(k,{key:2,label:"Select Time",value:t.check_in_time,"onUpdate:value":a=>t.check_in_time=a},null,8,["value","onUpdate:value"])):D("",!0),i[4]||(i[4]=m("h1",null,"Access",-1)),o(_,{url:e.friendsUrl,valueKey:"id",name:"role",label:"Select Users",accessToken:e.accessToken,modelValue:t.users_id,"onUpdate:modelValue":a=>t.users_id=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"])],64)):D("",!0)]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const Qe=se(ze,[["render",Ze]]),en=ie({name:"Habit",props:{habit:{type:Object,required:!0},fetchHabits:{type:Function,required:!0}},components:{HabitForm:Qe}}),nn={class:"d-flex justify-space-start align-center"},tn=["onClick"],an=["href"];function ln(e,i,u,p,b,v){const d=N("HabitForm");return w(),re("div",nn,[o(d,{habit:e.habit,fetchHabits:e.fetchHabits},{trigger:U(({openDialog:r})=>[m("span",{class:"mdi mdi-square-edit-outline clickable",onClick:r},null,8,tn)]),_:1},8,["habit","fetchHabits"]),o(Me,{class:"mr-1"},{default:U(()=>[J("mdi-"+W(e.habit.icon),1)]),_:1}),m("div",null,[m("a",{href:`/#/habits/${e.habit.id}`},W(e.habit.name),9,an)])])}const sn=se(en,[["render",ln],["__scopeId","data-v-11a64bb9"]]);function rn(e,i="GET",u=null){return async function(){const{getAccessTokenSilently:b}=Ge(),v=await b(),d=await fetch(e,{method:i,headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:u?JSON.stringify(u):void 0});if(!d.ok)throw new Error(`API ${i} ${e} failed (${d.status})`);return d.json()}}export{sn as H,Qe as a,rn as r};
