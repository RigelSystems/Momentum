import{d as D,S as R,R as Y,u as I,r as y,b as T,_ as M,e as U,w as s,f as l,o as t,g as o,V as j,h as A,a as c,t as k,i as P,j as $,k as B,c as a,l as L,P as q,U as z,m as O,n as X,p as J,q as C,F as V,s as w}from"./index-7gKEMWz-.js";import{H as K,a as Q}from"./Habit-CG_zALw4.js";import{H as W,g as N}from"./dateUtils-CK5xb56A.js";const Z=D({name:"HabitGroupForm",props:{habitGroup:{type:Object,required:!1,default:()=>({name:""})}},components:{RecordForm:Y,SelectIcon:R},setup(e){I();const m=y([]),n=T(()=>!!e.habitGroup.id),_=T(()=>n.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups/${e.habitGroup.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups"),b=T(()=>n.value?"PUT":"POST");return{isEditMode:n,endpoint:_,method:b,handleSave:async i=>{window.location.reload()},value:m,updateRecordIcon:i=>{e.habitGroup.icon=i}}}});function x(e,m,n,_,b,g){const d=l("SelectIcon"),i=l("RecordForm");return t(),U(i,{record:e.habitGroup,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:s(({openDialog:r})=>[P(e.$slots,"trigger",{openDialog:r},()=>[o($,{color:"primary"},{default:s(()=>[B(k(e.isEditMode?"Edit Habit Group":"Add Habit Group"),1)]),_:1})])]),title:s(()=>[c("span",null,k(e.isEditMode?"Edit Habit Group":"Add New Habit Group"),1)]),form:s(({record:r})=>[o(j,null,{default:s(()=>[o(A,{modelValue:r.name,"onUpdate:modelValue":f=>r.name=f,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"]),o(d,{modelValue:r.icon,"onUpdate:modelValue":f=>r.icon=f,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const E=M(Z,[["render",x]]),ee=D({name:"HabitGroup",props:{habitGroup:{type:Object,required:!0}},components:{HabitGroupForm:E}}),te={class:"table-group-name habit-group"},oe={class:"habit-group__name-wrapper"};function ae(e,m,n,_,b,g){const d=l("HabitGroupForm");return t(),a("div",te,[c("div",oe,[c("h3",null,k(e.habitGroup.name),1),o(L,{class:"mr-2",size:"x-small"},{default:s(()=>[B("mdi-"+k(e.habitGroup.icon),1)]),_:1})]),o(d,{habitGroup:e.habitGroup},{trigger:s(({openDialog:i})=>[o($,{density:"default",icon:"mdi-dots-vertical",onClick:i,size:"medium",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habitGroup"])])}const se=M(ee,[["render",ae]]),ne=D({name:"HabitsView",components:{Habit:Q,HabitForm:K,HabitEntry:W,HabitGroup:se,User:z,PageHeader:q,HabitGroupForm:E},setup(){const{getAccessTokenSilently:e,user:m}=O(),n=y(null),_=y([]),b=y(!0),g=y(null),d=y({}),i=X().format("YYYY-MM-DD"),r=N(30,"YYYY-MM-DD"),f=N(30,"ddd<br>D"),G=async()=>{const v=await fetch("https://api.fordsdevelopment.co.uk/daily_discipline/habits/get_habits",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.value}`}});if(v.ok){b.value=!1;const H=await v.json();console.log("responseBody Habits",H),d.value=H.completion_percentages,_.value=H.habit_groups}else{b.value=!1;const H=await v.json();g.value=H.error}},F=(h,v)=>h.habit_entries.find(H=>H.date===v),S=h=>h===100,u=async()=>{n.value=await e()},p="https://api.fordsdevelopment.co.uk/daily_discipline/habits/bulk_update";return J(async()=>{await u(),G()}),{accessToken:n,user:m,groupedHabits:_,loading:b,errorMessage:g,lastSevenDays:r,completionPercentages:d,todaysDateFormatted:i,getHabitEntiryForDate:F,lastSevenDaysNice:f,fetchHabits:G,habitComplete:S,habitBulkUpdateUrl:p}}}),ie={class:"page-wrapper"},re={class:"mb-5 d-flex justify-space-start"},le={key:0},ce={key:1},de={key:2},ue={key:3},pe={class:"habit-table"},me={class:"horizontal-scroll"},be={class:"completion-percentages-container"},he=["innerHTML"],_e={class:"table-habit-name"};function fe(e,m,n,_,b,g){const d=l("HabitForm"),i=l("HabitGroupForm"),r=l("HabitGroup"),f=l("Habit"),G=l("HabitEntry"),F=l("n-order-list"),S=l("n-dropdown");return t(),a("div",ie,[c("div",re,[e.fetchHabits?(t(),U(d,{key:0,fetchHabits:e.fetchHabits},{trigger:s(({openDialog:u})=>[o($,{density:"comfortable",variant:"tonal",text:"New Habit",class:"mr-2",onClick:u},null,8,["onClick"])]),_:1},8,["fetchHabits"])):C("",!0),o(i,null,{trigger:s(({openDialog:u})=>[o($,{density:"comfortable",variant:"tonal",text:"New Habit Group",onClick:u},null,8,["onClick"])]),_:1})]),e.loading?(t(),a("div",le,"Loading...")):e.errorMessage?(t(),a("div",ce,k(e.errorMessage),1)):e.groupedHabits.length===0?(t(),a("div",de,"No habits found")):(t(),a("div",ue,[c("div",pe,[c("div",me,[(t(!0),a(V,null,w(e.groupedHabits,u=>(t(),a("div",{key:u,class:"table-habit-group"},[o(S,null,{label:s(()=>[o(r,{habitGroup:u.habit_group},null,8,["habitGroup"])]),content:s(()=>[c("div",be,[m[0]||(m[0]=c("div",{class:"table-habit-name"},null,-1)),(t(!0),a(V,null,w(e.lastSevenDaysNice,p=>(t(),a("small",{class:"table-cell",key:p},[c("span",{class:"table-date",innerHTML:p},null,8,he)]))),128))]),o(F,{class:"table-habit-tr",items:u.habits,updateUrl:e.habitBulkUpdateUrl,loading:e.loading,accessToken:e.accessToken,modelName:"habits"},{default:s(p=>[c("div",_e,[o(f,{habit:p,fetchHabits:e.fetchHabits},null,8,["habit","fetchHabits"])]),(t(!0),a(V,null,w(e.lastSevenDays,h=>(t(),a("div",{class:"table-cell",key:h},[e.accessToken?(t(),U(G,{key:0,entry:e.getHabitEntiryForDate(p,h),habit:p,date:h,colour:p.colour,fetchHabits:e.fetchHabits,accessToken:e.accessToken},null,8,["entry","habit","date","colour","fetchHabits","accessToken"])):C("",!0)]))),128))]),_:2},1032,["items","updateUrl","loading","accessToken"])]),_:2},1024)]))),128))])])]))])}const ve=M(ne,[["render",fe]]);export{ve as default};
