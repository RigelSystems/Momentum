import{d as le,S as be,R as he,j as ge,r as oe,b as c,a2 as Ve,G as Ne,H as ke,a3 as _e,a4 as ye,I as we,a5 as W,a6 as Te,a7 as Ue,k as Ie,s as Se,M as Pe,n as te,g as o,a8 as M,F as B,W as Ce,q,Y as ae,N as $e,a9 as De,aa as Fe,X as Ae,_ as ie,e as G,w as _,f as k,o as C,V as He,a as g,l as X,i as Y,ab as Ee,ac as xe,t as z,h as Re,c as Me,p as Be,x as Ge}from"./index-BZi0SMls.js";const qe=le({name:"HabitForm",props:{habit:{type:Object,required:!1,default:()=>({name:"",colour:"#fff",icon:""})}},emits:["saved"],components:{RecordForm:he,SelectIcon:be},setup(e,{emit:r}){const{accessToken:i}=ge(),p=oe([]),v=s=>s%5===0,m=c(()=>!!e.habit.id),d=c(()=>m.value?`https://api.fordsdevelopment.co.uk/daily_discipline//habits/${e.habit.id}`:"https://api.fordsdevelopment.co.uk/daily_discipline//habits"),u=c(()=>m.value?"PUT":"POST");return{isEditMode:m,accessToken:i,friendsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//friends/friends",habitGroupsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habit_groups",habitTypesUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/types",goalConditionsUrl:"https://api.fordsdevelopment.co.uk/daily_discipline//habits/goal_conditions",endpoint:d,method:u,handleSave:s=>{console.log("habit form handle save",s),window.location.reload(),r("saved",s)},value:p,updateRecordIcon:s=>{e.habit.icon=s},allowedMinutes:v}}}),ze=50,Ke=500;function Oe(e){let{toggleUpDown:r}=e,i=-1,p=-1;Ve(m);function v(u){m(),d(u),i=window.setTimeout(()=>{p=window.setInterval(()=>d(u),ze)},Ke)}function m(){window.clearTimeout(i),window.clearInterval(p)}function d(u){r(u==="up")}return{holdStart:v,holdStop:m}}const je=ke({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},...De(Fe(),["modelValue","validationValue"])},"VNumberInput"),Le=Ne()({name:"VNumberInput",props:{...je()},emits:{"update:modelValue":e=>!0},setup(e,r){let{slots:i}=r;const p=oe(),{holdStart:v,holdStop:m}=Oe({toggleUpDown:j}),d=_e(e),u=c(()=>d.isDisabled.value||d.isReadonly.value),{isFocused:w,focus:$,blur:D}=ye(e);function V(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.precision;const b=l==null?String(n):n.toFixed(l);return w.value?Number(b).toString():b}const t=we(e,"modelValue",null,n=>n??null,n=>n==null?n??null:W(Number(n),e.min,e.max)),a=Te(null);Ue(()=>{w.value&&!u.value||(t.value==null?a.value=null:isNaN(t.value)||(a.value=V(t.value)))});const s=c({get:()=>a.value,set(n){n===null||n===""?(t.value=null,a.value=null):!isNaN(Number(n))&&Number(n)<=e.max&&Number(n)>=e.min&&(t.value=Number(n),a.value=n)}}),K=c(()=>u.value?!1:(t.value??0)+e.step<=e.max),O=c(()=>u.value?!1:(t.value??0)-e.step>=e.min),f=c(()=>e.hideInput?"stacked":e.controlVariant),J=c(()=>f.value==="split"?"$plus":"$collapse"),Z=c(()=>f.value==="split"?"$minus":"$expand"),F=c(()=>f.value==="split"?"default":"small"),A=c(()=>f.value==="stacked"?"auto":"100%"),ue=c(()=>({props:{onClick:H,onPointerup:E,onPointerdown:ee}})),re=c(()=>({props:{onClick:H,onPointerup:E,onPointerdown:ne}}));Ie(()=>e.precision,()=>ce()),Se(()=>{L()});function Q(n){if(n==null)return 0;const l=n.toString(),b=l.indexOf(".");return~b?l.length-b:0}function j(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(u.value)return;if(t.value==null){s.value=V(W(0,e.min,e.max));return}let l=Math.max(Q(t.value),Q(e.step));e.precision!=null&&(l=Math.max(l,e.precision)),n?K.value&&(s.value=V(t.value+e.step,l)):O.value&&(s.value=V(t.value-e.step,l))}function se(n){var T,U,R,I;if(!n.data)return;const l=(T=n.target)==null?void 0:T.value,b=(U=n.target)==null?void 0:U.selectionStart,x=(R=n.target)==null?void 0:R.selectionEnd,y=l?l.slice(0,b)+n.data+l.slice(x):n.data;/^-?(\d+(\.\d*)?|(\.\d+)|\d*|\.)$/.test(y)||n.preventDefault(),e.precision!=null&&(((I=y.split(".")[1])==null?void 0:I.length)>e.precision&&n.preventDefault(),e.precision===0&&y.includes(".")&&n.preventDefault())}async function de(n){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(n.key)||n.ctrlKey||["ArrowDown","ArrowUp"].includes(n.key)&&(n.preventDefault(),L(),await Ae(),n.key==="ArrowDown"?j(!1):j())}function H(n){n.stopPropagation()}function E(n){const l=n.currentTarget;l==null||l.releasePointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),m()}function ee(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v("up")}function ne(n){const l=n.currentTarget;l==null||l.setPointerCapture(n.pointerId),n.preventDefault(),n.stopPropagation(),v("down")}function L(){if(u.value||!p.value)return;const n=p.value.value;n&&!isNaN(Number(n))?s.value=V(W(Number(n),e.min,e.max)):s.value=null}function ce(){if(!u.value){if(t.value===null||isNaN(t.value)){s.value=null;return}s.value=e.precision==null?String(t.value):t.value.toFixed(e.precision)}}function me(){if(!u.value){if(t.value===null||isNaN(t.value)){s.value=null;return}s.value=t.value.toString()}}function pe(){$(),me()}function fe(){D(),L()}return Pe(()=>{const{modelValue:n,...l}=te.filterProps(e);function b(){return i.increment?o(ae,{key:"increment-defaults",defaults:{VBtn:{disabled:!K.value,flat:!0,height:A.value,size:F.value,icon:J.value}}},{default:()=>[i.increment(ue.value)]}):o(q,{disabled:!K.value,flat:!0,key:"increment-btn",height:A.value,"data-testid":"increment","aria-hidden":"true",icon:J.value,onClick:H,onPointerup:E,onPointerdown:ee,size:F.value,tabindex:"-1"},null)}function x(){return i.decrement?o(ae,{key:"decrement-defaults",defaults:{VBtn:{disabled:!O.value,flat:!0,height:A.value,size:F.value,icon:Z.value}}},{default:()=>[i.decrement(re.value)]}):o(q,{disabled:!O.value,flat:!0,key:"decrement-btn",height:A.value,"data-testid":"decrement","aria-hidden":"true",icon:Z.value,size:F.value,tabindex:"-1",onClick:H,onPointerup:E,onPointerdown:ne},null)}function y(){return o("div",{class:"v-number-input__control"},[x(),o(M,{vertical:f.value!=="stacked"},null),b()])}function T(){return!e.hideInput&&!e.inset?o(M,{vertical:!0},null):void 0}const U=f.value==="split"?o("div",{class:"v-number-input__control"},[o(M,{vertical:!0},null),b()]):e.reverse||f.value==="hidden"?void 0:o(B,null,[T(),y()]),R=i["append-inner"]||U,I=f.value==="split"?o("div",{class:"v-number-input__control"},[x(),o(M,{vertical:!0},null)]):e.reverse&&f.value!=="hidden"?o(B,null,[y(),T()]):void 0,ve=i["prepend-inner"]||I;return o(te,Ce({ref:p,modelValue:s.value,"onUpdate:modelValue":N=>s.value=N,validationValue:t.value,onBeforeinput:se,onFocus:pe,onBlur:fe,onKeydown:de,class:["v-number-input",{"v-number-input--default":f.value==="default","v-number-input--hide-input":e.hideInput,"v-number-input--inset":e.inset,"v-number-input--reverse":e.reverse,"v-number-input--split":f.value==="split","v-number-input--stacked":f.value==="stacked"},e.class]},l,{style:e.style,inputmode:"decimal"}),{...i,"append-inner":R?function(){var P;for(var N=arguments.length,S=new Array(N),h=0;h<N;h++)S[h]=arguments[h];return o(B,null,[(P=i["append-inner"])==null?void 0:P.call(i,...S),U])}:void 0,"prepend-inner":ve?function(){var P;for(var N=arguments.length,S=new Array(N),h=0;h<N;h++)S[h]=arguments[h];return o(B,null,[I,(P=i["prepend-inner"])==null?void 0:P.call(i,...S)])}:void 0})}),$e({},p)}}),We={class:"n-modal__title"},Xe=["onUpdate:modelValue"];function Ye(e,r,i,p,v,m){const d=k("NTextInput"),u=k("NSelectInputFromRequest"),w=k("SelectIcon"),$=k("NColourPicker"),D=k("NTimeInput"),V=k("RecordForm");return C(),G(V,{record:e.habit,endpoint:e.endpoint,method:e.method,onSave:e.handleSave},{trigger:_(({openDialog:t})=>[Re(e.$slots,"trigger",{openDialog:t},()=>[o(q,{color:"primary"},{default:_(()=>[Y(z(e.isEditMode?"Edit Habit":"Add Habit"),1)]),_:1})])]),title:_(()=>[g("h2",We,z(e.isEditMode?"Edit Habit":"Add New Habit"),1)]),form:_(({record:t})=>[o(He,null,{default:_(()=>[r[1]||(r[1]=g("h1",null,"Details",-1)),o(d,{value:t.name,"onUpdate:value":a=>t.name=a,label:"Name"},null,8,["value","onUpdate:value"]),o(u,{url:e.habitGroupsUrl,valueKey:"id",name:"habit_group_id",label:"Habit Group",accessToken:e.accessToken,modelValue:t.habit_group_id,"onUpdate:modelValue":a=>t.habit_group_id=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(u,{url:e.habitTypesUrl,valueKey:"name",name:"habit_type",label:"Habit Type",accessToken:e.accessToken,modelValue:t.habit_type,"onUpdate:modelValue":a=>t.habit_type=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),o(w,{modelValue:t.icon,"onUpdate:modelValue":a=>t.icon=a,onUpdate:e.updateRecordIcon},null,8,["modelValue","onUpdate:modelValue","onUpdate"]),o($,{modelValue:t.colour,"onUpdate:modelValue":a=>t.colour=a},null,8,["modelValue","onUpdate:modelValue"]),r[2]||(r[2]=g("h1",null,"Goal",-1)),o(u,{url:e.goalConditionsUrl,valueKey:"name",name:"goal_condition",label:"Goal Condition",accessToken:e.accessToken,modelValue:t.goal_condition,"onUpdate:modelValue":a=>t.goal_condition=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"]),t.goal_condition==="No Goal"||t.goal_condition==="Anything"?X("",!0):(C(),G(d,{key:0,value:t.goal_value,"onUpdate:value":a=>t.goal_value=a,label:"Goal Value"},null,8,["value","onUpdate:value"])),r[3]||(r[3]=g("h1",null,"Reminder",-1)),g("p",null,[r[0]||(r[0]=Y("Would you like a reminder set for this habit? ")),Ee(g("input",{type:"checkbox","onUpdate:modelValue":a=>t.wants_reminder=a},null,8,Xe),[[xe,t.wants_reminder]])]),t.wants_reminder?(C(),G(D,{key:1,label:"Select Time",value:t.start_time,"onUpdate:value":a=>t.start_time=a},null,8,["value","onUpdate:value"])):X("",!0),t.wants_reminder?(C(),G(Le,{reverse:!1,controlVariant:"default",label:"Duration",hideInput:!1,inset:!1,key:"duration",name:"duration",modelValue:t.duration,"onUpdate:modelValue":a=>t.duration=a},null,8,["modelValue","onUpdate:modelValue"])):X("",!0),r[4]||(r[4]=g("h1",null,"Access",-1)),o(u,{url:e.friendsUrl,valueKey:"id",name:"role",label:"Select Users",accessToken:e.accessToken,modelValue:t.users_id,"onUpdate:modelValue":a=>t.users_id=a},null,8,["url","accessToken","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:3},8,["record","endpoint","method","onSave"])}const Je=ie(qe,[["render",Ye]]),Ze=le({name:"Habit",props:{habit:{type:Object,required:!0},fetchHabits:{type:Function,required:!0}},components:{HabitForm:Je}}),Qe={class:"d-flex justify-space-start align-center"},en=["href"];function nn(e,r,i,p,v,m){const d=k("HabitForm");return C(),Me("div",Qe,[o(d,{habit:e.habit,fetchHabits:e.fetchHabits},{trigger:_(({openDialog:u})=>[o(q,{density:"default",icon:"mdi-dots-vertical",onClick:u,size:"x-small",class:"mr-2 kabab-menu"},null,8,["onClick"])]),_:1},8,["habit","fetchHabits"]),o(Be,{class:"mr-1"},{default:_(()=>[Y("mdi-"+z(e.habit.icon),1)]),_:1}),g("div",null,[g("a",{href:`/#/habits/${e.habit.id}`},z(e.habit.name),9,en)])])}const an=ie(Ze,[["render",nn],["__scopeId","data-v-3761af0a"]]);function ln(e,r="GET",i=null){return async function(){const{getAccessTokenSilently:v}=Ge(),m=await v(),d=await fetch(e,{method:r,headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:i?JSON.stringify(i):void 0});if(!d.ok)throw new Error(`API ${r} ${e} failed (${d.status})`);return d.json()}}export{an as H,Je as a,ln as r};
